
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ビュー(Views) &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="(機械翻訳) レンダラー" href="renderers.html" />
    <link rel="prev" title="(機械翻訳) URLディスパッチ" href="urldispatch.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="renderers.html" title="(機械翻訳) レンダラー"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="urldispatch.html" title="(機械翻訳) URLディスパッチ"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="views">
<span id="views-chapter"></span><h1>ビュー(Views)<a class="headerlink" href="#views" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><span>Pyramid</span> の重要な仕事のうちの一つは、 <a class="reference internal" href="../glossary.html#term-request"><span class="xref std std-term">request</span></a> がアプリケーションに達したときに <a class="reference internal" href="../glossary.html#term-view-callable"><span class="xref std std-term">view callable</span></a> を見つけて起動することです。ビュー callable はアプリケーションになされたリクエストに応じて興味深いことを行うコードの断片です。それらはあらゆる興味深いウェブアプリケーションの「肉(本質、芯)」です。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last"><span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-view-callable"><span class="xref std std-term">view callable</span></a> は、会話での省略表現でしばしば <a class="reference internal" href="../glossary.html#term-view"><span class="xref std std-term">view</span></a> と呼ばれます。しかし、「<em>設定</em>」ビューと*callable*」ビューを実装するコード、および「<em>検索</em>」ビュー  プロセスの間に著しい違いがあるので、このドキュメンテーションでは、それほど曖昧でない用語を使用する必要があります。</p>
</div>
<p>本章では、ビュー callable をどのように定義するかを説明します。実際にどのようにして特定の URL パターンおよび他のリクエスト状況に対してビューcallable を接続するように <span>Pyramid</span> に伝えるかを理解するためには、次章 (<a class="reference internal" href="viewconfig.html#view-config-chapter"><span class="std std-ref">(機械翻訳) 設定を表示</span></a>) まで待たなければなりません。</p>
<div class="section" id="view-callables">
<span id="index-0"></span><h2>Callablesビュー(View Callables)<a class="headerlink" href="#view-callables" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Callableビューは、明らかに呼び出し可能なPythonオブジェクトを検出する危険性があります。 具体的には、ビュー callable は、関数、クラス、または <code class="docutils literal notranslate"><span class="pre">__call__</span></code> メソッド (これによりインスタンスが呼び出し可能になります) を実装したインスタンスです。</p>
<p>callableビューは少なくとも <code class="docutils literal notranslate"><span class="pre">request</span></code> という名前の単一の引数を受け取る必要があります。この引数は <span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-request"><span class="xref std std-term">Request</span></a> オブジェクトを表わしています。 requestオブジェクトは、上流のWSGIサーバーによって:app:<cite>Pyramid</cite> に提供される <a class="reference internal" href="../glossary.html#term-wsgi"><span class="xref std std-term">WSGI</span></a> 環境変数を表わします。ご想像の通りrequest オブジェクトは実行中の特定のHTTP リクエストに関してアプリケーションが知る必要のあるすべてのものを含んでいます。</p>
<p>callableビュー の最終責任は <span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-response"><span class="xref std std-term">Response</span></a> オブジェクトを生成することです。これはcallableビューのコード内で <a class="reference internal" href="../glossary.html#term-response"><span class="xref std std-term">Response</span></a> オブジェクトを生成してそれを直接返却するか、あるいはcallableビューの本体内部から特別な種類の例外を上げることによって実行できます。</p>
</div>
<div class="section" id="defining-a-view-callable-as-a-function">
<span id="function-as-view"></span><span id="index-1"></span><h2>callableビューを関数として定義する(Defining a View Callable as a Function)<a class="headerlink" href="#defining-a-view-callable-as-a-function" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>callableビューを定義する最も簡単な方法のうちの一つは、 <code class="docutils literal notranslate"><span class="pre">request</span></code> という名前の単一の引数を受け取り、 <a class="reference internal" href="../glossary.html#term-response"><span class="xref std std-term">Response</span></a> オブジェクトを返す関数を作成することです。例えば以下は関数として実装された 「hello world」callableビューです:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Hello world!&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="defining-a-view-callable-as-a-class">
<span id="class-as-view"></span><span id="index-2"></span><h2>callableビューをクラスとして定義する(Defining a View Callable as a Class)<a class="headerlink" href="#defining-a-view-callable-as-a-class" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>callableビューは関数の代わりにPython クラスによっても表せます。callableビューがクラスである場合は、関数または別の非クラスの callable&quot;である場合とは呼び出しのセマンティクスがやや異なります。callableビューがクラスである場合、クラスの <code class="docutils literal notranslate"><span class="pre">__init__</span></code> メソッドが <code class="docutils literal notranslate"><span class="pre">request</span></code> パラメータをともなって呼ばれます。その結果としてクラスのインスタンスが生成されます。続いてそのインスタンスの <code class="docutils literal notranslate"><span class="pre">__call__</span></code> メソッドがパラメータなしで起動されます。クラスとして定義されたビューには次のような特性がなければなりません:&quot;</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">request</span></code> 引数を受け取る <code class="docutils literal notranslate"><span class="pre">__init__</span></code> メソッド。</li>
<li>パラメータを受け取らず、レスポンスを返す <code class="docutils literal notranslate"><span class="pre">__call__</span></code> (あるいは他の)メソッド。</li>
</ul>
<p>例えば:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal notranslate"><span class="pre">__init__</span></code> に渡された request オブジェクトは <a class="reference internal" href="#function-as-view"><span class="std std-ref">callableビューを関数として定義する(Defining a View Callable as a Function)</span></a> で述べたのと同じ型の request オブジェクトです。</p>
<p>レスポンスを返すことが期待されるメソッドを表わすために <code class="docutils literal notranslate"><span class="pre">__call__</span></code> とは別の属性を使用したければ、ビュー設定の一部として <code class="docutils literal notranslate"><span class="pre">attr</span></code> 値を使用するできます。 <a class="reference internal" href="viewconfig.html#view-configuration-parameters"><span class="std std-ref">設定パラメータの表示</span></a> を参照してください。クラスが関連するcallableビュー のコレクションを表したければ、各々クラスの異なるメソッドを指す異なる <cite>attr</cite> 値を用いて同じビューcallable クラスを異なるビュー設定の中で使用できます。</p>
</div>
<div class="section" id="view-callable-responses">
<span id="the-response"></span><span id="index-3"></span><h2>callableビューレスポンス(View Callable Responses)<a class="headerlink" href="#view-callable-responses" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>callableビューは、 <span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-response"><span class="xref std std-term">Response</span></a> インタフェースを実装するオブジェクトを返せます。 <a class="reference internal" href="../glossary.html#term-response"><span class="xref std std-term">Response</span></a> インタフェースを実装して返す最も簡単な方法は、<a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a> オブジェクトのインスタンスを直接返すことです。例えば:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><span>Pyramid</span> は、 <a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a> を継承する一連の様々な「例外」クラスを提供しています。例えばクラス <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPFound" title="pyramid.httpexceptions.HTTPFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPFound</span></code></a> のインスタンスは <a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> を継承するのでこれも有効なresponse オブジェクトです。例については、 <a class="reference internal" href="#http-exceptions"><span class="std std-ref">HTTPの例外(HTTP Exceptions)</span></a> と <a class="reference internal" href="#http-redirect"><span class="std std-ref">HTTP リダイレクトを行うためにcallableビューを使用する(Using a View Callable to do an HTTP Redirect)</span></a> を参照してください。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">様々な状況で <a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a> のインスタンスでないオブジェクトをcallableビューから返すこともできます。これはテストを書くときや複数のビュー callable の間でコードを共有しようとするときに有用な時があります。これを可能にする通常の方法については <a class="reference internal" href="renderers.html#renderers-chapter"><span class="std std-ref">(機械翻訳) レンダラー</span></a> を参照してください。それよりもまれな、callableビューが Response オブジェクト以外を返すことを可能にする方法は <a class="reference internal" href="hooks.html#using-iresponse"><span class="std std-ref">ピラミッドが応答を見る方法を変える</span></a> の中で文書化されています。</p>
</div>
</div>
<div class="section" id="using-special-exceptions-in-view-callables">
<span id="special-exceptions-in-callables"></span><span id="index-4"></span><h2>callableビューの中で特別な例外を使用する(Using Special Exceptions in View Callables)<a class="headerlink" href="#using-special-exceptions-in-view-callables" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>通常はPythonの例外がcallableビュー内で上がった場合は、 <span>Pyramid</span> は例外をアプリケーションを起動した <a class="reference internal" href="../glossary.html#term-wsgi"><span class="xref std std-term">WSGI</span></a> サーバのすべてに伝搬させます。例外は通常そこで捕捉されてログに記録されます。</p>
<p>ただし便宜上に特別な例外のセットが存在しています。これらの例外がcallableビュー内で上がった場合、 <span>Pyramid</span> によって常にレスポンスが生成されます。これらは <a class="reference internal" href="../glossary.html#term-http-exception"><span class="xref std std-term">HTTP exception</span></a> オブジェクトと呼ばれています。</p>
<div class="section" id="http-exceptions">
<span id="index-5"></span><span id="id1"></span><h3>HTTPの例外(HTTP Exceptions)<a class="headerlink" href="#http-exceptions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPException" title="pyramid.httpexceptions.HTTPException"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPException</span></code></a> を継承しているとして記述されているすべての <a class="reference internal" href="../api/httpexceptions.html#module-pyramid.httpexceptions" title="pyramid.httpexceptions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid.httpexceptions</span></code></a> クラスは、 <a class="reference internal" href="../glossary.html#term-http-exception"><span class="xref std std-term">http exception</span></a> オブジェクトです。 HTTP例外オブジェクトのインスタンスは、ビューのコード内から「戻り値として返される」か、または「例外として投げられる」されます。 いずれの場合も（リターンまたはレイズ）、インスタンスはビューのレスポンスとして使用されます。</p>
<p>例えば、 <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPUnauthorized" title="pyramid.httpexceptions.HTTPUnauthorized"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPUnauthorized</span></code></a> 例外を投げられます。これは <code class="docutils literal notranslate"><span class="pre">401</span> <span class="pre">Unauthorized</span></code> ステータスでレスポンスを生成するでしょう:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPUnauthorized</span>

<span class="k">def</span> <span class="nf">aview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">HTTPUnauthorized</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>HTTP 例外は raise する代わりに <em>返す</em> こともできます(HTTP 例外は有効な response オブジェクトでもあります):</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPUnauthorized</span>

<span class="k">def</span> <span class="nf">aview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HTTPUnauthorized</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>HTTP 例外を生成するための近道は <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.exception_response" title="pyramid.httpexceptions.exception_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.httpexceptions.exception_response()</span></code></a> 関数です。この関数は、HTTP ステータスコードを受け取り対応する HTTP 例外を返します。例えば、 <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPUnauthorized" title="pyramid.httpexceptions.HTTPUnauthorized"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPUnauthorized</span></code></a> をインポートしてresponse オブジェクトを構築する代わりに、同じオブジェクトを構築して返すために <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.exception_response" title="pyramid.httpexceptions.exception_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">exception_response()</span></code></a> 関数を使用するできます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">exception_response</span>

<span class="k">def</span> <span class="nf">aview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">exception_response</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>これは 401 が 「HTTP Unauthorized」 のための HTTP ステータスコードであるためです。したがって、 <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">exception_response(401)</span></code> は <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">HTTPUnauthorized()</span></code> と機能的に等価です。 <a class="reference internal" href="../api/httpexceptions.html#module-pyramid.httpexceptions" title="pyramid.httpexceptions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid.httpexceptions</span></code></a> の中で、各 HTTP レスポンスコードからその目的および関連する HTTP 例外オブジェクトにマッピングするドキュメンテーションが提供されます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 1.1 で追加: </span><a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.exception_response" title="pyramid.httpexceptions.exception_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">exception_response()</span></code></a> 関数。</p>
</div>
</div>
<div class="section" id="how-pyramid-uses-http-exceptions">
<h3>Pyramid は HTTP 例外をどのように使用するか(How Pyramid Uses HTTP Exceptions)<a class="headerlink" href="#how-pyramid-uses-http-exceptions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>HTTP 例外はアプリケーション開発者が直接使うためのものです。しかし、 Pyramid は自身も通常動作の間に様々なポイントで2つの HTTP 例外を上げます</p>
<ul class="simple">
<li><a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPNotFound" title="pyramid.httpexceptions.HTTPNotFound"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPNotFound</span></code></a> はリクエストを処理するためのビューが見つからない場合に発生します</li>
<li><a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPForbidden" title="pyramid.httpexceptions.HTTPForbidden"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPForbidden</span></code></a> はセキュリティポリシーによって許可が禁止されたときに発生します。</li>
</ul>
<p><a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPNotFound" title="pyramid.httpexceptions.HTTPNotFound"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPNotFound</span></code></a> が Pyramid自身によって、またはビューのコード内で上げられる場合、 <a class="reference internal" href="../glossary.html#term-not-found-view"><span class="xref std std-term">Not Found View</span></a> の結果がリクエストを行なったユーザエージェントに返されます。</p>
<p><a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPForbidden" title="pyramid.httpexceptions.HTTPForbidden"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPForbidden</span></code></a> が Pyramid 自体によって、またはビューコード内で上げられる場合、 <a class="reference internal" href="../glossary.html#term-forbidden-view"><span class="xref std std-term">Forbidden View</span></a> の結果がリクエストを行なったユーザエージェントに返されます。</p>
</div>
</div>
<div class="section" id="custom-exception-views">
<span id="exception-views"></span><span id="index-6"></span><h2>カスタム例外ビュー(Custom Exception Views)<a class="headerlink" href="#custom-exception-views" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#special-exceptions-in-callables"><span class="std std-ref">callableビューの中で特別な例外を使用する(Using Special Exceptions in View Callables)</span></a> に述べられているように、 HTTP&quot;例外が投げられて専用のビューによって補足されることを可能にする機構を、アプリケーション開発者もレスポンスの任意の例外を変換するために使用できます。</p>
<p><span>Pyramid</span> ビューコード内から特定の例外が発生するたびに呼び出される <a class="reference internal" href="../glossary.html#term-exception-view"><span class="xref std std-term">exception view</span></a> を登録するには、 <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_exception_view" title="pyramid.config.Configurator.add_exception_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.add_exception_view()</span></code></a> を使用して、例外（または例外のサブクラス）およびポイントに一致するビュー設定を登録します。リクエストを生成したいcallableなビューで呼び出せます。例外は、ビューに登録された <a class="reference internal" href="../glossary.html#term-view-predicate"><span class="xref std std-term">view predicate</span></a> およびビュー自体に「コンテキスト」引数として渡されます。 便宜上、新しいデコレータ <code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.views.exception_view_config</span></code> が存在していて、例外ビューを簡単に登録するために使用できます。</p>
<p>例えば、 <code class="docutils literal notranslate"><span class="pre">helloworld.exceptions</span></code> という名前のモジュールに次のような例外クラスがあるとします:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ValidationFailure</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
</pre></div>
</td></tr></table></div>
<p>どこかにある <em>他の</em> コードが <code class="docutils literal notranslate"><span class="pre">helloworld.exceptions.ValidationFailure</span></code> 例外を上げた場合には常に呼ばれるようにcallableビューを設定できます:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">exception_view_config</span>
<span class="kn">from</span> <span class="nn">helloworld.exceptions</span> <span class="kn">import</span> <span class="n">ValidationFailure</span>

<span class="nd">@exception_view_config</span><span class="p">(</span><span class="n">ValidationFailure</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">failed_validation</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span>  <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Failed validation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">exc</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">status_int</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</td></tr></table></div>
<p>ビューの登録を拾い上げるために <a class="reference internal" href="../glossary.html#term-scan"><span class="xref std std-term">scan</span></a> が実行されたとすると、このビュー callable はアプリケーションのビューコードによって``helloworld.exceptions.ValidationFailure`` が上げられる場合は常に起動されることになります。カスタム root factory、カスタムtraverser、あるいはカスタムビュー、またはルート述語によって上げられた同じ例外も捕捉されフックされます。</p>
<p>他の通常のビュー述語も例外ビュー登録と組み合わせて使用できます:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>
<span class="kn">from</span> <span class="nn">helloworld.exceptions</span> <span class="kn">import</span> <span class="n">ValidationFailure</span>

<span class="nd">@exception_view_config</span><span class="p">(</span><span class="n">ValidationFailure</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">failed_validation</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span>  <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Failed validation: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">exc</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">status_int</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</td></tr></table></div>
<p>上記の例外ビューは <code class="docutils literal notranslate"><span class="pre">route_name</span></code> に <code class="docutils literal notranslate"><span class="pre">home</span></code> と指定しています。これはルート一致が <code class="docutils literal notranslate"><span class="pre">home</span></code> という名前を持っている時にだけ呼ばれることを意味しています。そのため、ある例外に対する例外ビューをシステムの中に複数持つことが可能です: リクエスト状況のセットがビュー登録と一致する時は「最も特殊な」ものが呼ばれます。</p>
<p>例外ビュー設定を行う場合、正常に使用できない唯一のビュー述語は``name`` です。例外ビューを検索するために使用される名前は常に空の文字列です。例外ビューとして登録された名前を持つビューは無視されます。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>ほとんどの場合、<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_exception_view" title="pyramid.config.Configurator.add_exception_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.add_exception_view()</span></code></a> を使用して <a class="reference internal" href="../glossary.html#term-exception-view"><span class="xref std std-term">exception view</span></a> を登録する必要があります。 しかしながら、<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">Exception</span></code></a> （すなわち、<code class="docutils literal notranslate"><span class="pre">config.add_view(context=Exception)</span></code>）を継承するコンテキストリソースタイプに対して「通常の」（すなわち例外ではない）ビューの登録が可能である。 ビュー構成が処理されると、2つのビューが登録されます。 1つは「通常の」ビュー、もう1つは <a class="reference internal" href="../glossary.html#term-exception-view"><span class="xref std std-term">exception view</span></a> です。これは、通常のビューのコンテキストとして例外を使用できることを意味します。</p>
<p class="last">これら2つのビューをラップするビューデリバーは、異なる動作をする可能性があります。 詳細については、 <a class="reference internal" href="hooks.html#exception-view-derivers"><span class="std std-ref">例外ビューとビューデリバー</span></a> を参照してください。</p>
</div>
<p>例外ビューは任意のビュー登録メカニズムで構成できます: <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> デコレータまたは命令的な <code class="docutils literal notranslate"><span class="pre">add_view</span></code> スタイル。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Pyramid の <a class="reference internal" href="../glossary.html#term-exception-view"><span class="xref std std-term">exception view</span></a> 処理ロジックは <a class="reference internal" href="../api/tweens.html#pyramid.tweens.excview_tween_factory" title="pyramid.tweens.excview_tween_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.tweens.excview_tween_factory()</span></code></a> という tween ファクトリ関数として実装されます。 Pyramid 例外ビューの処理が期待されて、 <code class="docutils literal notranslate"><span class="pre">pyramid.tweens</span></code> 設定で tween ファクトリが指定されている場合は、 <code class="docutils literal notranslate"><span class="pre">pyramid.tweens</span></code> 設定リストに <a class="reference internal" href="../api/tweens.html#pyramid.tweens.excview_tween_factory" title="pyramid.tweens.excview_tween_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.tweens.excview_tween_factory()</span></code></a> 関数を明示的に追加しなければなりません。関数が存在しなければ、 Pyramid は例外ビューの処理を行ないません。</p>
</div>
</div>
<div class="section" id="using-a-view-callable-to-do-an-http-redirect">
<span id="http-redirect"></span><span id="index-7"></span><h2>HTTP リダイレクトを行うためにcallableビューを使用する(Using a View Callable to do an HTTP Redirect)<a class="headerlink" href="#using-a-view-callable-to-do-an-http-redirect" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPFound" title="pyramid.httpexceptions.HTTPFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPFound</span></code></a> クラスを使用して HTTPリダイレクトを発行することができます。このクラスのインスタンスを例外として上げるか戻り値として返せば、クライアントは 「302 Found」レスポンスを受け取るでしょう。</p>
<p>これを行うために、 <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPFound" title="pyramid.httpexceptions.HTTPFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPFound</span></code></a> インスタンスを <em>返す</em> せます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPFound</span>

<span class="k">def</span> <span class="nf">myview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>または、それを返す代わりにHTTPFound例外を上げられます。</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPFound</span>

<span class="k">def</span> <span class="nf">myview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>インスタンスが例外として上げられる場合、それはデフォルト <a class="reference internal" href="../glossary.html#term-exception-response"><span class="xref std std-term">exception response</span></a> ハンドラによって捕捉され、レスポンスへと変換されます。</p>
</div>
<div class="section" id="handling-form-submissions-in-view-callables-unicode-and-character-set-issues">
<span id="index-8"></span><h2>callableビューの中でフォーム送信を扱う (Unicodeと文字集合の問題)Handling Form Submissions in View Callables (Unicode and Character Set Issues)<a class="headerlink" href="#handling-form-submissions-in-view-callables-unicode-and-character-set-issues" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ほとんどのウェブアプリケーションは、ウェブブラウザおよび様々な他のクライアントからフォーム送信を受け取る必要があります。 <span>Pyramid</span> では、フォーム送信を扱うロジックは常に <a class="reference internal" href="../glossary.html#term-view"><span class="xref std std-term">view</span></a> の一部です。<a class="reference internal" href="../glossary.html#term-webob"><span class="xref std std-term">WebOb</span></a> APIを使用してフォーム送信データを処理する方法の一般的な概要については、 <a class="reference internal" href="webob.html#webob-chapter"><span class="std std-ref">(機械翻訳) 要求オブジェクトと応答オブジェクト</span></a> と <a class="reference external" href="http://docs.webob.org/en/latest/reference.html#query-post-variables">WebObドキュメンテーション内の `&quot;Query and POST variables&quot;</a> を見てください。 <span>Pyramid</span> は、リクエストとレスポンスの実装についてはWebOb に任せています。また、フォーム送信データの取り扱いはリクエスト実装の特性です。 WebOb のリクエスト API を理解することは、フォーム送信データを処理する方法を理解するための鍵です。</p>
<p><span>Pyramid</span> ビュー内でフォーム送信データを処理しようとする場合、意識する必要のあるいくつかのデフォルトがあります。フォーム送信データに上位ビットが立った (つまり非 ASCII) 文字が含まれていることは、非常に一般的です。また、 UTF-8 符号化はウェブ上で文字データに使用される最も一般的な符号化です。バイト文字列を扱ったり格納したりするよりもUnicode 値の方がはるかに健全なので、 <span>Pyramid</span> はフォーム送信値を可能なら UTF-8 から Unicode へ暗黙的にデコードするように <a class="reference internal" href="../glossary.html#term-webob"><span class="xref std std-term">WebOb</span></a> リクエスト機能を構成します。ビューコードが <code class="docutils literal notranslate"><span class="pre">request.params</span></code> , <code class="docutils literal notranslate"><span class="pre">request.GET</span></code> あるいは <code class="docutils literal notranslate"><span class="pre">request.POST</span></code> API によってフォームフィールド値を得る場合、暗黙のデコードが起こります (これらの API に関する詳細に関しては <a class="reference internal" href="../api/request.html#request-module"><span class="std std-ref">(機械翻訳) pyramid.request</span></a> を参照)&quot;</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Many people find the difference between Unicode and UTF-8 confusing. Unicode
is a standard for representing text that supports most of the world's
writing systems. However, there are many ways that Unicode data can be
encoded into bytes for transit and storage. UTF-8 is a specific encoding for
Unicode that is backwards-compatible with ASCII. This makes UTF-8 very
convenient for encoding data where a large subset of that data is ASCII
characters, which is largely true on the web. UTF-8 is also the standard
character encoding for URLs.</p>
</div>
<p>例として、次のようなフォームページがブラウザクライアントに表示されて、その <code class="docutils literal notranslate"><span class="pre">action</span></code> が何らかの <span>Pyramid</span> ビューのコードを指していると仮定しましょう:</p>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span> <span class="na">action=</span><span class="s">&quot;myview&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;firstname&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;lastname&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Submit&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p><span>Pyramid</span> アプリケーション内の <code class="docutils literal notranslate"><span class="pre">myview</span></code> ビューコードは、 <code class="docutils literal notranslate"><span class="pre">request.params</span></code> によって返された値が <code class="docutils literal notranslate"><span class="pre">str</span></code> 型ではなく <code class="docutils literal notranslate"><span class="pre">unicode</span></code> 型になると想定 <em>しなければなりません</em> 。上記のフォームからフォームポストを受け取るのに下記のコードは動くでしょう:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">firstname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;firstname&#39;</span><span class="p">]</span>
    <span class="n">lastname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;lastname&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<p>しかし、次の <code class="docutils literal notranslate"><span class="pre">myview</span></code> ビューコードは動かないかもしれません。<code class="docutils literal notranslate"><span class="pre">request.params</span></code> から取得したデコード済みの (<code class="docutils literal notranslate"><span class="pre">unicode</span></code>) 値をデコードしようとしているからです:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># the .decode(&#39;utf-8&#39;) will break below if there are any high-order</span>
    <span class="c1"># characters in the firstname or lastname</span>
    <span class="n">firstname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;firstname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">lastname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;lastname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>暗黙のデコードが確実 (reliably) に動作するため、 <span>Pyramid</span> ビューにポストするすべてのフォームをレンダリングする際は必ず明示的に charsetエンコーディングを UTF-8 と定義するようにします。これは、レスポンスの <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> ヘッダの中で <code class="docutils literal notranslate"><span class="pre">;charset=UTF-8</span></code> を指定することによって、あるいは上記のフォームのようにフォームを含むページの HTML <code class="docutils literal notranslate"><span class="pre">head</span></code> でcharsetがUTF-8であることを示す <code class="docutils literal notranslate"><span class="pre">meta</span> <span class="pre">http-equiv</span></code> タグによって行うことができます。既知のすべてのブラウザクライアントは、フォームを送信する際にはそのフォームを含むレスポンスの <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> 値によって推測されたのと同じ文字集合を使ってフォームデータをエンコードすべきであると仮定するので、これは明示的に行われなければなりません。フォームデータをエンコードするためにどの charset を使用すべきかをブラウザクライアントに伝える一般的に受け入れられた方法はこれ以外にありません。エンコードを明示的に指定しなければ、ブラウザクライアントはフォームデータを送信する前にデフォルト文字セットにエンコードすることを選択します。それはサーバーが期待する UTF-8 ではない可能性があります。非UTF8 charset でエンコードされたフォームデータを含むリクエストがビューコードによって扱われるなら、いずれ他の文字集合でエンコードされたフォームデータ内の 8 bit 文字をデコードできずにビュー内で実行されたリクエストコードで(例えば <code class="docutils literal notranslate"><span class="pre">request.params['somename']</span></code> がアクセスされた場合に)エラーが発生するでしょう&quot;</p>
<p>レスポンスを生成するために <a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> クラスを使用しているか、あるいは <code class="docutils literal notranslate"><span class="pre">render_template_</span></code> テンプレート API を使用していれば、 <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> ヘッダーに UTF-8 charset がデフォルトとして自動的にセットされます。明示的な charset のない <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> ヘッダを返した場合、テキスト型のレスポンスコンテントタイプ (例えば``text/html`` や <code class="docutils literal notranslate"><span class="pre">application/xml</span></code> など) に対しては、あなたの代わりにリクエスト (訳注: レスポンスの間違い?) がレンダリング時に <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> ヘッダー値に <code class="docutils literal notranslate"><span class="pre">;charset=utf-8</span></code> トレーラーを加えます。独自のレスポンスオブジェクトを使用していれば、これを自分自身で確実に行う必要があるでしょう。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Only the <em>values</em> of request params obtained via <code class="docutils literal notranslate"><span class="pre">request.params</span></code>,
<code class="docutils literal notranslate"><span class="pre">request.GET</span></code> or <code class="docutils literal notranslate"><span class="pre">request.POST</span></code> are decoded to Unicode objects
implicitly in the <span>Pyramid</span> default configuration.  The keys are still
(byte) strings.</p>
</div>
</div>
<div class="section" id="alternate-view-callable-argument-calling-conventions">
<span id="request-and-context-view-definitions"></span><span id="index-9"></span><h2>callableビューの引数/呼び出し規約を変更するAlternate View Callable Argument/Calling Conventions<a class="headerlink" href="#alternate-view-callable-argument-calling-conventions" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>通常、callableビューは単一の引数 <code class="docutils literal notranslate"><span class="pre">request</span></code> のみを受け取るように定義されています。しかし、その代わりにビュー callable はクラス、関数あるいは <em>2 つ</em> の位置引数を受け取る何らかの callableとして定義されることも可能です: 1つ目の引数として <a class="reference internal" href="../glossary.html#term-context"><span class="xref std std-term">context</span></a> リソース、 2 つ目の引数として <a class="reference internal" href="../glossary.html#term-request"><span class="xref std std-term">request</span></a> です。</p>
<p>このスタイルで定義されたビュー関数に渡される <a class="reference internal" href="../glossary.html#term-context"><span class="xref std std-term">context</span></a> と <a class="reference internal" href="../glossary.html#term-request"><span class="xref std std-term">request</span></a> の各引数は、以下のように定義することができます:</p>
<dl class="docutils">
<dt>コンテキスト</dt>
<dd><a class="reference internal" href="../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a> ツリーあるいは <a class="reference internal" href="../glossary.html#term-url-dispatch"><span class="xref std std-term">URL dispatch</span></a> によって見つかった <a class="reference internal" href="../glossary.html#term-resource"><span class="xref std std-term">resource</span></a> オブジェクト。</dd>
<dt>リクエスト</dt>
<dd>現在のWSGIリクエストを表わす <span>Pyramid</span> リクエストオブジェクト。</dd>
</dl>
<p>次のタイプがこのスタイルのcallableビューとして動作します:</p>
<ol class="arabic">
<li><p class="first">2つの引数 <code class="docutils literal notranslate"><span class="pre">context</span></code>, <code class="docutils literal notranslate"><span class="pre">request</span></code> を受け取る関数。例えば:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Classes that have an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method that accepts <code class="docutils literal notranslate"><span class="pre">context,</span> <span class="pre">request</span></code>,
and a <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method which accepts no arguments, e.g.:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">view</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

   <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">context,request</span></code> を受け取る <code class="docutils literal notranslate"><span class="pre">__call__</span></code> メソッドを持つ任意の callable 。例えば:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">View</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">View</span><span class="p">()</span> <span class="c1"># this is the view callable</span>
</pre></div>
</td></tr></table></div>
</li>
</ol>
<p>このスタイルの呼び出し規約は、コンテキストオブジェクトがcallableのコード自身によって頻繁に使用される <a class="reference internal" href="../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a> に基づくアプリケーションで最も有用です。</p>
<p>どのビュー呼び出し規約が使われていても、ビューコードは常に <code class="docutils literal notranslate"><span class="pre">request.context</span></code> 経由によってコンテキストにアクセスできます。</p>
</div>
<div class="section" id="passing-configuration-variables-to-a-view">
<span id="passing-in-config-variables"></span><span id="index-10"></span><h2>設定変数をビューへ渡す(Passing Configuration Variables to a View)<a class="headerlink" href="#passing-configuration-variables-to-a-view" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>設定(.ini)ファイルからビューに変数を渡すことに関する情報は <a class="reference internal" href="startup.html#deployment-settings"><span class="std std-ref">展開設定</span></a> を参照してください。</p>
</div>
<div class="section" id="pylons-1-0-style-controller-dispatch">
<span id="index-11"></span><h2>Pylons 1.0 スタイルの &quot;コントローラ&quot; ディスパッチ(Pylons-1.0-Style &quot;Controller&quot; Dispatch)<a class="headerlink" href="#pylons-1-0-style-controller-dispatch" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../glossary.html#term-pyramid-handlers"><span class="xref std std-term">pyramid_handlers</span></a> という名のパッケージ (PyPI から利用可能) は <a class="reference internal" href="../glossary.html#term-pylons"><span class="xref std std-term">Pylons</span></a> スタイルの「コントローラ」の類似品を提供します。 <a class="reference internal" href="../glossary.html#term-pylons"><span class="xref std std-term">Pylons</span></a> スタイルの「コントローラ」の類似品を提供します。より多くの自動化を提供する特別な種類のビュークラスです。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ビュー(Views)</a><ul>
<li><a class="reference internal" href="#view-callables">Callablesビュー(View Callables)</a></li>
<li><a class="reference internal" href="#defining-a-view-callable-as-a-function">callableビューを関数として定義する(Defining a View Callable as a Function)</a></li>
<li><a class="reference internal" href="#defining-a-view-callable-as-a-class">callableビューをクラスとして定義する(Defining a View Callable as a Class)</a></li>
<li><a class="reference internal" href="#view-callable-responses">callableビューレスポンス(View Callable Responses)</a></li>
<li><a class="reference internal" href="#using-special-exceptions-in-view-callables">callableビューの中で特別な例外を使用する(Using Special Exceptions in View Callables)</a><ul>
<li><a class="reference internal" href="#http-exceptions">HTTPの例外(HTTP Exceptions)</a></li>
<li><a class="reference internal" href="#how-pyramid-uses-http-exceptions">Pyramid は HTTP 例外をどのように使用するか(How Pyramid Uses HTTP Exceptions)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-exception-views">カスタム例外ビュー(Custom Exception Views)</a></li>
<li><a class="reference internal" href="#using-a-view-callable-to-do-an-http-redirect">HTTP リダイレクトを行うためにcallableビューを使用する(Using a View Callable to do an HTTP Redirect)</a></li>
<li><a class="reference internal" href="#handling-form-submissions-in-view-callables-unicode-and-character-set-issues">callableビューの中でフォーム送信を扱う (Unicodeと文字集合の問題)Handling Form Submissions in View Callables (Unicode and Character Set Issues)</a></li>
<li><a class="reference internal" href="#alternate-view-callable-argument-calling-conventions">callableビューの引数/呼び出し規約を変更するAlternate View Callable Argument/Calling Conventions</a></li>
<li><a class="reference internal" href="#passing-configuration-variables-to-a-view">設定変数をビューへ渡す(Passing Configuration Variables to a View)</a></li>
<li><a class="reference internal" href="#pylons-1-0-style-controller-dispatch">Pylons 1.0 スタイルの &quot;コントローラ&quot; ディスパッチ(Pylons-1.0-Style &quot;Controller&quot; Dispatch)</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="urldispatch.html"
                        title="前の章へ">(機械翻訳) URLディスパッチ</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="renderers.html"
                        title="次の章へ">(機械翻訳) レンダラー</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/narr/views.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="renderers.html" title="(機械翻訳) レンダラー"
             >次へ</a> |</li>
        <li class="right" >
          <a href="urldispatch.html" title="(機械翻訳) URLディスパッチ"
             >前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 11月 13, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1 で生成しました。
    </div>
  </body>
</html>