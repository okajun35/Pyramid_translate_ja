
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Defining Views &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="copyright" title="著作権" href="../../copyright.html" />
    <link rel="next" title="Adding authorization" href="authorization.html" />
    <link rel="prev" title="Defining the Domain Model" href="definingmodels.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../../index.html">
      		<img class="logo" src="../../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="authorization.html" title="Adding authorization"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="definingmodels.html" title="Defining the Domain Model"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">ZODB + Traversal Wiki Tutorial</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="defining-views">
<span id="wiki-defining-views"></span><h1>Defining Views<a class="headerlink" href="#defining-views" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>A <a class="reference internal" href="../../glossary.html#term-view-callable"><span class="xref std std-term">view callable</span></a> in a <a class="reference internal" href="../../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a>-based <span>Pyramid</span>
application is typically a simple Python function that accepts two
parameters: <a class="reference internal" href="../../glossary.html#term-context"><span class="xref std std-term">context</span></a> and <a class="reference internal" href="../../glossary.html#term-request"><span class="xref std std-term">request</span></a>.  A view callable is
assumed to return a <a class="reference internal" href="../../glossary.html#term-response"><span class="xref std std-term">response</span></a> object.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">A <span>Pyramid</span> view can also be defined as callable
which accepts <em>only</em> a <a class="reference internal" href="../../glossary.html#term-request"><span class="xref std std-term">request</span></a> argument.  You'll see
this one-argument pattern used in other <span>Pyramid</span> tutorials
and applications.  Either calling convention will work in any
<span>Pyramid</span> application; the calling conventions can be used
interchangeably as necessary. In <a class="reference internal" href="../../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a>-based applications,
URLs are mapped to a context <a class="reference internal" href="../../glossary.html#term-resource"><span class="xref std std-term">resource</span></a>, and since our
<a class="reference internal" href="../../glossary.html#term-resource-tree"><span class="xref std std-term">resource tree</span></a> also represents our application's
&quot;domain model&quot;, we're often interested in the context because
it represents the persistent storage of our application.  For
this reason, in this tutorial we define views as callables that
accept <code class="docutils literal notranslate"><span class="pre">context</span></code> in the callable argument list.  If you do
need the <code class="docutils literal notranslate"><span class="pre">context</span></code> within a view function that only takes
the request as a single argument, you can obtain it via
<code class="docutils literal notranslate"><span class="pre">request.context</span></code>.</p>
</div>
<p>We're going to define several <a class="reference internal" href="../../glossary.html#term-view-callable"><span class="xref std std-term">view callable</span></a> functions, then wire them
into <span>Pyramid</span> using some <a class="reference internal" href="../../glossary.html#term-view-configuration"><span class="xref std std-term">view configuration</span></a>.</p>
<div class="section" id="declaring-dependencies-in-our-setup-py-file">
<h2>Declaring Dependencies in Our <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> File<a class="headerlink" href="#declaring-dependencies-in-our-setup-py-file" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The view code in our application will depend on a package which is not a
dependency of the original &quot;tutorial&quot; application.  The original &quot;tutorial&quot;
application was generated by the cookiecutter; it doesn't know
about our custom application requirements.</p>
<p>We need to add a dependency on the <code class="docutils literal notranslate"><span class="pre">docutils</span></code> package to our <code class="docutils literal notranslate"><span class="pre">tutorial</span></code>
package's <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file by assigning this dependency to the <code class="docutils literal notranslate"><span class="pre">requires</span></code>
parameter in the <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function.</p>
<p>Open <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> and edit it to look like the following:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;README.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">README</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;CHANGES.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">CHANGES</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;plaster_pastedeploy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid &gt;= 1.9a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_chameleon&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_debugtoolbar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_retry&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_tm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_zodbconn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;transaction&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ZODB3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;waitress&#39;</span><span class="p">,</span>
<span class="hll">    <span class="s1">&#39;docutils&#39;</span><span class="p">,</span>
</span><span class="p">]</span>

<span class="n">tests_require</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;WebTest &gt;= 1.3.1&#39;</span><span class="p">,</span>  <span class="c1"># py3 compat</span>
    <span class="s1">&#39;pytest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pytest-cov&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tutorial&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;myproj&#39;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">README</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">CHANGES</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Programming Language :: Python&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Framework :: Pyramid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Internet :: WWW/HTTP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Internet :: WWW/HTTP :: WSGI :: Application&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">keywords</span><span class="o">=</span><span class="s1">&#39;web pyramid pylons&#39;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">extras_require</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;testing&#39;</span><span class="p">:</span> <span class="n">tests_require</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;paste.app_factory&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;main = tutorial:main&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Only the highlighted line needs to be added.</p>
</div>
<div class="section" id="running-pip-install-e">
<span id="wiki-running-pip-install"></span><h2>Running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code><a class="headerlink" href="#running-pip-install-e" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Since a new software dependency was added, you will need to run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span>
<span class="pre">-e</span> <span class="pre">.</span></code> again inside the root of the <code class="docutils literal notranslate"><span class="pre">tutorial</span></code> package to obtain and register
the newly added dependency distribution.</p>
<p>Make sure your current working directory is the root of the project (the
directory in which <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> lives) and execute the following command.</p>
<p>On UNIX:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> tutorial
$ <span class="nv">$VENV</span>/bin/pip install -e .
</pre></div>
</div>
<p>On Windows:</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">c:\&gt;</span> <span class="k">cd</span> tutorial
<span class="gp">c:\tutorial&gt;</span> <span class="nv">%VENV%</span>\Scripts\pip install -e .
</pre></div>
</div>
<p>Success executing this command will end with a line to the console something
like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Successfully installed docutils-0.13.1 tutorial
</pre></div>
</div>
</div>
<div class="section" id="adding-view-functions-in-views-py">
<h2>Adding view functions in <code class="docutils literal notranslate"><span class="pre">views.py</span></code><a class="headerlink" href="#adding-view-functions-in-views-py" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>It's time for a major change.  Open <code class="docutils literal notranslate"><span class="pre">tutorial/views.py</span></code> and edit it to look
like the following:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.core</span> <span class="kn">import</span> <span class="n">publish_parts</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPFound</span>
<span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>

<span class="c1"># regular expression used to find WikiWords</span>
<span class="n">wikiwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b([A-Z]\w+[A-Z]+\w+)&quot;</span><span class="p">)</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_wiki</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;FrontPage&#39;</span><span class="p">))</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/view.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">wiki</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">__parent__</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">wiki</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">wiki</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
            <span class="n">view_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">view_url</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">application_url</span> <span class="o">+</span> <span class="s1">&#39;/add_page/&#39;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add_url</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">writer_name</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)[</span><span class="s1">&#39;html_body&#39;</span><span class="p">]</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">edit_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;edit_page&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">edit_url</span><span class="o">=</span><span class="n">edit_url</span><span class="p">)</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span>
             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">subpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">page</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">pagename</span>
        <span class="n">page</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">context</span>
        <span class="n">context</span><span class="p">[</span><span class="n">pagename</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
    <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">page</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">pagename</span>
    <span class="n">page</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">context</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">save_url</span><span class="o">=</span><span class="n">save_url</span><span class="p">)</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Page&#39;</span><span class="p">,</span>
             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">edit_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">context</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                <span class="n">save_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;edit_page&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>We added some imports and created a regular expression to find &quot;WikiWords&quot;.</p>
<p>We got rid of the <code class="docutils literal notranslate"><span class="pre">my_view</span></code> view function and its decorator that was added
when we originally rendered the <code class="docutils literal notranslate"><span class="pre">zodb</span></code> cookiecutter.  It was only an example and
isn't relevant to our application.</p>
<p>Then we added four <a class="reference internal" href="../../glossary.html#term-view-callable"><span class="xref std std-term">view callable</span></a> functions to our <code class="docutils literal notranslate"><span class="pre">views.py</span></code>
module:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">view_wiki()</span></code> - Displays the wiki itself. It will answer on the root URL.</li>
<li><code class="docutils literal notranslate"><span class="pre">view_page()</span></code> - Displays an individual page.</li>
<li><code class="docutils literal notranslate"><span class="pre">add_page()</span></code> - Allows the user to add a page.</li>
<li><code class="docutils literal notranslate"><span class="pre">edit_page()</span></code> - Allows the user to edit a page.</li>
</ul>
<p>We'll describe each one briefly in the following sections.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">There is nothing special about the filename <code class="docutils literal notranslate"><span class="pre">views.py</span></code>.  A project may
have many view callables throughout its codebase in arbitrarily named
files.  Files implementing view callables often have <code class="docutils literal notranslate"><span class="pre">view</span></code> in their
filenames (or may live in a Python subpackage of your application package
named <code class="docutils literal notranslate"><span class="pre">views</span></code>), but this is only by convention.</p>
</div>
<div class="section" id="the-view-wiki-view-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view function<a class="headerlink" href="#the-view-wiki-view-function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Following is the code for the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view function and its decorator:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_wiki</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;FrontPage&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">In our code, we use an <em>import</em> that is <em>relative</em> to our package
named <code class="docutils literal notranslate"><span class="pre">tutorial</span></code>, meaning we can omit the name of the package in the
<code class="docutils literal notranslate"><span class="pre">import</span></code> and <code class="docutils literal notranslate"><span class="pre">context</span></code> statements. In our narrative, however, we refer
to a <em>class</em> and thus we use the <em>absolute</em> form, meaning that the name of
the package is included.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">view_wiki()</span></code> is the <a class="reference internal" href="../../glossary.html#term-default-view"><span class="xref std std-term">default view</span></a> that gets called when a request is
made to the root URL of our wiki.  It always redirects to an URL which
represents the path to our &quot;FrontPage&quot;.</p>
<p>We provide it with a <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator which names the class
<code class="docutils literal notranslate"><span class="pre">tutorial.models.Wiki</span></code> as its context. This means that when a Wiki resource
is the context and no <a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> exists in the request, then this view
will be used.  The view configuration associated with <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> does not
use a <code class="docutils literal notranslate"><span class="pre">renderer</span></code> because the view callable always returns a <a class="reference internal" href="../../glossary.html#term-response"><span class="xref std std-term">response</span></a>
object rather than a dictionary. No renderer is necessary when a view returns
a response object.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view callable always redirects to the URL of a Page resource
named &quot;FrontPage&quot;.  To do so, it returns an instance of the
<a class="reference internal" href="../../api/httpexceptions.html#pyramid.httpexceptions.HTTPFound" title="pyramid.httpexceptions.HTTPFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPFound</span></code></a> class (instances of which implement
the <a class="reference internal" href="../../api/interfaces.html#pyramid.interfaces.IResponse" title="pyramid.interfaces.IResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.interfaces.IResponse</span></code></a> interface, like
<a class="reference internal" href="../../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a> does). It uses the
<a class="reference internal" href="../../api/request.html#pyramid.request.Request.route_url" title="pyramid.request.Request.route_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.request.Request.route_url()</span></code></a> API to construct an URL to the
<code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> page resource (i.e., <code class="docutils literal notranslate"><span class="pre">http://localhost:6543/FrontPage</span></code>), and
uses it as the &quot;location&quot; of the <code class="docutils literal notranslate"><span class="pre">HTTPFound</span></code> response, forming an HTTP
redirect.</p>
</div>
<div class="section" id="the-view-page-view-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view function<a class="headerlink" href="#the-view-page-view-function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Here is the code for the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view function and its decorator:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/view.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">wiki</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">__parent__</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">wiki</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">wiki</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
            <span class="n">view_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">view_url</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">application_url</span> <span class="o">+</span> <span class="s1">&#39;/add_page/&#39;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add_url</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">writer_name</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)[</span><span class="s1">&#39;html_body&#39;</span><span class="p">]</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">edit_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;edit_page&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">edit_url</span><span class="o">=</span><span class="n">edit_url</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal notranslate"><span class="pre">view_page</span></code> function is configured to respond as the default view
of a Page resource.  We provide it with a <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator which
names the class <code class="docutils literal notranslate"><span class="pre">tutorial.models.Page</span></code> as its context.  This means that
when a Page resource is the context, and no <a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> exists in the
request, this view will be used.  We inform <span>Pyramid</span> this view will use
the <code class="docutils literal notranslate"><span class="pre">templates/view.pt</span></code> template file as a <code class="docutils literal notranslate"><span class="pre">renderer</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">view_page</span></code> function generates the <a class="reference internal" href="../../glossary.html#term-restructuredtext"><span class="xref std std-term">reStructuredText</span></a> body of a
page (stored as the <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute of the context passed to the view; the
context will be a <code class="docutils literal notranslate"><span class="pre">Page</span></code> resource) as HTML.  Then it substitutes an HTML
anchor for each <em>WikiWord</em> reference in the rendered HTML using a compiled
regular expression.</p>
<p>The curried function named <code class="docutils literal notranslate"><span class="pre">check</span></code> is used as the first argument to
<code class="docutils literal notranslate"><span class="pre">wikiwords.sub</span></code>, indicating that it should be called to provide a value for
each WikiWord match found in the content.  If the wiki (our page's
<code class="docutils literal notranslate"><span class="pre">__parent__</span></code>) already contains a page with the matched WikiWord name, the
<code class="docutils literal notranslate"><span class="pre">check</span></code> function generates a view link to be used as the substitution value
and returns it.  If the wiki does not already contain a page with the
matched WikiWord name, the function generates an &quot;add&quot; link as the
substitution value and returns it.</p>
<p>As a result, the <code class="docutils literal notranslate"><span class="pre">content</span></code> variable is now a fully formed bit of HTML
containing various view and add links for WikiWords based on the content of
our current page resource.</p>
<p>We then generate an edit URL because it's easier to do here than in the
template, and we wrap up a number of arguments in a dictionary and return
it.</p>
<p>The arguments we wrap into a dictionary include <code class="docutils literal notranslate"><span class="pre">page</span></code>, <code class="docutils literal notranslate"><span class="pre">content</span></code>, and
<code class="docutils literal notranslate"><span class="pre">edit_url</span></code>.  As a result, the <em>template</em> associated with this view callable
(via <code class="docutils literal notranslate"><span class="pre">renderer=</span></code> in its configuration) will be able to use these names to
perform various rendering tasks.  The template associated with this view
callable will be a template which lives in <code class="docutils literal notranslate"><span class="pre">templates/view.pt</span></code>.</p>
<p>Note the contrast between this view callable and the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view
callable.  In the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view callable, we unconditionally return a
<a class="reference internal" href="../../glossary.html#term-response"><span class="xref std std-term">response</span></a> object.  In the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view callable, we return a
<em>dictionary</em>.  It is <em>always</em> fine to return a <a class="reference internal" href="../../glossary.html#term-response"><span class="xref std std-term">response</span></a> object from a
<span>Pyramid</span> view.  Returning a dictionary is allowed only when there is a
<a class="reference internal" href="../../glossary.html#term-renderer"><span class="xref std std-term">renderer</span></a> associated with the view callable in the view configuration.</p>
</div>
<div class="section" id="the-add-page-view-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view function<a class="headerlink" href="#the-add-page-view-function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Here is the code for the <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view function and its decorator:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span>
             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">subpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">page</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">pagename</span>
        <span class="n">page</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">context</span>
        <span class="n">context</span><span class="p">[</span><span class="n">pagename</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
    <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">page</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">pagename</span>
    <span class="n">page</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">context</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">save_url</span><span class="o">=</span><span class="n">save_url</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal notranslate"><span class="pre">add_page</span></code> function is configured to respond when the context resource
is a Wiki and the <a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> is <code class="docutils literal notranslate"><span class="pre">add_page</span></code>.  We provide it with a
<code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator which names the string <code class="docutils literal notranslate"><span class="pre">add_page</span></code> as its
<a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> (via <code class="docutils literal notranslate"><span class="pre">name=</span></code>), the class <code class="docutils literal notranslate"><span class="pre">tutorial.models.Wiki</span></code> as its
context, and the renderer named <code class="docutils literal notranslate"><span class="pre">templates/edit.pt</span></code>.  This means that when a
Wiki resource is the context, and a <a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> named <code class="docutils literal notranslate"><span class="pre">add_page</span></code>
exists as the result of traversal, this view will be used.  We inform
<span>Pyramid</span> this view will use the <code class="docutils literal notranslate"><span class="pre">templates/edit.pt</span></code> template file as a
<code class="docutils literal notranslate"><span class="pre">renderer</span></code>.  We share the same template between add and edit views, thus
<code class="docutils literal notranslate"><span class="pre">edit.pt</span></code> instead of <code class="docutils literal notranslate"><span class="pre">add.pt</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">add_page</span></code> function will be invoked when a user clicks on a WikiWord
which isn't yet represented as a page in the system.  The <code class="docutils literal notranslate"><span class="pre">check</span></code> function
within the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view generates URLs to this view.  It also acts as a
handler for the form that is generated when we want to add a page resource.
The <code class="docutils literal notranslate"><span class="pre">context</span></code> of the <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view is always a Wiki resource (<em>not</em> a
Page resource).</p>
<p>The request <a class="reference internal" href="../../glossary.html#term-subpath"><span class="xref std std-term">subpath</span></a> in <span>Pyramid</span> is the sequence of names that
are found <em>after</em> the <a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> in the URL segments given in the
<code class="docutils literal notranslate"><span class="pre">PATH_INFO</span></code> of the WSGI request as the result of <a class="reference internal" href="../../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a>.  If our
add view is invoked via, e.g., <code class="docutils literal notranslate"><span class="pre">http://localhost:6543/add_page/SomeName</span></code>,
the <a class="reference internal" href="../../glossary.html#term-subpath"><span class="xref std std-term">subpath</span></a> will be a tuple: <code class="docutils literal notranslate"><span class="pre">('SomeName',)</span></code>.</p>
<p>The add view takes the zero<sup>th</sup> element of the subpath (the wiki page name),
and aliases it to the name attribute in order to know the name of the page
we're trying to add.</p>
<p>If the view rendering is <em>not</em> a result of a form submission (if the
expression <code class="docutils literal notranslate"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>), the view
renders a template.  To do so, it generates a &quot;save url&quot; which the template
uses as the form post URL during rendering.  We're lazy here, so we're trying
to use the same template (<code class="docutils literal notranslate"><span class="pre">templates/edit.pt</span></code>) for the add view as well as
the page edit view.  To do so, we create a dummy Page resource object in
order to satisfy the edit form's desire to have <em>some</em> page object exposed as
<code class="docutils literal notranslate"><span class="pre">page</span></code>, and we'll render the template to a response.</p>
<p>If the view rendering <em>is</em> a result of a form submission (if the expression
<code class="docutils literal notranslate"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>), we grab the page body
from the form data, create a Page object using the name in the subpath and
the page body, and save it into &quot;our context&quot; (the Wiki) using the
<code class="docutils literal notranslate"><span class="pre">__setitem__</span></code> method of the context. We then redirect back to the
<code class="docutils literal notranslate"><span class="pre">view_page</span></code> view (the default view for a page) for the newly created page.</p>
</div>
<div class="section" id="the-edit-page-view-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view function<a class="headerlink" href="#the-edit-page-view-function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Here is the code for the <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view function and its decorator:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Page&#39;</span><span class="p">,</span>
             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">edit_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">context</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                <span class="n">save_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;edit_page&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> function is configured to respond when the context is
a Page resource and the <a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> is <code class="docutils literal notranslate"><span class="pre">edit_page</span></code>.  We provide it
with a <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator which names the string <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> as its
<a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> (via <code class="docutils literal notranslate"><span class="pre">name=</span></code>), the class <code class="docutils literal notranslate"><span class="pre">tutorial.models.Page</span></code> as its
context, and the renderer named <code class="docutils literal notranslate"><span class="pre">templates/edit.pt</span></code>.  This means that when
a Page resource is the context, and a <a class="reference internal" href="../../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> exists as the result
of traversal named <code class="docutils literal notranslate"><span class="pre">edit_page</span></code>, this view will be used.  We inform
<span>Pyramid</span> this view will use the <code class="docutils literal notranslate"><span class="pre">templates/edit.pt</span></code> template file as
a <code class="docutils literal notranslate"><span class="pre">renderer</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> function will be invoked when a user clicks the &quot;Edit this
Page&quot; button on the view form.  It renders an edit form but it also acts as
the form post view callable for the form it renders.  The <code class="docutils literal notranslate"><span class="pre">context</span></code> of the
<code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view will <em>always</em> be a Page resource (never a Wiki resource).</p>
<p>If the view execution is <em>not</em> a result of a form submission (if the
expression <code class="docutils literal notranslate"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>), the view
simply renders the edit form, passing the page resource, and a <code class="docutils literal notranslate"><span class="pre">save_url</span></code>
which will be used as the action of the generated form.</p>
<p>If the view execution <em>is</em> a result of a form submission (if the expression
<code class="docutils literal notranslate"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>), the view grabs the
<code class="docutils literal notranslate"><span class="pre">body</span></code> element of the request parameter and sets it as the <code class="docutils literal notranslate"><span class="pre">data</span></code>
attribute of the page context.  It then redirects to the default view of the
context (the page), which will always be the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view.</p>
</div>
</div>
<div class="section" id="adding-templates">
<h2>Adding templates<a class="headerlink" href="#adding-templates" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">view_page</span></code>, <code class="docutils literal notranslate"><span class="pre">add_page</span></code> and <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> views that we've added
reference a <a class="reference internal" href="../../glossary.html#term-template"><span class="xref std std-term">template</span></a>.  Each template is a <a class="reference internal" href="../../glossary.html#term-chameleon"><span class="xref std std-term">Chameleon</span></a>
<a class="reference internal" href="../../glossary.html#term-zpt"><span class="xref std std-term">ZPT</span></a> template.  These templates will live in the <code class="docutils literal notranslate"><span class="pre">templates</span></code>
directory of our tutorial package.  Chameleon templates must have a <code class="docutils literal notranslate"><span class="pre">.pt</span></code>
extension to be recognized as such.</p>
<div class="section" id="the-view-pt-template">
<h3>The <code class="docutils literal notranslate"><span class="pre">view.pt</span></code> template<a class="headerlink" href="#the-view-pt-template" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Rename <code class="docutils literal notranslate"><span class="pre">tutorial/templates/mytemplate.pt</span></code> to <code class="docutils literal notranslate"><span class="pre">tutorial/templates/view.pt</span></code> and edit the emphasized lines to look like the following:</p>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;${request.locale_name}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;pyramid web application&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;Pylons Project&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid-16x16.png&#39;)}&quot;</span><span class="p">&gt;</span>

<span class="hll">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>${page.__name__} - Pyramid tutorial wiki (based on
</span><span class="hll">    TurboGears 20-Minute Wiki)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span>
    <span class="c">&lt;!-- Bootstrap core CSS --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Custom styles for this scaffold --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/theme.css&#39;)}&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js&quot; integrity=&quot;sha384-0s5Pv64cNZJieYFkXYOTId2HMA2Lfb6q2nAcx2n0RTLUnCAoTTsS0nKEO27XyKcY&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js&quot; integrity=&quot;sha384-f1r2UzjsxZ9T4V1f2zBO/evUqSEOpeaUUZcMTz1Up63bl4ruYnFYeM+BxI4NhyI0&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;starter-template&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-2&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;logo img-responsive&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid.png&#39;)}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;pyramid web framework&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
<span class="hll">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">tal:replace</span><span class="o">=</span><span class="s">&quot;structure content&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                Page text goes here.
</span><span class="hll">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span class="hll">              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">tal:attributes</span><span class="o">=</span><span class="s">&quot;href edit_url&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                  Edit this page
</span><span class="hll">                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span><span class="hll">              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">                  Viewing <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">tal:replace</span><span class="o">=</span><span class="s">&quot;page.__name__&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                  Page Name Goes Here<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
</span><span class="hll">              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can return to the
</span><span class="hll">                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.application_url}&quot;</span><span class="p">&gt;</span>FrontPage<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
</span><span class="hll">              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span>          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;copyright&quot;</span><span class="p">&gt;</span>
            Copyright <span class="ni">&amp;copy;</span> Pylons Project
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


    <span class="c">&lt;!-- Bootstrap core JavaScript</span>
<span class="c">    ================================================== --&gt;</span>
    <span class="c">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/jquery/1.10.2/jquery.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-aBL3Lzi6c9LNDGvpHkZrrm3ZVsIwohDD7CDozL0pk8FwCrfmV7H9w8j3L7ikEv6h&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This template is used by <code class="docutils literal notranslate"><span class="pre">view_page()</span></code> for displaying a single
wiki page. It includes:</p>
<ul class="simple">
<li>A <code class="docutils literal notranslate"><span class="pre">div</span></code> element that is replaced with the <code class="docutils literal notranslate"><span class="pre">content</span></code> value provided by
the view (lines 37-39).  <code class="docutils literal notranslate"><span class="pre">content</span></code> contains HTML, so the <code class="docutils literal notranslate"><span class="pre">structure</span></code>
keyword is used to prevent escaping it (i.e., changing &quot;&gt;&quot; to &quot;&amp;gt;&quot;, etc.)</li>
<li>A link that points at the &quot;edit&quot; URL which invokes the <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view
for the page being viewed (lines 41-43).</li>
</ul>
</div>
<div class="section" id="the-edit-pt-template">
<h3>The <code class="docutils literal notranslate"><span class="pre">edit.pt</span></code> template<a class="headerlink" href="#the-edit-pt-template" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Copy <code class="docutils literal notranslate"><span class="pre">tutorial/templates/view.pt</span></code> to <code class="docutils literal notranslate"><span class="pre">tutorial/templates/edit.pt</span></code> and edit the emphasized lines to look like the following:</p>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;${request.locale_name}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;pyramid web application&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;Pylons Project&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid-16x16.png&#39;)}&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>${page.__name__} - Pyramid tutorial wiki (based on
    TurboGears 20-Minute Wiki)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Bootstrap core CSS --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Custom styles for this scaffold --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/theme.css&#39;)}&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js&quot; integrity=&quot;sha384-0s5Pv64cNZJieYFkXYOTId2HMA2Lfb6q2nAcx2n0RTLUnCAoTTsS0nKEO27XyKcY&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js&quot; integrity=&quot;sha384-f1r2UzjsxZ9T4V1f2zBO/evUqSEOpeaUUZcMTz1Up63bl4ruYnFYeM+BxI4NhyI0&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;starter-template&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-2&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;logo img-responsive&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid.png&#39;)}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;pyramid web framework&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                  Editing <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">tal:replace</span><span class="o">=</span><span class="s">&quot;page.__name__&quot;</span><span class="p">&gt;</span>
                  Page Name Goes Here<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can return to the
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.application_url}&quot;</span><span class="p">&gt;</span>FrontPage<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;${save_url}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;body&quot;</span> <span class="na">tal:content</span><span class="o">=</span><span class="s">&quot;page.data&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;60&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;form.submitted&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Save&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span><span class="p">&gt;</span>Save<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;copyright&quot;</span><span class="p">&gt;</span>
            Copyright <span class="ni">&amp;copy;</span> Pylons Project
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


    <span class="c">&lt;!-- Bootstrap core JavaScript</span>
<span class="c">    ================================================== --&gt;</span>
    <span class="c">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/jquery/1.10.2/jquery.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-aBL3Lzi6c9LNDGvpHkZrrm3ZVsIwohDD7CDozL0pk8FwCrfmV7H9w8j3L7ikEv6h&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This template is used by <code class="docutils literal notranslate"><span class="pre">add_page()</span></code> and <code class="docutils literal notranslate"><span class="pre">edit_page()</span></code> for adding and
editing a wiki page.  It displays a page containing a form that includes:</p>
<ul class="simple">
<li>A 10-row by 60-column <code class="docutils literal notranslate"><span class="pre">textarea</span></code> field named <code class="docutils literal notranslate"><span class="pre">body</span></code> that is filled
with any existing page data when it is rendered (line 46).</li>
<li>A submit button that has the name <code class="docutils literal notranslate"><span class="pre">form.submitted</span></code> (line 49).</li>
</ul>
<p>The form POSTs back to the <code class="docutils literal notranslate"><span class="pre">save_url</span></code> argument supplied by the view (line
44).  The view will use the <code class="docutils literal notranslate"><span class="pre">body</span></code> and <code class="docutils literal notranslate"><span class="pre">form.submitted</span></code> values.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Our templates use a <code class="docutils literal notranslate"><span class="pre">request</span></code> object that none of our tutorial
views return in their dictionary. <code class="docutils literal notranslate"><span class="pre">request</span></code> is one of several names that
are available &quot;by default&quot; in a template when a template renderer is used.
See <a class="reference internal" href="../../narr/templates.html#renderer-system-values"><span class="std std-ref">System Values Used During Rendering</span></a> for information about other names that
are available by default when a template is used as a renderer.</p>
</div>
</div>
<div class="section" id="static-assets">
<h3>Static assets<a class="headerlink" href="#static-assets" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Our templates name static assets, including CSS and images.  We don't need
to create these files within our package's <code class="docutils literal notranslate"><span class="pre">static</span></code> directory because they
were provided at the time we created the project.</p>
<p>As an example, the CSS file will be accessed via
<code class="docutils literal notranslate"><span class="pre">http://localhost:6543/static/theme.css</span></code> by virtue of the call to the
<code class="docutils literal notranslate"><span class="pre">add_static_view</span></code> directive we've made in the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file.  Any
number and type of static assets can be placed in this directory (or
subdirectories) and are just referred to by URL or by using the convenience
method <code class="docutils literal notranslate"><span class="pre">static_url</span></code>, e.g.,
<code class="docutils literal notranslate"><span class="pre">request.static_url('&lt;package&gt;:static/foo.css')</span></code> within templates.</p>
</div>
</div>
<div class="section" id="viewing-the-application-in-a-browser">
<h2>Viewing the application in a browser<a class="headerlink" href="#viewing-the-application-in-a-browser" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We can finally examine our application in a browser (See
<a class="reference internal" href="installation.html#wiki-start-the-application"><span class="std std-ref">Start the application</span></a>).  Launch a browser and visit
each of the following URLs, checking that the result is as expected:</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/">http://localhost:6543/</a> invokes the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view.  This always
redirects to the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view of the <code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> Page resource.</li>
<li><a class="reference external" href="http://localhost:6543/FrontPage/">http://localhost:6543/FrontPage/</a> invokes the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view of the front
page resource.  This is because it's the <a class="reference internal" href="../../glossary.html#term-default-view"><span class="xref std std-term">default view</span></a> (a view
without a <code class="docutils literal notranslate"><span class="pre">name</span></code>) for Page resources.</li>
<li><a class="reference external" href="http://localhost:6543/FrontPage/edit_page">http://localhost:6543/FrontPage/edit_page</a> invokes the edit view for the
<code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> Page resource.</li>
<li><a class="reference external" href="http://localhost:6543/add_page/SomePageName">http://localhost:6543/add_page/SomePageName</a> invokes the add view for a Page.</li>
<li>To generate an error, visit <a class="reference external" href="http://localhost:6543/add_page">http://localhost:6543/add_page</a> which will
generate an <code class="docutils literal notranslate"><span class="pre">IndexError:</span> <span class="pre">tuple</span> <span class="pre">index</span> <span class="pre">out</span> <span class="pre">of</span> <span class="pre">range</span></code> error. You'll see an
interactive traceback facility provided by <a class="reference internal" href="../../glossary.html#term-pyramid-debugtoolbar"><span class="xref std std-term">pyramid_debugtoolbar</span></a>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining Views</a><ul>
<li><a class="reference internal" href="#declaring-dependencies-in-our-setup-py-file">Declaring Dependencies in Our <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> File</a></li>
<li><a class="reference internal" href="#running-pip-install-e">Running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code></a></li>
<li><a class="reference internal" href="#adding-view-functions-in-views-py">Adding view functions in <code class="docutils literal notranslate"><span class="pre">views.py</span></code></a><ul>
<li><a class="reference internal" href="#the-view-wiki-view-function">The <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view function</a></li>
<li><a class="reference internal" href="#the-view-page-view-function">The <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view function</a></li>
<li><a class="reference internal" href="#the-add-page-view-function">The <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view function</a></li>
<li><a class="reference internal" href="#the-edit-page-view-function">The <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-templates">Adding templates</a><ul>
<li><a class="reference internal" href="#the-view-pt-template">The <code class="docutils literal notranslate"><span class="pre">view.pt</span></code> template</a></li>
<li><a class="reference internal" href="#the-edit-pt-template">The <code class="docutils literal notranslate"><span class="pre">edit.pt</span></code> template</a></li>
<li><a class="reference internal" href="#static-assets">Static assets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#viewing-the-application-in-a-browser">Viewing the application in a browser</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="definingmodels.html"
                        title="前の章へ">Defining the Domain Model</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="authorization.html"
                        title="次の章へ">Adding authorization</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/tutorials/wiki/definingviews.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="authorization.html" title="Adding authorization"
             >次へ</a> |</li>
        <li class="right" >
          <a href="definingmodels.html" title="Defining the Domain Model"
             >前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >ZODB + Traversal Wiki Tutorial</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 10月 28, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1 で生成しました。
    </div>
  </body>
</html>