
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Adding authorization &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="copyright" title="著作権" href="../../copyright.html" />
    <link rel="next" title="Adding Tests" href="tests.html" />
    <link rel="prev" title="Defining Views" href="definingviews.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../../index.html">
      		<img class="logo" src="../../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="tests.html" title="Adding Tests"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="definingviews.html" title="Defining Views"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">ZODB + Traversal Wiki Tutorial</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="adding-authorization">
<span id="wiki-adding-authorization"></span><h1>Adding authorization<a class="headerlink" href="#adding-authorization" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><span>Pyramid</span> provides facilities for <a class="reference internal" href="../../glossary.html#term-authentication"><span class="xref std std-term">authentication</span></a> and
<a class="reference internal" href="../../glossary.html#term-authorization"><span class="xref std std-term">authorization</span></a>. We'll make use of both features to provide security to
our application. Our application currently allows anyone with access to the
server to view, edit, and add pages to our wiki. We'll change that to allow
only people who are members of a <em>group</em> named <code class="docutils literal notranslate"><span class="pre">group:editors</span></code> to add and
edit wiki pages, but we'll continue allowing anyone with access to the server
to view pages.</p>
<p>We will also add a login page and a logout link on all the pages.  The login
page will be shown when a user is denied access to any of the views that
require permission, instead of a default &quot;403 Forbidden&quot; page.</p>
<p>We will implement the access control with the following steps:</p>
<ul class="simple">
<li>Add password hashing dependencies.</li>
<li>Add users and groups (<code class="docutils literal notranslate"><span class="pre">security.py</span></code>, a new module).</li>
<li>Add an <a class="reference internal" href="../../glossary.html#term-acl"><span class="xref std std-term">ACL</span></a> (<code class="docutils literal notranslate"><span class="pre">models.py</span></code>).</li>
<li>Add an <a class="reference internal" href="../../glossary.html#term-authentication-policy"><span class="xref std std-term">authentication policy</span></a> and an <a class="reference internal" href="../../glossary.html#term-authorization-policy"><span class="xref std std-term">authorization policy</span></a>
(<code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>).</li>
<li>Add <a class="reference internal" href="../../glossary.html#term-permission"><span class="xref std std-term">permission</span></a> declarations to the <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> and <code class="docutils literal notranslate"><span class="pre">add_page</span></code>
views (<code class="docutils literal notranslate"><span class="pre">views.py</span></code>).</li>
</ul>
<p>Then we will add the login and logout features:</p>
<ul class="simple">
<li>Add <code class="docutils literal notranslate"><span class="pre">login</span></code> and <code class="docutils literal notranslate"><span class="pre">logout</span></code> views (<code class="docutils literal notranslate"><span class="pre">views.py</span></code>).</li>
<li>Add a login template (<code class="docutils literal notranslate"><span class="pre">login.pt</span></code>).</li>
<li>Make the existing views return a <code class="docutils literal notranslate"><span class="pre">logged_in</span></code> flag to the renderer
(<code class="docutils literal notranslate"><span class="pre">views.py</span></code>).</li>
<li>Add a &quot;Logout&quot; link to be shown when logged in and viewing or editing a page
(<code class="docutils literal notranslate"><span class="pre">view.pt</span></code>, <code class="docutils literal notranslate"><span class="pre">edit.pt</span></code>).</li>
</ul>
<div class="section" id="access-control">
<h2>Access control<a class="headerlink" href="#access-control" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="add-dependencies">
<h3>Add dependencies<a class="headerlink" href="#add-dependencies" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Just like in <a class="reference internal" href="definingviews.html#wiki-defining-views"><span class="std std-ref">Defining Views</span></a>, we need a new dependency. We need to add the <a class="reference external" href="https://pypi.org/project/bcrypt/">bcrypt</a> package, to our tutorial package's <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file by assigning this dependency to the <code class="docutils literal notranslate"><span class="pre">requires</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function.</p>
<p>Open <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> and edit it to look like the following:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;README.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">README</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;CHANGES.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">CHANGES</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;plaster_pastedeploy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid &gt;= 1.9a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_chameleon&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_debugtoolbar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_retry&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_tm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_zodbconn&#39;</span><span class="p">,</span>
    <span class="s1">&#39;transaction&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ZODB3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;waitress&#39;</span><span class="p">,</span>
    <span class="s1">&#39;docutils&#39;</span><span class="p">,</span>
<span class="hll">    <span class="s1">&#39;bcrypt&#39;</span><span class="p">,</span>
</span><span class="p">]</span>

<span class="n">tests_require</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;WebTest &gt;= 1.3.1&#39;</span><span class="p">,</span>  <span class="c1"># py3 compat</span>
    <span class="s1">&#39;pytest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pytest-cov&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tutorial&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;myproj&#39;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">README</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">CHANGES</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Programming Language :: Python&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Framework :: Pyramid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Internet :: WWW/HTTP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Internet :: WWW/HTTP :: WSGI :: Application&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">keywords</span><span class="o">=</span><span class="s1">&#39;web pyramid pylons&#39;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">extras_require</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;testing&#39;</span><span class="p">:</span> <span class="n">tests_require</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;paste.app_factory&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;main = tutorial:main&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Only the highlighted line needs to be added.</p>
<p>Do not forget to run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code> just like in <a class="reference internal" href="definingviews.html#wiki-running-pip-install"><span class="std std-ref">Running pip install -e .</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">We are using the <code class="docutils literal notranslate"><span class="pre">bcrypt</span></code> package from PyPI to hash our passwords securely. There are other one-way hash algorithms for passwords if bcrypt is an issue on your system. Just make sure that it's an algorithm approved for storing passwords versus a generic one-way hash.</p>
</div>
</div>
<div class="section" id="add-users-and-groups">
<h3>Add users and groups<a class="headerlink" href="#add-users-and-groups" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Create a new <code class="docutils literal notranslate"><span class="pre">tutorial/security.py</span></code> module with the following content:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bcrypt</span>


<span class="k">def</span> <span class="nf">hash_password</span><span class="p">(</span><span class="n">pw</span><span class="p">):</span>
    <span class="n">hashed_pw</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">hashpw</span><span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">gensalt</span><span class="p">())</span>
    <span class="c1"># return unicode instead of bytes because databases handle it better</span>
    <span class="k">return</span> <span class="n">hashed_pw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">check_password</span><span class="p">(</span><span class="n">expected_hash</span><span class="p">,</span> <span class="n">pw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">expected_hash</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">checkpw</span><span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">expected_hash</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="n">USERS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;editor&#39;</span><span class="p">:</span> <span class="n">hash_password</span><span class="p">(</span><span class="s1">&#39;editor&#39;</span><span class="p">),</span>
          <span class="s1">&#39;viewer&#39;</span><span class="p">:</span> <span class="n">hash_password</span><span class="p">(</span><span class="s1">&#39;viewer&#39;</span><span class="p">)}</span>
<span class="n">GROUPS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;editor&#39;</span><span class="p">:[</span><span class="s1">&#39;group:editors&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">groupfinder</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">userid</span> <span class="ow">in</span> <span class="n">USERS</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GROUPS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="p">[])</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal notranslate"><span class="pre">groupfinder</span></code> function accepts a userid and a request and
returns one of these values:</p>
<ul class="simple">
<li>If <code class="docutils literal notranslate"><span class="pre">userid</span></code> exists in the system, it will return a sequence of group
identifiers (or an empty sequence if the user isn't a member of any groups).</li>
<li>If the userid <em>does not</em> exist in the system, it will return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</li>
</ul>
<p>For example, <code class="docutils literal notranslate"><span class="pre">groupfinder('editor',</span> <span class="pre">request</span> <span class="pre">)</span></code> returns <code class="docutils literal notranslate"><span class="pre">['group:editor']</span></code>,
<code class="docutils literal notranslate"><span class="pre">groupfinder('viewer',</span> <span class="pre">request)</span></code> returns <code class="docutils literal notranslate"><span class="pre">[]</span></code>, and <code class="docutils literal notranslate"><span class="pre">groupfinder('admin',</span>
<span class="pre">request)</span></code> returns <code class="docutils literal notranslate"><span class="pre">None</span></code>.  We will use <code class="docutils literal notranslate"><span class="pre">groupfinder()</span></code> as an
<a class="reference internal" href="../../glossary.html#term-authentication-policy"><span class="xref std std-term">authentication policy</span></a> &quot;callback&quot; that will provide the
<a class="reference internal" href="../../glossary.html#term-principal"><span class="xref std std-term">principal</span></a> or principals for a user.</p>
<p>There are two helper methods that will help us later to authenticate users.
The first is <code class="docutils literal notranslate"><span class="pre">hash_password</span></code> which takes a raw password and transforms it using
bcrypt into an irreversible representation, a process known as &quot;hashing&quot;. The
second method, <code class="docutils literal notranslate"><span class="pre">check_password</span></code>, will allow us to compare the hashed value of the
submitted password against the hashed value of the password stored in the user's
record. If the two hashed values match, then the submitted
password is valid, and we can authenticate the user.</p>
<p>We hash passwords so that it is impossible to decrypt and use them to
authenticate in the application. If we stored passwords foolishly in clear text,
then anyone with access to the database could retrieve any password to authenticate
as any user.</p>
<p>In a production system, user and group data will most often be saved and come from a
database, but here we use &quot;dummy&quot; data to represent user and groups sources.</p>
</div>
<div class="section" id="add-an-acl">
<h3>Add an ACL<a class="headerlink" href="#add-an-acl" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">tutorial/models.py</span></code> and add the following import
statement near the top:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.security</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Allow</span><span class="p">,</span>
    <span class="n">Everyone</span><span class="p">,</span>
    <span class="p">)</span>

</pre></div>
</td></tr></table></div>
<p>Add the following lines to the <code class="docutils literal notranslate"><span class="pre">Wiki</span></code> class:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Wiki</span><span class="p">(</span><span class="n">PersistentMapping</span><span class="p">):</span>
    <span class="vm">__name__</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__parent__</span> <span class="o">=</span> <span class="bp">None</span>
<span class="hll">    <span class="n">__acl__</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">Allow</span><span class="p">,</span> <span class="n">Everyone</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
</span><span class="hll">                <span class="p">(</span><span class="n">Allow</span><span class="p">,</span> <span class="s1">&#39;group:editors&#39;</span><span class="p">,</span> <span class="s1">&#39;edit&#39;</span><span class="p">)</span> <span class="p">]</span>
</span></pre></div>
</td></tr></table></div>
<p>We import <a class="reference internal" href="../../api/security.html#pyramid.security.Allow" title="pyramid.security.Allow"><code class="xref py py-data docutils literal notranslate"><span class="pre">Allow</span></code></a>, an action that means that
permission is allowed, and <a class="reference internal" href="../../api/security.html#pyramid.security.Everyone" title="pyramid.security.Everyone"><code class="xref py py-data docutils literal notranslate"><span class="pre">Everyone</span></code></a>, a special
<a class="reference internal" href="../../glossary.html#term-principal"><span class="xref std std-term">principal</span></a> that is associated to all requests.  Both are used in the
<a class="reference internal" href="../../glossary.html#term-ace"><span class="xref std std-term">ACE</span></a> entries that make up the ACL.</p>
<p>The ACL is a list that needs to be named <code class="docutils literal notranslate"><span class="pre">__acl__</span></code> and be an attribute of a
class.  We define an <a class="reference internal" href="../../glossary.html#term-acl"><span class="xref std std-term">ACL</span></a> with two <a class="reference internal" href="../../glossary.html#term-ace"><span class="xref std std-term">ACE</span></a> entries: the first entry
allows any user the <code class="docutils literal notranslate"><span class="pre">view</span></code> permission.  The second entry allows the
<code class="docutils literal notranslate"><span class="pre">group:editors</span></code> principal the <code class="docutils literal notranslate"><span class="pre">edit</span></code> permission.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Wiki</span></code> class that contains the ACL is the <a class="reference internal" href="../../glossary.html#term-resource"><span class="xref std std-term">resource</span></a> constructor
for the <a class="reference internal" href="../../glossary.html#term-root"><span class="xref std std-term">root</span></a> resource, which is a <code class="docutils literal notranslate"><span class="pre">Wiki</span></code> instance.  The ACL is
provided to each view in the <a class="reference internal" href="../../glossary.html#term-context"><span class="xref std std-term">context</span></a> of the request as the <code class="docutils literal notranslate"><span class="pre">context</span></code>
attribute.</p>
<p>It's only happenstance that we're assigning this ACL at class scope.  An ACL
can be attached to an object <em>instance</em> too; this is how &quot;row level security&quot;
can be achieved in <span>Pyramid</span> applications.  We actually need only <em>one</em>
ACL for the entire system, however, because our security requirements are
simple, so this feature is not demonstrated.  See <a class="reference internal" href="../../narr/security.html#assigning-acls"><span class="std std-ref">Assigning ACLs to Your Resource Objects</span></a> for
more information about what an <a class="reference internal" href="../../glossary.html#term-acl"><span class="xref std std-term">ACL</span></a> represents.</p>
</div>
<div class="section" id="add-authentication-and-authorization-policies">
<h3>Add authentication and authorization policies<a class="headerlink" href="#add-authentication-and-authorization-policies" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">tutorial/__init__.py</span></code> and add the highlighted import
statements:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid_zodbconn</span> <span class="kn">import</span> <span class="n">get_connection</span>
<span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">pyramid.authentication</span> <span class="kn">import</span> <span class="n">AuthTktAuthenticationPolicy</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">pyramid.authorization</span> <span class="kn">import</span> <span class="n">ACLAuthorizationPolicy</span>
</span><span class="hll">
</span><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">appmaker</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.security</span> <span class="kn">import</span> <span class="n">groupfinder</span>
</span></pre></div>
</td></tr></table></div>
<p>Now add those policies to the configuration:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tm.manager_hook&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pyramid_tm.explicit_manager&#39;</span>
<span class="hll">    <span class="n">authn_policy</span> <span class="o">=</span> <span class="n">AuthTktAuthenticationPolicy</span><span class="p">(</span>
</span><span class="hll">        <span class="s1">&#39;sosecret&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">groupfinder</span><span class="p">,</span> <span class="n">hashalg</span><span class="o">=</span><span class="s1">&#39;sha512&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">authz_policy</span> <span class="o">=</span> <span class="n">ACLAuthorizationPolicy</span><span class="p">()</span>
</span>    <span class="k">with</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span> <span class="k">as</span> <span class="n">config</span><span class="p">:</span>
<span class="hll">        <span class="n">config</span><span class="o">.</span><span class="n">set_authentication_policy</span><span class="p">(</span><span class="n">authn_policy</span><span class="p">)</span>
</span><span class="hll">        <span class="n">config</span><span class="o">.</span><span class="n">set_authorization_policy</span><span class="p">(</span><span class="n">authz_policy</span><span class="p">)</span>
</span>        <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Only the highlighted lines need to be added.</p>
<p>We are enabling an <code class="docutils literal notranslate"><span class="pre">AuthTktAuthenticationPolicy</span></code>, which is based in an auth
ticket that may be included in the request. We are also enabling an
<code class="docutils literal notranslate"><span class="pre">ACLAuthorizationPolicy</span></code>, which uses an ACL to determine the <em>allow</em> or
<em>deny</em> outcome for a view.</p>
<p>Note that the <a class="reference internal" href="../../api/authentication.html#pyramid.authentication.AuthTktAuthenticationPolicy" title="pyramid.authentication.AuthTktAuthenticationPolicy"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.authentication.AuthTktAuthenticationPolicy</span></code></a>
constructor accepts two arguments: <code class="docutils literal notranslate"><span class="pre">secret</span></code> and <code class="docutils literal notranslate"><span class="pre">callback</span></code>.  <code class="docutils literal notranslate"><span class="pre">secret</span></code> is
a string representing an encryption key used by the &quot;authentication ticket&quot;
machinery represented by this policy: it is required.  The <code class="docutils literal notranslate"><span class="pre">callback</span></code> is the
<code class="docutils literal notranslate"><span class="pre">groupfinder()</span></code> function that we created before.</p>
</div>
<div class="section" id="add-permission-declarations">
<h3>Add permission declarations<a class="headerlink" href="#add-permission-declarations" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">tutorial/views.py</span></code> and add a <code class="docutils literal notranslate"><span class="pre">permission='edit'</span></code> parameter
to the <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorators for <code class="docutils literal notranslate"><span class="pre">add_page()</span></code> and <code class="docutils literal notranslate"><span class="pre">edit_page()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span>
<span class="hll">             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.pt&#39;</span><span class="p">,</span>
</span><span class="hll">             <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;edit&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Page&#39;</span><span class="p">,</span>
<span class="hll">             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.pt&#39;</span><span class="p">,</span>
</span><span class="hll">             <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;edit&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Only the highlighted lines, along with their preceding commas, need to be
edited and added.</p>
<p>The result is that only users who possess the <code class="docutils literal notranslate"><span class="pre">edit</span></code> permission at the time
of the request may invoke those two views.</p>
<p>Add a <code class="docutils literal notranslate"><span class="pre">permission='view'</span></code> parameter to the <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator for
<code class="docutils literal notranslate"><span class="pre">view_wiki()</span></code> and <code class="docutils literal notranslate"><span class="pre">view_page()</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span>
</span><span class="hll">             <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/view.pt&#39;</span><span class="p">,</span>
</span><span class="hll">             <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Only the highlighted lines, along with their preceding commas, need to be
edited and added.</p>
<p>This allows anyone to invoke these two views.</p>
<p>We are done with the changes needed to control access.  The changes that
follow will add the login and logout feature.</p>
</div>
</div>
<div class="section" id="login-logout">
<h2>Login, logout<a class="headerlink" href="#login-logout" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="add-login-and-logout-views">
<h3>Add login and logout views<a class="headerlink" href="#add-login-and-logout-views" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>We'll add a <code class="docutils literal notranslate"><span class="pre">login</span></code> view which renders a login form and processes the post
from the login form, checking credentials.</p>
<p>We'll also add a <code class="docutils literal notranslate"><span class="pre">logout</span></code> view callable to our application and provide a
link to it.  This view will clear the credentials of the logged in user and
redirect back to the front page.</p>
<p>Add the following import statements to the head of
<code class="docutils literal notranslate"><span class="pre">tutorial/views.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="p">(</span>
</span><span class="hll">    <span class="n">view_config</span><span class="p">,</span>
</span><span class="hll">    <span class="n">forbidden_view_config</span><span class="p">,</span>
</span><span class="hll">    <span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">pyramid.security</span> <span class="kn">import</span> <span class="p">(</span>
</span><span class="hll">    <span class="n">remember</span><span class="p">,</span>
</span><span class="hll">    <span class="n">forget</span><span class="p">,</span>
</span><span class="hll">    <span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">.security</span> <span class="kn">import</span> <span class="n">USERS</span><span class="p">,</span> <span class="n">check_password</span>
</span></pre></div>
</div>
<p>All the highlighted lines need to be added or edited.</p>
<p><a class="reference internal" href="../../api/view.html#pyramid.view.forbidden_view_config" title="pyramid.view.forbidden_view_config"><code class="xref py py-meth docutils literal notranslate"><span class="pre">forbidden_view_config()</span></code></a> will be used to customize the
default 403 Forbidden page. <a class="reference internal" href="../../api/security.html#pyramid.security.remember" title="pyramid.security.remember"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remember()</span></code></a> and
<a class="reference internal" href="../../api/security.html#pyramid.security.forget" title="pyramid.security.forget"><code class="xref py py-meth docutils literal notranslate"><span class="pre">forget()</span></code></a> help to create and expire an auth ticket
cookie.</p>
<p>Now add the <code class="docutils literal notranslate"><span class="pre">login</span></code> and <code class="docutils literal notranslate"><span class="pre">logout</span></code> views at the end of the file:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">,</span>
             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/login.pt&#39;</span><span class="p">)</span>
<span class="nd">@forbidden_view_config</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/login.pt&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">login_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">)</span>
    <span class="n">referrer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span>
    <span class="k">if</span> <span class="n">referrer</span> <span class="o">==</span> <span class="n">login_url</span><span class="p">:</span>
        <span class="n">referrer</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>  <span class="c1"># never use the login form itself as came_from</span>
    <span class="n">came_from</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;came_from&#39;</span><span class="p">,</span> <span class="n">referrer</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">login</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">login</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">check_password</span><span class="p">(</span><span class="n">USERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">login</span><span class="p">),</span> <span class="n">password</span><span class="p">):</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">remember</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">login</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">came_from</span><span class="p">,</span>
                             <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Failed login&#39;</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">application_url</span> <span class="o">+</span> <span class="s1">&#39;/login&#39;</span><span class="p">,</span>
        <span class="n">came_from</span><span class="o">=</span><span class="n">came_from</span><span class="p">,</span>
        <span class="n">login</span><span class="o">=</span><span class="n">login</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
    <span class="p">)</span>


<span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">forget</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
                     <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal notranslate"><span class="pre">login()</span></code> has two decorators:</p>
<ul class="simple">
<li>a <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator which associates it with the <code class="docutils literal notranslate"><span class="pre">login</span></code> route
and makes it visible when we visit <code class="docutils literal notranslate"><span class="pre">/login</span></code>,</li>
<li>a <code class="docutils literal notranslate"><span class="pre">&#64;forbidden_view_config</span></code> decorator which turns it into a
<a class="reference internal" href="../../glossary.html#term-forbidden-view"><span class="xref std std-term">forbidden view</span></a>. <code class="docutils literal notranslate"><span class="pre">login()</span></code> will be invoked when a user tries to
execute a view callable for which they lack authorization.  For example, if
a user has not logged in and tries to add or edit a Wiki page, they will be
shown the login form before being allowed to continue.</li>
</ul>
<p>The order of these two <a class="reference internal" href="../../glossary.html#term-view-configuration"><span class="xref std std-term">view configuration</span></a> decorators is unimportant.</p>
<p><code class="docutils literal notranslate"><span class="pre">logout()</span></code> is decorated with a <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator which associates
it with the <code class="docutils literal notranslate"><span class="pre">logout</span></code> route.  It will be invoked when we visit <code class="docutils literal notranslate"><span class="pre">/logout</span></code>.</p>
</div>
<div class="section" id="add-the-login-pt-template">
<h3>Add the <code class="docutils literal notranslate"><span class="pre">login.pt</span></code> Template<a class="headerlink" href="#add-the-login-pt-template" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Create <code class="docutils literal notranslate"><span class="pre">tutorial/templates/login.pt</span></code> with the following content:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;${request.locale_name}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;pyramid web application&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;Pylons Project&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid-16x16.png&#39;)}&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Login - Pyramid tutorial wiki (based on
    TurboGears 20-Minute Wiki)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Bootstrap core CSS --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Custom styles for this scaffold --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/theme.css&#39;)}&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js&quot; integrity=&quot;sha384-0s5Pv64cNZJieYFkXYOTId2HMA2Lfb6q2nAcx2n0RTLUnCAoTTsS0nKEO27XyKcY&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js&quot; integrity=&quot;sha384-f1r2UzjsxZ9T4V1f2zBO/evUqSEOpeaUUZcMTz1Up63bl4ruYnFYeM+BxI4NhyI0&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;starter-template&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-2&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;logo img-responsive&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid.png&#39;)}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;pyramid web framework&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>
                  Login
                <span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">tal:replace</span><span class="o">=</span><span class="s">&quot;message&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;${url}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;came_from&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;${came_from}&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>Username<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;login&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;${login}&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span>Password<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;${password}&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;form.submitted&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Log In&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span><span class="p">&gt;</span>Log In<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;copyright&quot;</span><span class="p">&gt;</span>
            Copyright <span class="ni">&amp;copy;</span> Pylons Project
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


    <span class="c">&lt;!-- Bootstrap core JavaScript</span>
<span class="c">    ================================================== --&gt;</span>
    <span class="c">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/jquery/1.10.2/jquery.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-aBL3Lzi6c9LNDGvpHkZrrm3ZVsIwohDD7CDozL0pk8FwCrfmV7H9w8j3L7ikEv6h&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The above template is referenced in the login view that we just added in
<code class="docutils literal notranslate"><span class="pre">views.py</span></code>.</p>
</div>
<div class="section" id="return-a-logged-in-flag-to-the-renderer">
<h3>Return a <code class="docutils literal notranslate"><span class="pre">logged_in</span></code> flag to the renderer<a class="headerlink" href="#return-a-logged-in-flag-to-the-renderer" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">tutorial/views.py</span></code> again. Add a <code class="docutils literal notranslate"><span class="pre">logged_in</span></code> parameter to
the return value of <code class="docutils literal notranslate"><span class="pre">view_page()</span></code>, <code class="docutils literal notranslate"><span class="pre">add_page()</span></code>, and <code class="docutils literal notranslate"><span class="pre">edit_page()</span></code> as
follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">edit_url</span><span class="o">=</span><span class="n">edit_url</span><span class="p">,</span>
</span><span class="hll">                <span class="n">logged_in</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">authenticated_userid</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">save_url</span><span class="o">=</span><span class="n">save_url</span><span class="p">,</span>
</span><span class="hll">                <span class="n">logged_in</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">authenticated_userid</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<span class="hll">                <span class="n">save_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;edit_page&#39;</span><span class="p">),</span>
</span><span class="hll">                <span class="n">logged_in</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">authenticated_userid</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Only the highlighted lines need to be added or edited.</p>
<p>The <a class="reference internal" href="../../api/request.html#pyramid.request.Request.authenticated_userid" title="pyramid.request.Request.authenticated_userid"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.request.Request.authenticated_userid()</span></code></a> will be <code class="docutils literal notranslate"><span class="pre">None</span></code> if
the user is not authenticated, or a userid if the user is authenticated.</p>
</div>
<div class="section" id="add-a-logout-link-when-logged-in">
<h3>Add a &quot;Logout&quot; link when logged in<a class="headerlink" href="#add-a-logout-link-when-logged-in" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">tutorial/templates/edit.pt</span></code> and
<code class="docutils literal notranslate"><span class="pre">tutorial/templates/view.pt</span></code> and add the following code as
indicated by the highlighted lines.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
<span class="hll">              <span class="p">&lt;</span><span class="nt">p</span> <span class="na">tal:condition</span><span class="o">=</span><span class="s">&quot;logged_in&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pull-right&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.application_url}/logout&quot;</span><span class="p">&gt;</span>Logout<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span><span class="hll">              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></pre></div>
</div>
<p>The attribute <code class="docutils literal notranslate"><span class="pre">tal:condition=&quot;logged_in&quot;</span></code> will make the element be included
when <code class="docutils literal notranslate"><span class="pre">logged_in</span></code> is any user id. The link will invoke the logout view.  The
above element will not be included if <code class="docutils literal notranslate"><span class="pre">logged_in</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, such as when
a user is not authenticated.</p>
</div>
</div>
<div class="section" id="reviewing-our-changes">
<h2>Reviewing our changes<a class="headerlink" href="#reviewing-our-changes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Our <code class="docutils literal notranslate"><span class="pre">tutorial/__init__.py</span></code> will look like this when we're done:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid_zodbconn</span> <span class="kn">import</span> <span class="n">get_connection</span>

<span class="hll"><span class="kn">from</span> <span class="nn">pyramid.authentication</span> <span class="kn">import</span> <span class="n">AuthTktAuthenticationPolicy</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">pyramid.authorization</span> <span class="kn">import</span> <span class="n">ACLAuthorizationPolicy</span>
</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">appmaker</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.security</span> <span class="kn">import</span> <span class="n">groupfinder</span>
</span>
<span class="k">def</span> <span class="nf">root_factory</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">get_connection</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">appmaker</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">root</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">global_config</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function returns a Pyramid WSGI application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;tm.manager_hook&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pyramid_tm.explicit_manager&#39;</span>
<span class="hll">    <span class="n">authn_policy</span> <span class="o">=</span> <span class="n">AuthTktAuthenticationPolicy</span><span class="p">(</span>
</span><span class="hll">        <span class="s1">&#39;sosecret&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">groupfinder</span><span class="p">,</span> <span class="n">hashalg</span><span class="o">=</span><span class="s1">&#39;sha512&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">authz_policy</span> <span class="o">=</span> <span class="n">ACLAuthorizationPolicy</span><span class="p">()</span>
</span>    <span class="k">with</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span> <span class="k">as</span> <span class="n">config</span><span class="p">:</span>
<span class="hll">        <span class="n">config</span><span class="o">.</span><span class="n">set_authentication_policy</span><span class="p">(</span><span class="n">authn_policy</span><span class="p">)</span>
</span><span class="hll">        <span class="n">config</span><span class="o">.</span><span class="n">set_authorization_policy</span><span class="p">(</span><span class="n">authz_policy</span><span class="p">)</span>
</span>        <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_chameleon&#39;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_tm&#39;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_retry&#39;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_zodbconn&#39;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_root_factory</span><span class="p">(</span><span class="n">root_factory</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Only the highlighted lines need to be added or edited.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">tutorial/models.py</span></code> will look like this when we're done:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">persistent</span> <span class="kn">import</span> <span class="n">Persistent</span>
<span class="kn">from</span> <span class="nn">persistent.mapping</span> <span class="kn">import</span> <span class="n">PersistentMapping</span>

<span class="hll"><span class="kn">from</span> <span class="nn">pyramid.security</span> <span class="kn">import</span> <span class="p">(</span>
</span><span class="hll">    <span class="n">Allow</span><span class="p">,</span>
</span><span class="hll">    <span class="n">Everyone</span><span class="p">,</span>
</span><span class="hll">    <span class="p">)</span>
</span>
<span class="k">class</span> <span class="nc">Wiki</span><span class="p">(</span><span class="n">PersistentMapping</span><span class="p">):</span>
    <span class="vm">__name__</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">__parent__</span> <span class="o">=</span> <span class="bp">None</span>
<span class="hll">    <span class="n">__acl__</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">Allow</span><span class="p">,</span> <span class="n">Everyone</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
</span><span class="hll">                <span class="p">(</span><span class="n">Allow</span><span class="p">,</span> <span class="s1">&#39;group:editors&#39;</span><span class="p">,</span> <span class="s1">&#39;edit&#39;</span><span class="p">)</span> <span class="p">]</span>
</span>
<span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">Persistent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">appmaker</span><span class="p">(</span><span class="n">zodb_root</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;app_root&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zodb_root</span><span class="p">:</span>
        <span class="n">app_root</span> <span class="o">=</span> <span class="n">Wiki</span><span class="p">()</span>
        <span class="n">frontpage</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="s1">&#39;This is the front page&#39;</span><span class="p">)</span>
        <span class="n">app_root</span><span class="p">[</span><span class="s1">&#39;FrontPage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frontpage</span>
        <span class="n">frontpage</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;FrontPage&#39;</span>
        <span class="n">frontpage</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">app_root</span>
        <span class="n">zodb_root</span><span class="p">[</span><span class="s1">&#39;app_root&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_root</span>
    <span class="k">return</span> <span class="n">zodb_root</span><span class="p">[</span><span class="s1">&#39;app_root&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<p>Only the highlighted lines need to be added or edited.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">tutorial/views.py</span></code> will look like this when we're done:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.core</span> <span class="kn">import</span> <span class="n">publish_parts</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPFound</span>

<span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">view_config</span><span class="p">,</span>
<span class="hll">    <span class="n">forbidden_view_config</span><span class="p">,</span>
</span>    <span class="p">)</span>

<span class="hll"><span class="kn">from</span> <span class="nn">pyramid.security</span> <span class="kn">import</span> <span class="p">(</span>
</span><span class="hll">    <span class="n">remember</span><span class="p">,</span>
</span><span class="hll">    <span class="n">forget</span><span class="p">,</span>
</span><span class="hll">    <span class="p">)</span>
</span><span class="hll">
</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.security</span> <span class="kn">import</span> <span class="n">USERS</span><span class="p">,</span> <span class="n">check_password</span>
</span><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>

<span class="c1"># regular expression used to find WikiWords</span>
<span class="n">wikiwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b([A-Z]\w+[A-Z]+\w+)&quot;</span><span class="p">)</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span>
<span class="hll">             <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">)</span>
</span><span class="k">def</span> <span class="nf">view_wiki</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;FrontPage&#39;</span><span class="p">))</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/view.pt&#39;</span><span class="p">,</span>
<span class="hll">             <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">)</span>
</span><span class="k">def</span> <span class="nf">view_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">wiki</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">__parent__</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">wiki</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">wiki</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
            <span class="n">view_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">view_url</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">application_url</span> <span class="o">+</span> <span class="s1">&#39;/add_page/&#39;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add_url</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">writer_name</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)[</span><span class="s1">&#39;html_body&#39;</span><span class="p">]</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">edit_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;edit_page&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">edit_url</span><span class="o">=</span><span class="n">edit_url</span><span class="p">,</span>
<span class="hll">                <span class="n">logged_in</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">authenticated_userid</span><span class="p">)</span>
</span>
<span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span>
             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.pt&#39;</span><span class="p">,</span>
<span class="hll">             <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;edit&#39;</span><span class="p">)</span>
</span><span class="k">def</span> <span class="nf">add_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">subpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">page</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">pagename</span>
        <span class="n">page</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">context</span>
        <span class="n">context</span><span class="p">[</span><span class="n">pagename</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
    <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">page</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">pagename</span>
    <span class="n">page</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">context</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">save_url</span><span class="o">=</span><span class="n">save_url</span><span class="p">,</span>
<span class="hll">                <span class="n">logged_in</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">authenticated_userid</span><span class="p">)</span>
</span>
<span class="nd">@view_config</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Page&#39;</span><span class="p">,</span>
             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/edit.pt&#39;</span><span class="p">,</span>
<span class="hll">             <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;edit&#39;</span><span class="p">)</span>
</span><span class="k">def</span> <span class="nf">edit_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">context</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                <span class="n">save_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;edit_page&#39;</span><span class="p">),</span>
<span class="hll">                <span class="n">logged_in</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">authenticated_userid</span><span class="p">)</span>
</span>
<span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">,</span>
</span><span class="hll">             <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/login.pt&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="nd">@forbidden_view_config</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;templates/login.pt&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">login_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">referrer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">referrer</span> <span class="o">==</span> <span class="n">login_url</span><span class="p">:</span>
</span><span class="hll">        <span class="n">referrer</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>  <span class="c1"># never use the login form itself as came_from</span>
</span><span class="hll">    <span class="n">came_from</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;came_from&#39;</span><span class="p">,</span> <span class="n">referrer</span><span class="p">)</span>
</span><span class="hll">    <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class="hll">    <span class="n">login</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class="hll">    <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class="hll">    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
</span><span class="hll">        <span class="n">login</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]</span>
</span><span class="hll">        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">check_password</span><span class="p">(</span><span class="n">USERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">login</span><span class="p">),</span> <span class="n">password</span><span class="p">):</span>
</span><span class="hll">            <span class="n">headers</span> <span class="o">=</span> <span class="n">remember</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">login</span><span class="p">)</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">came_from</span><span class="p">,</span>
</span><span class="hll">                             <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span><span class="hll">        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Failed login&#39;</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
</span><span class="hll">        <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
</span><span class="hll">        <span class="n">url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">application_url</span> <span class="o">+</span> <span class="s1">&#39;/login&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">came_from</span><span class="o">=</span><span class="n">came_from</span><span class="p">,</span>
</span><span class="hll">        <span class="n">login</span><span class="o">=</span><span class="n">login</span><span class="p">,</span>
</span><span class="hll">        <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
</span><span class="hll">    <span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s1">&#39;.models.Wiki&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">headers</span> <span class="o">=</span> <span class="n">forget</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
</span><span class="hll">                     <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>Only the highlighted lines need to be added or edited.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">tutorial/templates/edit.pt</span></code> template will look like this when
we're done:</p>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;${request.locale_name}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;pyramid web application&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;Pylons Project&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid-16x16.png&#39;)}&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>${page.__name__} - Pyramid tutorial wiki (based on
    TurboGears 20-Minute Wiki)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Bootstrap core CSS --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Custom styles for this scaffold --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/theme.css&#39;)}&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js&quot; integrity=&quot;sha384-0s5Pv64cNZJieYFkXYOTId2HMA2Lfb6q2nAcx2n0RTLUnCAoTTsS0nKEO27XyKcY&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js&quot; integrity=&quot;sha384-f1r2UzjsxZ9T4V1f2zBO/evUqSEOpeaUUZcMTz1Up63bl4ruYnFYeM+BxI4NhyI0&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;starter-template&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-2&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;logo img-responsive&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid.png&#39;)}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;pyramid web framework&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
<span class="hll">              <span class="p">&lt;</span><span class="nt">p</span> <span class="na">tal:condition</span><span class="o">=</span><span class="s">&quot;logged_in&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pull-right&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.application_url}/logout&quot;</span><span class="p">&gt;</span>Logout<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span><span class="hll">              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span>              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                  Editing <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">tal:replace</span><span class="o">=</span><span class="s">&quot;page.__name__&quot;</span><span class="p">&gt;</span>
                  Page Name Goes Here<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can return to the
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.application_url}&quot;</span><span class="p">&gt;</span>FrontPage<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;${save_url}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;body&quot;</span> <span class="na">tal:content</span><span class="o">=</span><span class="s">&quot;page.data&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;60&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;form.submitted&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Save&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span><span class="p">&gt;</span>Save<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;copyright&quot;</span><span class="p">&gt;</span>
            Copyright <span class="ni">&amp;copy;</span> Pylons Project
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


    <span class="c">&lt;!-- Bootstrap core JavaScript</span>
<span class="c">    ================================================== --&gt;</span>
    <span class="c">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/jquery/1.10.2/jquery.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-aBL3Lzi6c9LNDGvpHkZrrm3ZVsIwohDD7CDozL0pk8FwCrfmV7H9w8j3L7ikEv6h&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Only the highlighted lines need to be added or edited.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">tutorial/templates/view.pt</span></code> template will look like this when
we're done:</p>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;${request.locale_name}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;pyramid web application&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;Pylons Project&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid-16x16.png&#39;)}&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>${page.__name__} - Pyramid tutorial wiki (based on
    TurboGears 20-Minute Wiki)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Bootstrap core CSS --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Custom styles for this scaffold --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/theme.css&#39;)}&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js&quot; integrity=&quot;sha384-0s5Pv64cNZJieYFkXYOTId2HMA2Lfb6q2nAcx2n0RTLUnCAoTTsS0nKEO27XyKcY&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js&quot; integrity=&quot;sha384-f1r2UzjsxZ9T4V1f2zBO/evUqSEOpeaUUZcMTz1Up63bl4ruYnFYeM+BxI4NhyI0&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;starter-template&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-2&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;logo img-responsive&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;${request.static_url(&#39;tutorial:static/pyramid.png&#39;)}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;pyramid web framework&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
<span class="hll">              <span class="p">&lt;</span><span class="nt">p</span> <span class="na">tal:condition</span><span class="o">=</span><span class="s">&quot;logged_in&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pull-right&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.application_url}/logout&quot;</span><span class="p">&gt;</span>Logout<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span><span class="hll">              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span>              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">tal:replace</span><span class="o">=</span><span class="s">&quot;structure content&quot;</span><span class="p">&gt;</span>
                Page text goes here.
              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">tal:attributes</span><span class="o">=</span><span class="s">&quot;href edit_url&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
                  Edit this page
                <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                  Viewing <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">tal:replace</span><span class="o">=</span><span class="s">&quot;page.__name__&quot;</span><span class="p">&gt;</span>
                  Page Name Goes Here<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can return to the
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${request.application_url}&quot;</span><span class="p">&gt;</span>FrontPage<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;copyright&quot;</span><span class="p">&gt;</span>
            Copyright <span class="ni">&amp;copy;</span> Pylons Project
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


    <span class="c">&lt;!-- Bootstrap core JavaScript</span>
<span class="c">    ================================================== --&gt;</span>
    <span class="c">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/jquery/1.10.2/jquery.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-aBL3Lzi6c9LNDGvpHkZrrm3ZVsIwohDD7CDozL0pk8FwCrfmV7H9w8j3L7ikEv6h&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Only the highlighted lines need to be added or edited.</p>
</div>
<div class="section" id="viewing-the-application-in-a-browser">
<h2>Viewing the application in a browser<a class="headerlink" href="#viewing-the-application-in-a-browser" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We can finally examine our application in a browser (See
<a class="reference internal" href="installation.html#wiki-start-the-application"><span class="std std-ref">Start the application</span></a>).  Launch a browser and visit each of the
following URLs, checking that the result is as expected:</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/">http://localhost:6543/</a> invokes the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view.  This always
redirects to the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view of the <code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> Page resource.  It
is executable by any user.</li>
<li><a class="reference external" href="http://localhost:6543/FrontPage">http://localhost:6543/FrontPage</a> invokes the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view of the
<code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> Page resource. This is because it's the <a class="reference internal" href="../../glossary.html#term-default-view"><span class="xref std std-term">default view</span></a>
(a view without a <code class="docutils literal notranslate"><span class="pre">name</span></code>) for <code class="docutils literal notranslate"><span class="pre">Page</span></code> resources.  It is executable by any
user.</li>
<li><a class="reference external" href="http://localhost:6543/FrontPage/edit_page">http://localhost:6543/FrontPage/edit_page</a> invokes the edit view for the
FrontPage object.  It is executable by only the <code class="docutils literal notranslate"><span class="pre">editor</span></code> user.  If a
different user (or the anonymous user) invokes it, a login form will be
displayed.  Supplying the credentials with the username <code class="docutils literal notranslate"><span class="pre">editor</span></code>, password
<code class="docutils literal notranslate"><span class="pre">editor</span></code> will display the edit page form.</li>
<li><a class="reference external" href="http://localhost:6543/add_page/SomePageName">http://localhost:6543/add_page/SomePageName</a> invokes the add view for a page.
It is executable by only the <code class="docutils literal notranslate"><span class="pre">editor</span></code> user.  If a different user (or the
anonymous user) invokes it, a login form will be displayed. Supplying the
credentials with the username <code class="docutils literal notranslate"><span class="pre">editor</span></code>, password <code class="docutils literal notranslate"><span class="pre">editor</span></code> will display
the edit page form.</li>
<li>After logging in (as a result of hitting an edit or add page and submitting
the login form with the <code class="docutils literal notranslate"><span class="pre">editor</span></code> credentials), we'll see a Logout link in
the upper right hand corner.  When we click it, we're logged out, and
redirected back to the front page.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Adding authorization</a><ul>
<li><a class="reference internal" href="#access-control">Access control</a><ul>
<li><a class="reference internal" href="#add-dependencies">Add dependencies</a></li>
<li><a class="reference internal" href="#add-users-and-groups">Add users and groups</a></li>
<li><a class="reference internal" href="#add-an-acl">Add an ACL</a></li>
<li><a class="reference internal" href="#add-authentication-and-authorization-policies">Add authentication and authorization policies</a></li>
<li><a class="reference internal" href="#add-permission-declarations">Add permission declarations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#login-logout">Login, logout</a><ul>
<li><a class="reference internal" href="#add-login-and-logout-views">Add login and logout views</a></li>
<li><a class="reference internal" href="#add-the-login-pt-template">Add the <code class="docutils literal notranslate"><span class="pre">login.pt</span></code> Template</a></li>
<li><a class="reference internal" href="#return-a-logged-in-flag-to-the-renderer">Return a <code class="docutils literal notranslate"><span class="pre">logged_in</span></code> flag to the renderer</a></li>
<li><a class="reference internal" href="#add-a-logout-link-when-logged-in">Add a &quot;Logout&quot; link when logged in</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reviewing-our-changes">Reviewing our changes</a></li>
<li><a class="reference internal" href="#viewing-the-application-in-a-browser">Viewing the application in a browser</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="definingviews.html"
                        title="前の章へ">Defining Views</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="tests.html"
                        title="次の章へ">Adding Tests</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/tutorials/wiki/authorization.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="tests.html" title="Adding Tests"
             >次へ</a> |</li>
        <li class="right" >
          <a href="definingviews.html" title="Defining Views"
             >前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >ZODB + Traversal Wiki Tutorial</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 10月 28, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1 で生成しました。
    </div>
  </body>
</html>