
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pyramid.config.routes &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../../../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" />
    <link rel="copyright" title="著作権" href="../../../copyright.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../../../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../../../index.html">
      		<img class="logo" src="../../../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
    	<li><a href="../../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >モジュールコード</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../config.html" accesskey="U">pyramid.config</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>pyramid.config.routes のソースコード</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">pyramid.compat</span> <span class="k">import</span> <span class="n">urlparse</span>
<span class="kn">from</span> <span class="nn">pyramid.interfaces</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">IRequest</span><span class="p">,</span>
    <span class="n">IRouteRequest</span><span class="p">,</span>
    <span class="n">IRoutesMapper</span><span class="p">,</span>
    <span class="n">PHASE2_CONFIG</span><span class="p">,</span>
    <span class="p">)</span>

<span class="kn">from</span> <span class="nn">pyramid.exceptions</span> <span class="k">import</span> <span class="n">ConfigurationError</span>
<span class="kn">from</span> <span class="nn">pyramid.registry</span> <span class="k">import</span> <span class="n">predvalseq</span>
<span class="kn">from</span> <span class="nn">pyramid.request</span> <span class="k">import</span> <span class="n">route_request_iface</span>
<span class="kn">from</span> <span class="nn">pyramid.urldispatch</span> <span class="k">import</span> <span class="n">RoutesMapper</span>

<span class="kn">from</span> <span class="nn">pyramid.config.util</span> <span class="k">import</span> <span class="n">action_method</span>
<span class="kn">from</span> <span class="nn">pyramid.util</span> <span class="k">import</span> <span class="n">as_sorted_tuple</span>

<span class="kn">import</span> <span class="nn">pyramid.predicates</span>

<span class="k">class</span> <span class="nc">RoutesConfiguratorMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@action_method</span>
    <span class="k">def</span> <span class="nf">add_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">name</span><span class="p">,</span>
                  <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">permission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">factory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">for_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">xhr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">accept</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">path_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">request_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">request_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">traverse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">custom_predicates</span><span class="o">=</span><span class="p">(),</span>
                  <span class="n">use_global_views</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">pregenerator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">static</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">predicates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a :term:`route configuration` to the current</span>
<span class="sd">        configuration state, as well as possibly a :term:`view</span>
<span class="sd">        configuration` to be used to specify a :term:`view callable`</span>
<span class="sd">        that will be invoked when this route matches.  The arguments</span>
<span class="sd">        to this method are divided into *predicate*, *non-predicate*,</span>
<span class="sd">        and *view-related* types.  :term:`Route predicate` arguments</span>
<span class="sd">        narrow the circumstances in which a route will be match a</span>
<span class="sd">        request; non-predicate arguments are informational.</span>

<span class="sd">        Non-Predicate Arguments</span>

<span class="sd">        name</span>

<span class="sd">          The name of the route, e.g. ``myroute``.  This attribute is</span>
<span class="sd">          required.  It must be unique among all defined routes in a given</span>
<span class="sd">          application.</span>

<span class="sd">        factory</span>

<span class="sd">          A Python object (often a function or a class) or a :term:`dotted</span>
<span class="sd">          Python name` which refers to the same object that will generate a</span>
<span class="sd">          :app:`Pyramid` root resource object when this route matches. For</span>
<span class="sd">          example, ``mypackage.resources.MyFactory``.  If this argument is</span>
<span class="sd">          not specified, a default root factory will be used.  See</span>
<span class="sd">          :ref:`the_resource_tree` for more information about root factories.</span>

<span class="sd">        traverse</span>

<span class="sd">          If you would like to cause the :term:`context` to be</span>
<span class="sd">          something other than the :term:`root` object when this route</span>
<span class="sd">          matches, you can spell a traversal pattern as the</span>
<span class="sd">          ``traverse`` argument.  This traversal pattern will be used</span>
<span class="sd">          as the traversal path: traversal will begin at the root</span>
<span class="sd">          object implied by this route (either the global root, or the</span>
<span class="sd">          object returned by the ``factory`` associated with this</span>
<span class="sd">          route).</span>

<span class="sd">          The syntax of the ``traverse`` argument is the same as it is</span>
<span class="sd">          for ``pattern``. For example, if the ``pattern`` provided to</span>
<span class="sd">          ``add_route`` is ``articles/{article}/edit``, and the</span>
<span class="sd">          ``traverse`` argument provided to ``add_route`` is</span>
<span class="sd">          ``/{article}``, when a request comes in that causes the route</span>
<span class="sd">          to match in such a way that the ``article`` match value is</span>
<span class="sd">          ``&#39;1&#39;`` (when the request URI is ``/articles/1/edit``), the</span>
<span class="sd">          traversal path will be generated as ``/1``.  This means that</span>
<span class="sd">          the root object&#39;s ``__getitem__`` will be called with the</span>
<span class="sd">          name ``&#39;1&#39;`` during the traversal phase.  If the ``&#39;1&#39;`` object</span>
<span class="sd">          exists, it will become the :term:`context` of the request.</span>
<span class="sd">          :ref:`traversal_chapter` has more information about</span>
<span class="sd">          traversal.</span>

<span class="sd">          If the traversal path contains segment marker names which</span>
<span class="sd">          are not present in the ``pattern`` argument, a runtime error</span>
<span class="sd">          will occur.  The ``traverse`` pattern should not contain</span>
<span class="sd">          segment markers that do not exist in the ``pattern``</span>
<span class="sd">          argument.</span>

<span class="sd">          A similar combining of routing and traversal is available</span>
<span class="sd">          when a route is matched which contains a ``*traverse``</span>
<span class="sd">          remainder marker in its pattern (see</span>
<span class="sd">          :ref:`using_traverse_in_a_route_pattern`).  The ``traverse``</span>
<span class="sd">          argument to add_route allows you to associate route patterns</span>
<span class="sd">          with an arbitrary traversal path without using a</span>
<span class="sd">          ``*traverse`` remainder marker; instead you can use other</span>
<span class="sd">          match information.</span>

<span class="sd">          Note that the ``traverse`` argument to ``add_route`` is</span>
<span class="sd">          ignored when attached to a route that has a ``*traverse``</span>
<span class="sd">          remainder marker in its pattern.</span>

<span class="sd">        pregenerator</span>

<span class="sd">           This option should be a callable object that implements the</span>
<span class="sd">           :class:`pyramid.interfaces.IRoutePregenerator` interface.  A</span>
<span class="sd">           :term:`pregenerator` is a callable called by the</span>
<span class="sd">           :meth:`pyramid.request.Request.route_url` function to augment or</span>
<span class="sd">           replace the arguments it is passed when generating a URL for the</span>
<span class="sd">           route.  This is a feature not often used directly by applications,</span>
<span class="sd">           it is meant to be hooked by frameworks that use :app:`Pyramid` as</span>
<span class="sd">           a base.</span>

<span class="sd">        use_global_views</span>

<span class="sd">          When a request matches this route, and view lookup cannot</span>
<span class="sd">          find a view which has a ``route_name`` predicate argument</span>
<span class="sd">          that matches the route, try to fall back to using a view</span>
<span class="sd">          that otherwise matches the context, request, and view name</span>
<span class="sd">          (but which does not match the route_name predicate).</span>

<span class="sd">        static</span>

<span class="sd">          If ``static`` is ``True``, this route will never match an incoming</span>
<span class="sd">          request; it will only be useful for URL generation.  By default,</span>
<span class="sd">          ``static`` is ``False``.  See :ref:`static_route_narr`.</span>

<span class="sd">          .. versionadded:: 1.1</span>

<span class="sd">        accept</span>

<span class="sd">          This value represents a match query for one or more mimetypes in the</span>
<span class="sd">          ``Accept`` HTTP request header.  If this value is specified, it must</span>
<span class="sd">          be in one of the following forms: a mimetype match token in the form</span>
<span class="sd">          ``text/plain``, a wildcard mimetype match token in the form</span>
<span class="sd">          ``text/*`` or a match-all wildcard mimetype match token in the form</span>
<span class="sd">          ``*/*``.  If any of the forms matches the ``Accept`` header of the</span>
<span class="sd">          request, or if the ``Accept`` header isn&#39;t set at all in the request,</span>
<span class="sd">          this will match the current route. If this does not match the</span>
<span class="sd">          ``Accept`` header of the request, route matching continues.</span>

<span class="sd">        Predicate Arguments</span>

<span class="sd">        pattern</span>

<span class="sd">          The pattern of the route e.g. ``ideas/{idea}``.  This</span>
<span class="sd">          argument is required.  See :ref:`route_pattern_syntax`</span>
<span class="sd">          for information about the syntax of route patterns.  If the</span>
<span class="sd">          pattern doesn&#39;t match the current URL, route matching</span>
<span class="sd">          continues.</span>

<span class="sd">          .. note::</span>

<span class="sd">             For backwards compatibility purposes (as of :app:`Pyramid` 1.0), a</span>
<span class="sd">             ``path`` keyword argument passed to this function will be used to</span>
<span class="sd">             represent the pattern value if the ``pattern`` argument is</span>
<span class="sd">             ``None``.  If both ``path`` and ``pattern`` are passed, ``pattern``</span>
<span class="sd">             wins.</span>

<span class="sd">        xhr</span>

<span class="sd">          This value should be either ``True`` or ``False``.  If this</span>
<span class="sd">          value is specified and is ``True``, the :term:`request` must</span>
<span class="sd">          possess an ``HTTP_X_REQUESTED_WITH`` (aka</span>
<span class="sd">          ``X-Requested-With``) header for this route to match.  This</span>
<span class="sd">          is useful for detecting AJAX requests issued from jQuery,</span>
<span class="sd">          Prototype and other Javascript libraries.  If this predicate</span>
<span class="sd">          returns ``False``, route matching continues.</span>

<span class="sd">        request_method</span>

<span class="sd">          A string representing an HTTP method name, e.g. ``GET``, ``POST``,</span>
<span class="sd">          ``HEAD``, ``DELETE``, ``PUT`` or a tuple of elements containing</span>
<span class="sd">          HTTP method names.  If this argument is not specified, this route</span>
<span class="sd">          will match if the request has *any* request method.  If this</span>
<span class="sd">          predicate returns ``False``, route matching continues.</span>

<span class="sd">          .. versionchanged:: 1.2</span>
<span class="sd">             The ability to pass a tuple of items as ``request_method``.</span>
<span class="sd">             Previous versions allowed only a string.</span>

<span class="sd">        path_info</span>

<span class="sd">          This value represents a regular expression pattern that will</span>
<span class="sd">          be tested against the ``PATH_INFO`` WSGI environment</span>
<span class="sd">          variable.  If the regex matches, this predicate will return</span>
<span class="sd">          ``True``.  If this predicate returns ``False``, route</span>
<span class="sd">          matching continues.</span>

<span class="sd">        request_param</span>

<span class="sd">          This value can be any string.  A view declaration with this</span>
<span class="sd">          argument ensures that the associated route will only match</span>
<span class="sd">          when the request has a key in the ``request.params``</span>
<span class="sd">          dictionary (an HTTP ``GET`` or ``POST`` variable) that has a</span>
<span class="sd">          name which matches the supplied value.  If the value</span>
<span class="sd">          supplied as the argument has a ``=`` sign in it,</span>
<span class="sd">          e.g. ``request_param=&quot;foo=123&quot;``, then the key</span>
<span class="sd">          (``foo``) must both exist in the ``request.params`` dictionary, and</span>
<span class="sd">          the value must match the right hand side of the expression (``123``)</span>
<span class="sd">          for the route to &quot;match&quot; the current request.  If this predicate</span>
<span class="sd">          returns ``False``, route matching continues.</span>

<span class="sd">        header</span>

<span class="sd">          This argument represents an HTTP header name or a header</span>
<span class="sd">          name/value pair.  If the argument contains a ``:`` (colon),</span>
<span class="sd">          it will be considered a name/value pair</span>
<span class="sd">          (e.g. ``User-Agent:Mozilla/.*`` or ``Host:localhost``).  If</span>
<span class="sd">          the value contains a colon, the value portion should be a</span>
<span class="sd">          regular expression.  If the value does not contain a colon,</span>
<span class="sd">          the entire value will be considered to be the header name</span>
<span class="sd">          (e.g. ``If-Modified-Since``).  If the value evaluates to a</span>
<span class="sd">          header name only without a value, the header specified by</span>
<span class="sd">          the name must be present in the request for this predicate</span>
<span class="sd">          to be true.  If the value evaluates to a header name/value</span>
<span class="sd">          pair, the header specified by the name must be present in</span>
<span class="sd">          the request *and* the regular expression specified as the</span>
<span class="sd">          value must match the header value.  Whether or not the value</span>
<span class="sd">          represents a header name or a header name/value pair, the</span>
<span class="sd">          case of the header name is not significant.  If this</span>
<span class="sd">          predicate returns ``False``, route matching continues.</span>

<span class="sd">        effective_principals</span>

<span class="sd">          If specified, this value should be a :term:`principal` identifier or</span>
<span class="sd">          a sequence of principal identifiers.  If the</span>
<span class="sd">          :attr:`pyramid.request.Request.effective_principals` property</span>
<span class="sd">          indicates that every principal named in the argument list is present</span>
<span class="sd">          in the current request, this predicate will return True; otherwise it</span>
<span class="sd">          will return False.  For example:</span>
<span class="sd">          ``effective_principals=pyramid.security.Authenticated`` or</span>
<span class="sd">          ``effective_principals=(&#39;fred&#39;, &#39;group:admins&#39;)``.</span>

<span class="sd">          .. versionadded:: 1.4a4</span>

<span class="sd">        custom_predicates</span>

<span class="sd">          .. deprecated:: 1.5</span>
<span class="sd">              This value should be a sequence of references to custom</span>
<span class="sd">              predicate callables.  Use custom predicates when no set of</span>
<span class="sd">              predefined predicates does what you need.  Custom predicates</span>
<span class="sd">              can be combined with predefined predicates as necessary.</span>
<span class="sd">              Each custom predicate callable should accept two arguments:</span>
<span class="sd">              ``info`` and ``request`` and should return either ``True``</span>
<span class="sd">              or ``False`` after doing arbitrary evaluation of the info</span>
<span class="sd">              and/or the request.  If all custom and non-custom predicate</span>
<span class="sd">              callables return ``True`` the associated route will be</span>
<span class="sd">              considered viable for a given request.  If any predicate</span>
<span class="sd">              callable returns ``False``, route matching continues.  Note</span>
<span class="sd">              that the value ``info`` passed to a custom route predicate</span>
<span class="sd">              is a dictionary containing matching information; see</span>
<span class="sd">              :ref:`custom_route_predicates` for more information about</span>
<span class="sd">              ``info``.</span>

<span class="sd">        predicates</span>

<span class="sd">          Pass a key/value pair here to use a third-party predicate</span>
<span class="sd">          registered via</span>
<span class="sd">          :meth:`pyramid.config.Configurator.add_route_predicate`.  More than</span>
<span class="sd">          one key/value pair can be used at the same time.  See</span>
<span class="sd">          :ref:`view_and_route_predicates` for more information about</span>
<span class="sd">          third-party predicates.</span>

<span class="sd">          .. versionadded:: 1.4</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">custom_predicates</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;The &quot;custom_predicates&quot; argument to Configurator.add_route &#39;</span>
                 <span class="s1">&#39;is deprecated as of Pyramid 1.5.  Use &#39;</span>
                 <span class="s1">&#39;&quot;config.add_route_predicate&quot; and use the registered &#39;</span>
                 <span class="s1">&#39;route predicate as a predicate argument to add_route &#39;</span>
                 <span class="s1">&#39;instead. See &quot;Adding A Third Party View, Route, or &#39;</span>
                 <span class="s1">&#39;Subscriber Predicate&quot; in the &quot;Hooks&quot; chapter of the &#39;</span>
                 <span class="s1">&#39;documentation for more information.&#39;</span><span class="p">),</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span>
                <span class="p">)</span>
        <span class="c1"># these are route predicates; if they do not match, the next route</span>
        <span class="c1"># in the routelist will be tried</span>
        <span class="k">if</span> <span class="n">request_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request_method</span> <span class="o">=</span> <span class="n">as_sorted_tuple</span><span class="p">(</span><span class="n">request_method</span><span class="p">)</span>

        <span class="n">factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maybe_dotted</span><span class="p">(</span><span class="n">factory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s1">&#39;&quot;pattern&quot; argument may not be None&#39;</span><span class="p">)</span>

        <span class="c1"># check for an external route; an external route is one which is</span>
        <span class="c1"># is a full url (e.g. &#39;http://example.com/{id}&#39;)</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">external_url</span> <span class="o">=</span> <span class="n">pattern</span>

        <span class="k">if</span> <span class="n">parsed</span><span class="o">.</span><span class="n">hostname</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">path</span>

            <span class="n">original_pregenerator</span> <span class="o">=</span> <span class="n">pregenerator</span>
            <span class="k">def</span> <span class="nf">external_url_pregenerator</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;_app_url&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;You cannot generate a path to an external route &#39;</span>
                        <span class="s1">&#39;pattern via request.route_path nor pass an _app_url &#39;</span>
                        <span class="s1">&#39;to request.route_url when generating a URL for an &#39;</span>
                        <span class="s1">&#39;external route pattern (pattern was &quot;</span><span class="si">%s</span><span class="s1">&quot;) &#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">pattern</span><span class="p">,)</span>
                        <span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;_scheme&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
                    <span class="n">scheme</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;_scheme&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
                    <span class="n">scheme</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scheme</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scheme</span>
                <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;_app_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">://</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span> <span class="n">parsed</span><span class="o">.</span><span class="n">netloc</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">original_pregenerator</span><span class="p">:</span>
                    <span class="n">elements</span><span class="p">,</span> <span class="n">kw</span> <span class="o">=</span> <span class="n">original_pregenerator</span><span class="p">(</span>
                        <span class="n">request</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">elements</span><span class="p">,</span> <span class="n">kw</span>

            <span class="n">pregenerator</span> <span class="o">=</span> <span class="n">external_url_pregenerator</span>
            <span class="n">static</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_prefix</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_prefix</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">pattern</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

        <span class="n">mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_routes_mapper</span><span class="p">()</span>

        <span class="n">introspectables</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">intr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">introspectable</span><span class="p">(</span><span class="s1">&#39;routes&#39;</span><span class="p">,</span>
                                   <span class="n">name</span><span class="p">,</span>
                                   <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (pattern: </span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pattern</span><span class="p">),</span>
                                   <span class="s1">&#39;route&#39;</span><span class="p">)</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;factory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">factory</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;xhr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xhr</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;request_methods&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_method</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;path_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_info</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;request_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_param</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;accept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;traverse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">traverse</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;custom_predicates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">custom_predicates</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;pregenerator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pregenerator</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;static&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static</span>
        <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;use_global_views&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">use_global_views</span>

        <span class="k">if</span> <span class="n">static</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;external_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">external_url</span>

        <span class="n">introspectables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intr</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">factory</span><span class="p">:</span>
            <span class="n">factory_intr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">introspectable</span><span class="p">(</span><span class="s1">&#39;root factories&#39;</span><span class="p">,</span>
                                               <span class="n">name</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">object_description</span><span class="p">(</span><span class="n">factory</span><span class="p">),</span>
                                               <span class="s1">&#39;root factory&#39;</span><span class="p">)</span>
            <span class="n">factory_intr</span><span class="p">[</span><span class="s1">&#39;factory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">factory</span>
            <span class="n">factory_intr</span><span class="p">[</span><span class="s1">&#39;route_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">factory_intr</span><span class="o">.</span><span class="n">relate</span><span class="p">(</span><span class="s1">&#39;routes&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">introspectables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factory_intr</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">register_route_request_iface</span><span class="p">():</span>
            <span class="n">request_iface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">queryUtility</span><span class="p">(</span><span class="n">IRouteRequest</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">request_iface</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">use_global_views</span><span class="p">:</span>
                    <span class="n">bases</span> <span class="o">=</span> <span class="p">(</span><span class="n">IRequest</span><span class="p">,)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bases</span> <span class="o">=</span> <span class="p">()</span>
                <span class="n">request_iface</span> <span class="o">=</span> <span class="n">route_request_iface</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">registerUtility</span><span class="p">(</span>
                    <span class="n">request_iface</span><span class="p">,</span> <span class="n">IRouteRequest</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">register_connect</span><span class="p">():</span>
            <span class="n">pvals</span> <span class="o">=</span> <span class="n">predicates</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pvals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">xhr</span><span class="o">=</span><span class="n">xhr</span><span class="p">,</span>
                    <span class="n">request_method</span><span class="o">=</span><span class="n">request_method</span><span class="p">,</span>
                    <span class="n">path_info</span><span class="o">=</span><span class="n">path_info</span><span class="p">,</span>
                    <span class="n">request_param</span><span class="o">=</span><span class="n">request_param</span><span class="p">,</span>
                    <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
                    <span class="n">accept</span><span class="o">=</span><span class="n">accept</span><span class="p">,</span>
                    <span class="n">traverse</span><span class="o">=</span><span class="n">traverse</span><span class="p">,</span>
                    <span class="n">custom</span><span class="o">=</span><span class="n">predvalseq</span><span class="p">(</span><span class="n">custom_predicates</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">predlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predlist</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">predlist</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">pvals</span><span class="p">)</span>
            <span class="n">route</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">predicates</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span>
                <span class="n">pregenerator</span><span class="o">=</span><span class="n">pregenerator</span><span class="p">,</span> <span class="n">static</span><span class="o">=</span><span class="n">static</span>
                <span class="p">)</span>
            <span class="n">intr</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">route</span>
            <span class="k">return</span> <span class="n">route</span>

        <span class="c1"># We have to connect routes in the order they were provided;</span>
        <span class="c1"># we can&#39;t use a phase to do that, because when the actions are</span>
        <span class="c1"># sorted, actions in the same phase lose relative ordering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">((</span><span class="s1">&#39;route-connect&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">register_connect</span><span class="p">)</span>

        <span class="c1"># But IRouteRequest interfaces must be registered before we begin to</span>
        <span class="c1"># process view registrations (in phase 3)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">((</span><span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">register_route_request_iface</span><span class="p">,</span>
                    <span class="n">order</span><span class="o">=</span><span class="n">PHASE2_CONFIG</span><span class="p">,</span> <span class="n">introspectables</span><span class="o">=</span><span class="n">introspectables</span><span class="p">)</span>

    <span class="nd">@action_method</span>
    <span class="k">def</span> <span class="nf">add_route_predicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">weighs_more_than</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">weighs_less_than</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a route predicate factory.  The view predicate can later be</span>
<span class="sd">        named as a keyword argument to</span>
<span class="sd">        :meth:`pyramid.config.Configurator.add_route`.</span>

<span class="sd">        ``name`` should be the name of the predicate.  It must be a valid</span>
<span class="sd">        Python identifier (it will be used as a keyword argument to</span>
<span class="sd">        ``add_route``).</span>

<span class="sd">        ``factory`` should be a :term:`predicate factory` or :term:`dotted</span>
<span class="sd">        Python name` which refers to a predicate factory.</span>

<span class="sd">        See :ref:`view_and_route_predicates` for more information.</span>

<span class="sd">        .. versionadded:: 1.4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_predicate</span><span class="p">(</span>
            <span class="s1">&#39;route&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">factory</span><span class="p">,</span>
            <span class="n">weighs_more_than</span><span class="o">=</span><span class="n">weighs_more_than</span><span class="p">,</span>
            <span class="n">weighs_less_than</span><span class="o">=</span><span class="n">weighs_less_than</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_default_route_predicates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pyramid</span><span class="o">.</span><span class="n">predicates</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;xhr&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">XHRPredicate</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;request_method&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">RequestMethodPredicate</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;path_info&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">PathInfoPredicate</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;request_param&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">RequestParamPredicate</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">HeaderPredicate</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">AcceptPredicate</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;effective_principals&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">EffectivePrincipalsPredicate</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">CustomPredicate</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;traverse&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">TraversePredicate</span><span class="p">),</span>
            <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_route_predicate</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_routes_mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the :term:`routes mapper` object associated with</span>
<span class="sd">        this configurator&#39;s :term:`registry`.&quot;&quot;&quot;</span>
        <span class="n">mapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">queryUtility</span><span class="p">(</span><span class="n">IRoutesMapper</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mapper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mapper</span> <span class="o">=</span> <span class="n">RoutesMapper</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">registerUtility</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">IRoutesMapper</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mapper</span>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
    	<li><a href="../../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >モジュールコード</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../config.html" >pyramid.config</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 11月 27, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1 で生成しました。
    </div>
  </body>
</html>