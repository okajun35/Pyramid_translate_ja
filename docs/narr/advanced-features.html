
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Advanced Pyramid Design Features &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="Installing Pyramid" href="install.html" />
    <link rel="prev" title="Pyramid Introduction" href="introduction.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installing Pyramid"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Pyramid Introduction"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="introduction.html" accesskey="U"><span>Pyramid</span> Introduction</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="advanced-pyramid-design-features">
<h1>Advanced <span>Pyramid</span> Design Features<a class="headerlink" href="#advanced-pyramid-design-features" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><span>Pyramid</span> has been built from the ground up to avoid the problems that other frameworks can suffer.</p>
<div class="section" id="you-don-t-need-singletons">
<h2>You Don't Need Singletons<a class="headerlink" href="#you-don-t-need-singletons" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Have you ever struggled with parameterizing Django's <code class="docutils literal notranslate"><span class="pre">settings.py</span></code> file for multiple installations of the same Django application? Have you ever needed to monkey-patch a framework fixture to get it to behave properly for your use case? Have you ever tried to deploy your application using an asynchronous server and failed?</p>
<p>All these problems are symptoms of <a class="reference internal" href="../glossary.html#term-mutable"><span class="xref std std-term">mutable</span></a> <a class="reference internal" href="../glossary.html#term-global-state"><span class="xref std std-term">global state</span></a>, also known as <a class="reference internal" href="../glossary.html#term-import-time"><span class="xref std std-term">import time</span></a> <a class="reference internal" href="../glossary.html#term-side-effect"><span class="xref std std-term">side effect</span></a>s and arise from the use of <a class="reference internal" href="../glossary.html#term-singleton"><span class="xref std std-term">singleton</span></a> data structures.</p>
<p><span>Pyramid</span> is written so that you don't run into these types of problems. It is even possible to run multiple copies of the <em>same</em> <span>Pyramid</span> application configured differently within a single Python process. This makes running <span>Pyramid</span> in shared hosting environments a snap.</p>
</div>
<div class="section" id="simplify-your-view-code-with-predicates">
<h2>Simplify your View Code with Predicates<a class="headerlink" href="#simplify-your-view-code-with-predicates" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>How many times have you found yourself beginning the logic of your view code with something like this:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
    <span class="c1"># do one thing</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># do something else</span>
</pre></div>
</td></tr></table></div>
<p>Unlike many other systems, <span>Pyramid</span> allows you to associate more than one view with a single route. For example, you can create a route with the pattern <code class="docutils literal notranslate"><span class="pre">/items</span></code> and when the route is matched, you can send the request to one view if the request method is GET, another view if the request method is POST, and so on.</p>
<p><span>Pyramid</span> uses a system of <a class="reference internal" href="../glossary.html#term-view-predicate"><span class="xref std std-term">view predicate</span></a>s to allow this. Matching the request method is one basic thing you can do with a <a class="reference internal" href="../glossary.html#term-view-predicate"><span class="xref std std-term">view predicate</span></a>. You can also associate views with other request parameters, such as elements in the query string, the Accept header, whether the request is an AJAX (XHR) request or not, and lots of other things.</p>
<p>For our example above, you can do this instead:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="n">effective_principals</span><span class="o">=</span><span class="n">pyramid</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">Authenticated</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auth_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># do one thing</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s2">&quot;items&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">anon_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># do something else</span>
</pre></div>
</td></tr></table></div>
<p>This approach allows you to develop view code that is simpler, more easily understandable, and more directly testable.</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="viewconfig.html#view-configuration-parameters"><span class="std std-ref">View Configuration Parameters</span></a>.</p>
</div>
</div>
<div class="section" id="stop-worrying-about-transactions">
<h2>Stop Worrying About Transactions<a class="headerlink" href="#stop-worrying-about-transactions" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><span>Pyramid</span>'s <a class="reference internal" href="../glossary.html#term-cookiecutter"><span class="xref std std-term">cookiecutter</span></a>s render projects that include a <em>transaction management</em> system.  When you use this system, you can stop worrying about when to commit your changes, <span>Pyramid</span> handles it for you. The system will commit at the end of a request or abort if there was an exception.</p>
<p>Why is that a good thing? Imagine a situation where you manually commit a change to your persistence layer. It's very likely that other framework code will run <em>after</em> your changes are done. If an error happens in that other code, you can easily wind up with inconsistent data if you're not extremely careful.</p>
<p>Using transaction management saves you from needing to think about this. Either a request completes successfully and all changes are committed, or it does not and all changes are aborted.</p>
<p><span>Pyramid</span>'s transaction management is extendable, so you can synchronize commits between multiple databases or databases of different kinds. It also allows you to do things like conditionally send email if a transaction is committed, but otherwise keep quiet.</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="../tutorials/wiki2/index.html#bfg-sql-wiki-tutorial"><span class="std std-ref">SQLAlchemy + URL dispatch wiki tutorial</span></a> (note the lack of commit statements anywhere in application code).</p>
</div>
</div>
<div class="section" id="stop-worrying-about-configuration">
<h2>Stop Worrying About Configuration<a class="headerlink" href="#stop-worrying-about-configuration" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>When a system is small, it's reasonably easy to keep it all in your head. But as systems grow large, configuration grows more complex. Your app may grow to have hundreds or even thousands of configuration statements.</p>
<p><span>Pyramid</span>'s configuration system keeps track of each of your statements. If you accidentally add two that are identical, or <span>Pyramid</span> can't make sense out of what it would mean to have both statements active at the same time, it will complain loudly at startup time.</p>
<p><span>Pyramid</span>'s configuration system is not dumb though. If you use the <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">include()</span></code></a> system, it can automatically resolve conflicts on its own. More local statements are preferred over less local ones. So you can intelligently factor large systems into smaller ones.</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="advconfig.html#conflict-detection"><span class="std std-ref">Conflict Detection</span></a>.</p>
</div>
</div>
<div class="section" id="compose-powerful-apps-from-simple-parts">
<h2>Compose Powerful Apps From Simple Parts<a class="headerlink" href="#compose-powerful-apps-from-simple-parts" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Speaking of the <span>Pyramid</span> structured <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">include()</span></code></a> mechanism, it allows you to compose complex applications from multiple, simple Python packages. All the configuration statements that can be performed in your main <span>Pyramid</span> application can also be used in included packages. You can add views, routes, and subscribers, and even set authentication and authorization policies.</p>
<p>If you need, you can extend or override the configuration of an existing application by including its configuration in your own and then modifying it.</p>
<p>For example, if you want to reuse an existing application that already has a bunch of routes, you can just use the <code class="docutils literal notranslate"><span class="pre">include</span></code> statement with a <code class="docutils literal notranslate"><span class="pre">route_prefix</span></code>. All the routes of that application will be availabe, prefixed as you requested:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
   <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
   <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_jinja2&#39;</span><span class="p">)</span>
   <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;pyramid_exclog&#39;</span><span class="p">)</span>
   <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;some.other.package&#39;</span><span class="p">,</span> <span class="n">route_prefix</span><span class="o">=</span><span class="s1">&#39;/somethingelse&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="advconfig.html#including-configuration"><span class="std std-ref">Including Configuration from External Sources</span></a> and <a class="reference internal" href="extending.html#building-an-extensible-app"><span class="std std-ref">Rules for Building an Extensible Application</span></a>.</p>
</div>
</div>
<div class="section" id="authenticate-users-your-way">
<h2>Authenticate Users Your Way<a class="headerlink" href="#authenticate-users-your-way" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><span>Pyramid</span> ships with prebuilt, well-tested authentication and authorization schemes out of the box. Using a scheme is a matter of configuration. So if you need to change approaches later, you need only update your configuration.</p>
<p>In addition, the system that handles authentication and authorization is flexible and pluggable. If you want to use another security add-on, or define your own, you can. And again, you need only update your application configuration to make the change.</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="security.html#enabling-authorization-policy"><span class="std std-ref">Enabling an Authorization Policy</span></a>.</p>
</div>
</div>
<div class="section" id="build-trees-of-resources">
<h2>Build Trees of Resources<a class="headerlink" href="#build-trees-of-resources" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><span>Pyramid</span> supports <a class="reference internal" href="../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a>, a way of mapping URLs to a concrete <a class="reference internal" href="../glossary.html#term-resource-tree"><span class="xref std std-term">resource tree</span></a>. If your application naturally consists of an arbitrary heirarchy of different types of content (like a CMS or a Document Management System), traversal is for you. If you have a requirement for a highly granular security model (&quot;Jane can edit documents in <em>this</em> folder, but not <em>that</em> one&quot;), traversal can be a powerful approach.</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="hellotraversal.html#hello-traversal-chapter"><span class="std std-ref">Hello Traversal World</span></a> and <a class="reference internal" href="muchadoabouttraversal.html#much-ado-about-traversal-chapter"><span class="std std-ref">Much Ado About Traversal</span></a>.</p>
</div>
</div>
<div class="section" id="take-action-on-each-request-with-tweens">
<h2>Take Action on Each Request with Tweens<a class="headerlink" href="#take-action-on-each-request-with-tweens" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><span>Pyramid</span> has a system for applying an arbitrary action to each request or response called a <a class="reference internal" href="../glossary.html#term-tween"><span class="xref std std-term">tween</span></a>. The system is similar in concept to WSGI <a class="reference internal" href="../glossary.html#term-middleware"><span class="xref std std-term">middleware</span></a>, but can be more useful since <a class="reference internal" href="../glossary.html#term-tween"><span class="xref std std-term">tween</span></a>s run in the <span>Pyramid</span> context, and have access to templates, request objects, and other niceties.</p>
<p>The <span>Pyramid</span> debug toolbar is a <a class="reference internal" href="../glossary.html#term-tween"><span class="xref std std-term">tween</span></a>, as is the <code class="docutils literal notranslate"><span class="pre">pyramid_tm</span></code> transaction manager.</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="hooks.html#registering-tweens"><span class="std std-ref">Registering Tweens</span></a>.</p>
</div>
</div>
<div class="section" id="return-what-you-want-from-your-views">
<h2>Return What You Want From Your Views<a class="headerlink" href="#return-what-you-want-from-your-views" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We have shown elsewhere (in the <a class="reference internal" href="introduction.html"><span class="doc">Pyramid Introduction</span></a>) how using a <a class="reference internal" href="../glossary.html#term-renderer"><span class="xref std std-term">renderer</span></a> allows you to return simple Python dictionaries from your view code. But some frameworks allow you to return strings or tuples from view callables. When frameworks allow for this, code looks slightly prettier because there are fewer imports and less code. For example, compare this:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">aview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>To this:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">aview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Hello world!&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Nicer to look at, right?</p>
<p>Out of the box, <span>Pyramid</span> will raise an exception if you try to run the second example above. After all, a view should return a response, and &quot;explicit is better than implicit&quot;.</p>
<p>But if you're a developer who likes the aesthetics of simplicity, <span>Pyramid</span> provides a way to support this sort of thing, the <a class="reference internal" href="../glossary.html#term-response-adapter"><span class="xref std std-term">response adapter</span></a>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">string_response_adapter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</td></tr></table></div>
<p>A new response adapter is registered in configuration:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_response_adapter</span><span class="p">(</span><span class="n">string_response_adapter</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>With that, you may return strings from any of your view callables, e.g.:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">helloview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Hello world!&quot;</span>

<span class="k">def</span> <span class="nf">goodbyeview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Goodbye world!&quot;</span>
</pre></div>
</td></tr></table></div>
<p>You can even use a <a class="reference internal" href="../glossary.html#term-response-adapter"><span class="xref std std-term">response adapter</span></a> to allow for custom content types and return codes:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>

<span class="k">def</span> <span class="nf">tuple_response_adapter</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="n">status_int</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">val</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="n">content_type</span>
    <span class="n">response</span><span class="o">.</span><span class="n">status_int</span> <span class="o">=</span> <span class="n">status_int</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">string_response_adapter</span><span class="p">(</span><span class="n">body</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">status_int</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_response_adapter</span><span class="p">(</span><span class="n">string_response_adapter</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_response_adapter</span><span class="p">(</span><span class="n">tuple_response_adapter</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>With this, both of these views will work as expected:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">aview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Hello world!&quot;</span>

<span class="k">def</span> <span class="nf">anotherview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="s2">&quot;Forbidden&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="hooks.html#using-iresponse"><span class="std std-ref">Changing How Pyramid Treats View Responses</span></a>.</p>
</div>
</div>
<div class="section" id="use-global-response-objects">
<h2>Use Global Response Objects<a class="headerlink" href="#use-global-response-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Views have to return responses. But constructing them in view code is a chore. And perhaps registering a <a class="reference internal" href="../glossary.html#term-response-adapter"><span class="xref std std-term">response adapter</span></a> as shown above is just too much work. <span>Pyramid</span> provides a global response object as well.  You can use it directly, if you prefer:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">aview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">response</span>
    <span class="n">response</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;Hello world!&#39;</span>
    <span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/plain&#39;</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</td></tr></table></div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="renderers.html#request-response-attr"><span class="std std-ref">Varying Attributes of Rendered Responses</span></a>.</p>
</div>
</div>
<div class="section" id="extend-configuration">
<h2>Extend Configuration<a class="headerlink" href="#extend-configuration" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Perhaps the <span>Pyramid</span> configurator's syntax feels a bit verbose to you. Or possibly you would like to add a feature to configuration without asking the core developers to change <span>Pyramid</span> itself?</p>
<p>You can extend <span>Pyramid</span>'s <a class="reference internal" href="../glossary.html#term-configurator"><span class="xref std std-term">configurator</span></a> with your own directives. For example, let's say you find yourself calling <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_view" title="pyramid.config.Configurator.add_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.add_view()</span></code></a> repetitively. Usually you can get rid of the boring with existing shortcuts, but let's say that this is a case where there is no such shortcut:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;xhr_route&#39;</span><span class="p">,</span> <span class="s1">&#39;/xhr/{id}&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;my.package.GET_view&#39;</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;xhr_route&#39;</span><span class="p">,</span>
                <span class="n">xhr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="n">request_method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;my.package.POST_view&#39;</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;xhr_route&#39;</span><span class="p">,</span>
                <span class="n">xhr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="n">request_method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;my.package.HEAD_view&#39;</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;xhr_route&#39;</span><span class="p">,</span>
                <span class="n">xhr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="n">request_method</span><span class="o">=</span><span class="s1">&#39;HEAD&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Pretty tedious right? You can add a directive to the <span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-configurator"><span class="xref std std-term">configurator</span></a> to automate some of the tedium away:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>

<span class="k">def</span> <span class="nf">add_protected_xhr_views</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">maybe_dotted</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s1">&#39;xhr_</span><span class="si">%s</span><span class="s1">_view&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;xhr_route&#39;</span><span class="p">,</span> <span class="n">xhr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">permission</span><span class="o">=</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="n">request_method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_directive</span><span class="p">(</span><span class="s1">&#39;add_protected_xhr_views&#39;</span><span class="p">,</span> <span class="n">add_protected_xhr_views</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Once that's done, you can call the directive you've just added as a method of the <a class="reference internal" href="../glossary.html#term-configurator"><span class="xref std std-term">configurator</span></a> object:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;xhr_route&#39;</span><span class="p">,</span> <span class="s1">&#39;/xhr/{id}&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_protected_xhr_views</span><span class="p">(</span><span class="s1">&#39;my.package&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Much better!</p>
<p>You can share your configuration code with others, too. Add your code to a Python package. Put the call to <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_directive" title="pyramid.config.Configurator.add_directive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_directive()</span></code></a> in a function. When other programmers install your package, they'll be able to use your configuration by passing your function to a call to <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">include()</span></code></a>.</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="extconfig.html#add-directive"><span class="std std-ref">Adding Methods to the Configurator via add_directive</span></a>.</p>
</div>
</div>
<div class="section" id="introspect-your-application">
<h2>Introspect Your Application<a class="headerlink" href="#introspect-your-application" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>If you're building a large, pluggable system, it's useful to be able to get a list of what has been plugged in <em>at application runtime</em>. For example, you might want to show users a set of tabs at the top of the screen based on a list of the views they registered.</p>
<p><span>Pyramid</span> provides an <a class="reference internal" href="../glossary.html#term-introspector"><span class="xref std std-term">introspector</span></a> for just this purpose.</p>
<p>Here's an example of using <span>Pyramid</span>'s <a class="reference internal" href="../glossary.html#term-introspector"><span class="xref std std-term">introspector</span></a> from within a view:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>
<span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_current_route_pattern</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">introspector</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">introspector</span>
    <span class="n">route_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matched_route</span><span class="o">.</span><span class="n">name</span>
    <span class="n">route_intr</span> <span class="o">=</span> <span class="n">introspector</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;routes&#39;</span><span class="p">,</span> <span class="n">route_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">route_intr</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">]))</span>
</pre></div>
</td></tr></table></div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="introspector.html#using-introspection"><span class="std std-ref">Pyramid Configuration Introspection</span></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Advanced <span>Pyramid</span> Design Features</a><ul>
<li><a class="reference internal" href="#you-don-t-need-singletons">You Don't Need Singletons</a></li>
<li><a class="reference internal" href="#simplify-your-view-code-with-predicates">Simplify your View Code with Predicates</a></li>
<li><a class="reference internal" href="#stop-worrying-about-transactions">Stop Worrying About Transactions</a></li>
<li><a class="reference internal" href="#stop-worrying-about-configuration">Stop Worrying About Configuration</a></li>
<li><a class="reference internal" href="#compose-powerful-apps-from-simple-parts">Compose Powerful Apps From Simple Parts</a></li>
<li><a class="reference internal" href="#authenticate-users-your-way">Authenticate Users Your Way</a></li>
<li><a class="reference internal" href="#build-trees-of-resources">Build Trees of Resources</a></li>
<li><a class="reference internal" href="#take-action-on-each-request-with-tweens">Take Action on Each Request with Tweens</a></li>
<li><a class="reference internal" href="#return-what-you-want-from-your-views">Return What You Want From Your Views</a></li>
<li><a class="reference internal" href="#use-global-response-objects">Use Global Response Objects</a></li>
<li><a class="reference internal" href="#extend-configuration">Extend Configuration</a></li>
<li><a class="reference internal" href="#introspect-your-application">Introspect Your Application</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="introduction.html"
                        title="前の章へ"><span>Pyramid</span> Introduction</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="install.html"
                        title="次の章へ">Installing <span>Pyramid</span></a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/narr/advanced-features.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installing Pyramid"
             >次へ</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Pyramid Introduction"
             >前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="introduction.html" ><span>Pyramid</span> Introduction</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 8月 10, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4 で生成しました。
    </div>
  </body>
</html>