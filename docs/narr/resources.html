
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Resources &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="Hello Traversal World" href="hellotraversal.html" />
    <link rel="prev" title="Unit, Integration, and Functional Testing" href="testing.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="hellotraversal.html" title="Hello Traversal World"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Unit, Integration, and Functional Testing"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="resources">
<span id="resources-chapter"></span><h1>Resources<a class="headerlink" href="#resources" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>A <a class="reference internal" href="../glossary.html#term-resource"><span class="xref std std-term">resource</span></a> is an object that represents a &quot;place&quot; in a tree related to
your application.  Every <span>Pyramid</span> application has at least one resource
object: the <a class="reference internal" href="../glossary.html#term-root"><span class="xref std std-term">root</span></a> resource.  Even if you don't define a root resource
manually, a default one is created for you.  The root resource is the root of a
<a class="reference internal" href="../glossary.html#term-resource-tree"><span class="xref std std-term">resource tree</span></a>.  A resource tree is a set of nested dictionary-like
objects which you can use to represent your website's structure.</p>
<p>In an application which uses <a class="reference internal" href="../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a> to map URLs to code, the
resource tree structure is used heavily to map each URL to a <a class="reference internal" href="../glossary.html#term-view-callable"><span class="xref std std-term">view
callable</span></a>.  When <a class="reference internal" href="../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a> is used, <span>Pyramid</span> will walk through
the resource tree by traversing through its nested dictionary structure in
order to find a <a class="reference internal" href="../glossary.html#term-context"><span class="xref std std-term">context</span></a> resource.  Once a context resource is found,
the context resource and data in the request will be used to find a <a class="reference internal" href="../glossary.html#term-view-callable"><span class="xref std std-term">view
callable</span></a>.</p>
<p>In an application which uses <a class="reference internal" href="../glossary.html#term-url-dispatch"><span class="xref std std-term">URL dispatch</span></a>, the resource tree is only
used indirectly, and is often &quot;invisible&quot; to the developer.  In URL dispatch
applications, the resource &quot;tree&quot; is often composed of only the root resource
by itself.  This root resource sometimes has security declarations attached to
it, but is not required to have any.  In general, the resource tree is much
less important in applications that use URL dispatch than applications that use
traversal.</p>
<p>In &quot;Zope-like&quot; <span>Pyramid</span> applications, resource objects also often store
data persistently, and offer methods related to mutating that persistent data.
In these kinds of applications, resources not only represent the site structure
of your website, but they become the <a class="reference internal" href="../glossary.html#term-domain-model"><span class="xref std std-term">domain model</span></a> of the application.</p>
<p>Also:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">context</span></code> and <code class="docutils literal notranslate"><span class="pre">containment</span></code> predicate arguments to
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_view" title="pyramid.config.Configurator.add_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_view()</span></code></a> (or a
<a class="reference internal" href="../api/view.html#pyramid.view.view_config" title="pyramid.view.view_config"><code class="xref py py-func docutils literal notranslate"><span class="pre">view_config()</span></code></a> decorator) reference a resource class or
resource <a class="reference internal" href="../glossary.html#term-interface"><span class="xref std std-term">interface</span></a>.</li>
<li>A <a class="reference internal" href="../glossary.html#term-root-factory"><span class="xref std std-term">root factory</span></a> returns a resource.</li>
<li>A resource is exposed to <a class="reference internal" href="../glossary.html#term-view"><span class="xref std std-term">view</span></a> code as the <a class="reference internal" href="../glossary.html#term-context"><span class="xref std std-term">context</span></a> of a view.</li>
<li>Various helpful <span>Pyramid</span> API methods expect a resource as an argument
(e.g., <a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a> and others).</li>
</ul>
<div class="section" id="defining-a-resource-tree">
<span id="index-0"></span><h2>Defining a Resource Tree<a class="headerlink" href="#defining-a-resource-tree" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>When <a class="reference internal" href="../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a> is used (as opposed to a purely <a class="reference internal" href="../glossary.html#term-url-dispatch"><span class="xref std std-term">URL dispatch</span></a>
based application), <span>Pyramid</span> expects to be able to traverse a tree
composed of resources (the <a class="reference internal" href="../glossary.html#term-resource-tree"><span class="xref std std-term">resource tree</span></a>).  Traversal begins at a root
resource, and descends into the tree recursively, trying each resource's
<code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method to resolve a path segment to another resource object.
<span>Pyramid</span> imposes the following policy on resource instances in the tree:</p>
<ul class="simple">
<li>A container resource (a resource which contains other resources) must supply
a <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method which is willing to resolve a Unicode name to a
sub-resource.  If a sub-resource by a particular name does not exist in a
container resource, the <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method of the container resource must
raise a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a>.  If a sub-resource by that name <em>does</em> exist, the
container's <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> should return the sub-resource.</li>
<li>Leaf resources, which do not contain other resources, must not implement a
<code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>, or if they do, their <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method must always
raise a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a>.</li>
</ul>
<p>See <a class="reference internal" href="traversal.html#traversal-chapter"><span class="std std-ref">Traversal</span></a> for more information about how traversal works
against resource instances.</p>
<p>Here's a sample resource tree, represented by a variable named <code class="docutils literal notranslate"><span class="pre">root</span></code>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="n">Resource</span><span class="p">({</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">Resource</span><span class="p">({</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="n">Resource</span><span class="p">()})})})</span>
</pre></div>
</td></tr></table></div>
<p>The resource tree we've created above is represented by a dictionary-like root
object which has a single child named <code class="docutils literal notranslate"><span class="pre">'a'</span></code>.  <code class="docutils literal notranslate"><span class="pre">'a'</span></code> has a single child
named <code class="docutils literal notranslate"><span class="pre">'b'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'b'</span></code> has a single child named <code class="docutils literal notranslate"><span class="pre">'c'</span></code>, which has no
children. It is therefore possible to access the <code class="docutils literal notranslate"><span class="pre">'c'</span></code> leaf resource like so:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">root</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<p>If you returned the above <code class="docutils literal notranslate"><span class="pre">root</span></code> object from a <a class="reference internal" href="../glossary.html#term-root-factory"><span class="xref std std-term">root factory</span></a>, the path
<code class="docutils literal notranslate"><span class="pre">/a/b/c</span></code> would find the <code class="docutils literal notranslate"><span class="pre">'c'</span></code> object in the resource tree as the result of
<a class="reference internal" href="../glossary.html#term-traversal"><span class="xref std std-term">traversal</span></a>.</p>
<p>In this example, each of the resources in the tree is of the same class. This
is not a requirement.  Resource elements in the tree can be of any type. We
used a single class to represent all resources in the tree for the sake of
simplicity, but in a &quot;real&quot; app, the resources in the tree can be arbitrary.</p>
<p>Although the example tree above can service a traversal, the resource instances
in the above example are not aware of <a class="reference internal" href="../glossary.html#term-location"><span class="xref std std-term">location</span></a>, so their utility in a
&quot;real&quot; application is limited.  To make best use of built-in <span>Pyramid</span> API
facilities, your resources should be &quot;location-aware&quot;. The next section details
how to make resources location-aware.</p>
</div>
<div class="section" id="location-aware-resources">
<span id="location-aware"></span><span id="index-1"></span><h2>Location-Aware Resources<a class="headerlink" href="#location-aware-resources" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>In order for certain <span>Pyramid</span> location, security, URL-generation, and
traversal APIs to work properly against the resources in a resource tree, all
resources in the tree must be <a class="reference internal" href="../glossary.html#term-location"><span class="xref std std-term">location</span></a>-aware.  This means they must
have two attributes: <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> and <code class="docutils literal notranslate"><span class="pre">__name__</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> attribute of a location-aware resource should be a reference
to the resource's parent resource instance in the tree.  The <code class="docutils literal notranslate"><span class="pre">__name__</span></code>
attribute should be the name with which a resource's parent refers to the
resource via <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> of the root resource should be <code class="docutils literal notranslate"><span class="pre">None</span></code> and its <code class="docutils literal notranslate"><span class="pre">__name__</span></code>
should be the empty string.  For instance:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyRootResource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">__parent__</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</td></tr></table></div>
<p>A resource returned from the root resource's <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method should have
a <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> attribute that is a reference to the root resource, and its
<code class="docutils literal notranslate"><span class="pre">__name__</span></code> attribute should match the name by which it is reachable via the
root resource's <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>.  A container resource within the root resource
should have a <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> that returns resources with a <code class="docutils literal notranslate"><span class="pre">__parent__</span></code>
attribute that points at the container, and these sub-objects should have a
<code class="docutils literal notranslate"><span class="pre">__name__</span></code> attribute that matches the name by which they are retrieved from
the container via <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>.  This pattern continues recursively &quot;up&quot; the
tree from the root.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> attributes of each resource form a linked list that points
&quot;downwards&quot; toward the root. This is analogous to the <code class="docutils literal notranslate"><span class="pre">..</span></code> entry in
filesystem directories. If you follow the <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> values from any
resource in the resource tree, you will eventually come to the root resource,
just like if you keep executing the <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">..</span></code> filesystem command, eventually
you will reach the filesystem root directory.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">If your root resource has a <code class="docutils literal notranslate"><span class="pre">__name__</span></code> argument that is not <code class="docutils literal notranslate"><span class="pre">None</span></code> or
the empty string, URLs returned by the
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource_url()</span></code></a> function, and paths generated
by the <a class="reference internal" href="../api/traversal.html#pyramid.traversal.resource_path" title="pyramid.traversal.resource_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource_path()</span></code></a> and
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.resource_path_tuple" title="pyramid.traversal.resource_path_tuple"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource_path_tuple()</span></code></a> APIs, will be generated
improperly.  The value of <code class="docutils literal notranslate"><span class="pre">__name__</span></code> will be prepended to every path and
URL generated (as opposed to a single leading slash or empty tuple element).</p>
</div>
<div class="sidebar">
<p class="first sidebar-title">For your convenience</p>
<p>If you'd rather not manage the <code class="docutils literal notranslate"><span class="pre">__name__</span></code> and <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> attributes of
your resources &quot;by hand&quot;, an add-on package named
<code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid_traversalwrapper</span></code> can help.</p>
<p>In order to use this helper feature, you must first install the
<code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid_traversalwrapper</span></code> package (available via PyPI), then register
its <code class="docutils literal notranslate"><span class="pre">ModelGraphTraverser</span></code> as the traversal policy, rather than the default
<span>Pyramid</span> traverser. The package contains instructions for doing so.</p>
<p class="last">Once <span>Pyramid</span> is configured with this feature, you will no longer need
to manage the <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> and <code class="docutils literal notranslate"><span class="pre">__name__</span></code> attributes on resource objects
&quot;by hand&quot;.  Instead, as necessary during traversal, <span>Pyramid</span> will wrap
each resource (even the root resource) in a <code class="docutils literal notranslate"><span class="pre">LocationProxy</span></code>, which will
dynamically assign a <code class="docutils literal notranslate"><span class="pre">__name__</span></code> and a <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> to the traversed
resource, based on the last traversed resource and the name supplied to
<code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>.  The root resource will have a <code class="docutils literal notranslate"><span class="pre">__name__</span></code> attribute of
<code class="docutils literal notranslate"><span class="pre">None</span></code> and a <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> attribute of <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<p>Applications which use tree-walking <span>Pyramid</span> APIs require location-aware
resources.  These APIs include (but are not limited to)
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a>,
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_resource" title="pyramid.traversal.find_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_resource()</span></code></a>, <a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_root" title="pyramid.traversal.find_root"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_root()</span></code></a>,
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_interface" title="pyramid.traversal.find_interface"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_interface()</span></code></a>,
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.resource_path" title="pyramid.traversal.resource_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource_path()</span></code></a>,
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.resource_path_tuple" title="pyramid.traversal.resource_path_tuple"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource_path_tuple()</span></code></a>,
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.traverse" title="pyramid.traversal.traverse"><code class="xref py py-func docutils literal notranslate"><span class="pre">traverse()</span></code></a>, <a class="reference internal" href="../api/traversal.html#pyramid.traversal.virtual_root" title="pyramid.traversal.virtual_root"><code class="xref py py-func docutils literal notranslate"><span class="pre">virtual_root()</span></code></a>,
and (usually) <a class="reference internal" href="../api/request.html#pyramid.request.Request.has_permission" title="pyramid.request.Request.has_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_permission()</span></code></a> and
<a class="reference internal" href="../api/security.html#pyramid.security.principals_allowed_by_permission" title="pyramid.security.principals_allowed_by_permission"><code class="xref py py-func docutils literal notranslate"><span class="pre">principals_allowed_by_permission()</span></code></a>.</p>
<p>In general, since so much <span>Pyramid</span> infrastructure depends on
location-aware resources, it's a good idea to make each resource in your tree
location-aware.</p>
</div>
<div class="section" id="generating-the-url-of-a-resource">
<span id="index-2"></span><span id="id1"></span><h2>Generating the URL of a Resource<a class="headerlink" href="#generating-the-url-of-a-resource" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>If your resources are <a class="reference internal" href="../glossary.html#term-location"><span class="xref std std-term">location</span></a>-aware, you can use the
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.request.Request.resource_url()</span></code></a> API to generate a URL for the
resource.  This URL will use the resource's position in the parent tree to
create a resource path, and it will prefix the path with the current
application URL to form a fully-qualified URL with the scheme, host, port, and
path.  You can also pass extra arguments to
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a> to influence the generated URL.</p>
<p>The simplest call to <a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a> looks like
this:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal notranslate"><span class="pre">request</span></code> in the above example is an instance of a <span>Pyramid</span>
<a class="reference internal" href="../glossary.html#term-request"><span class="xref std std-term">request</span></a> object.</p>
<p>If the resource referred to as <code class="docutils literal notranslate"><span class="pre">resource</span></code> in the above example was the root
resource, and the host that was used to contact the server was <code class="docutils literal notranslate"><span class="pre">example.com</span></code>,
the URL generated would be <code class="docutils literal notranslate"><span class="pre">http://example.com/</span></code>. However, if the resource
was a child of the root resource named <code class="docutils literal notranslate"><span class="pre">a</span></code>, the generated URL would be
<code class="docutils literal notranslate"><span class="pre">http://example.com/a/</span></code>.</p>
<p>A slash is appended to all resource URLs when
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a> is used to generate them in this
simple manner, because resources are &quot;places&quot; in the hierarchy, and URLs are
meant to be clicked on to be visited.  Relative URLs that you include on HTML
pages rendered as the result of the default view of a resource are more apt to
be relative to these resources than relative to their parent.</p>
<p>You can also pass extra elements to
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>If the resource referred to as <code class="docutils literal notranslate"><span class="pre">resource</span></code> in the above example was the root
resource, and the host that was used to contact the server was <code class="docutils literal notranslate"><span class="pre">example.com</span></code>,
the URL generated would be <code class="docutils literal notranslate"><span class="pre">http://example.com/foo/bar</span></code>. Any number of extra
elements can be passed to <a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a> as
extra positional arguments. When extra elements are passed, they are appended
to the resource's URL.  A slash is not appended to the final segment when
elements are passed.</p>
<p>You can also pass a query string:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_url</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">})</span>
</pre></div>
</td></tr></table></div>
<p>If the resource referred to as <code class="docutils literal notranslate"><span class="pre">resource</span></code> in the above example was the root
resource, and the host that was used to contact the server was <code class="docutils literal notranslate"><span class="pre">example.com</span></code>,
the URL generated would be <code class="docutils literal notranslate"><span class="pre">http://example.com/?a=1</span></code>.</p>
<p>When a <a class="reference internal" href="../glossary.html#term-virtual-root"><span class="xref std std-term">virtual root</span></a> is active, the URL generated by
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a> for a resource may be &quot;shorter&quot;
than its physical tree path.  See <a class="reference internal" href="vhosting.html#virtual-root-support"><span class="std std-ref">Virtual Root Support</span></a> for more
information about virtually rooting a resource.</p>
<p>For more information about generating resource URLs, see the documentation for
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.request.Request.resource_url()</span></code></a>.</p>
<div class="section" id="overriding-resource-url-generation">
<span id="index-3"></span><span id="id2"></span><h3>Overriding Resource URL Generation<a class="headerlink" href="#overriding-resource-url-generation" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>If a resource object implements a <code class="docutils literal notranslate"><span class="pre">__resource_url__</span></code> method, this method will
be called when <a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a> is called to
generate a URL for the resource, overriding the default URL returned for the
resource by <a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__resource_url__</span></code> hook is passed two arguments: <code class="docutils literal notranslate"><span class="pre">request</span></code> and
<code class="docutils literal notranslate"><span class="pre">info</span></code>.  <code class="docutils literal notranslate"><span class="pre">request</span></code> is the <a class="reference internal" href="../glossary.html#term-request"><span class="xref std std-term">request</span></a> object passed to
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a>.  <code class="docutils literal notranslate"><span class="pre">info</span></code> is a dictionary with
the following keys:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">physical_path</span></code></dt>
<dd>A string representing the &quot;physical path&quot; computed for the resource, as
defined by <code class="docutils literal notranslate"><span class="pre">pyramid.traversal.resource_path(resource)</span></code>.  It will begin and
end with a slash.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">virtual_path</span></code></dt>
<dd>A string representing the &quot;virtual path&quot; computed for the resource, as
defined by <a class="reference internal" href="vhosting.html#virtual-root-support"><span class="std std-ref">Virtual Root Support</span></a>.  This will be identical to the
physical path if virtual rooting is not enabled.  It will begin and end with
a slash.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">app_url</span></code></dt>
<dd>A string representing the application URL generated during
<code class="docutils literal notranslate"><span class="pre">request.resource_url</span></code>.  It will not end with a slash.  It represents a
potentially customized URL prefix, containing potentially custom scheme, host
and port information passed by the user to <code class="docutils literal notranslate"><span class="pre">request.resource_url</span></code>.  It
should be preferred over use of <code class="docutils literal notranslate"><span class="pre">request.application_url</span></code>.</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">__resource_url__</span></code> method of a resource should return a string
representing a URL.  If it cannot override the default, it should return
<code class="docutils literal notranslate"><span class="pre">None</span></code>.  If it returns <code class="docutils literal notranslate"><span class="pre">None</span></code>, the default URL will be returned.</p>
<p>Here's an example <code class="docutils literal notranslate"><span class="pre">__resource_url__</span></code> method.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__resource_url__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;app_url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;virtual_path&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<p>The above example actually just generates and returns the default URL, which
would have been what was generated by the default <code class="docutils literal notranslate"><span class="pre">resource_url</span></code> machinery,
but your code can perform arbitrary logic as necessary.  For example, your code
may wish to override the hostname or port number of the generated URL.</p>
<p>Note that the URL generated by <code class="docutils literal notranslate"><span class="pre">__resource_url__</span></code> should be fully qualified,
should end in a slash, and should not contain any query string or anchor
elements (only path elements) to work with
<a class="reference internal" href="../api/request.html#pyramid.request.Request.resource_url" title="pyramid.request.Request.resource_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resource_url()</span></code></a>.</p>
</div>
</div>
<div class="section" id="generating-the-path-to-a-resource">
<span id="index-4"></span><h2>Generating the Path To a Resource<a class="headerlink" href="#generating-the-path-to-a-resource" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../api/traversal.html#pyramid.traversal.resource_path" title="pyramid.traversal.resource_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.traversal.resource_path()</span></code></a> returns a string object representing
the absolute physical path of the resource object based on its position in the
resource tree.  Each segment of the path is separated with a slash character.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.traversal</span> <span class="kn">import</span> <span class="n">resource_path</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">resource_path</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>If <code class="docutils literal notranslate"><span class="pre">resource</span></code> in the example above was accessible in the tree as
<code class="docutils literal notranslate"><span class="pre">root['a']['b']</span></code>, the above example would generate the string <code class="docutils literal notranslate"><span class="pre">/a/b</span></code>.</p>
<p>Any positional arguments passed in to <a class="reference internal" href="../api/traversal.html#pyramid.traversal.resource_path" title="pyramid.traversal.resource_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource_path()</span></code></a>
will be appended as path segments to the end of the resource path.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.traversal</span> <span class="kn">import</span> <span class="n">resource_path</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">resource_path</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>If <code class="docutils literal notranslate"><span class="pre">resource</span></code> in the example above was accessible in the tree as
<code class="docutils literal notranslate"><span class="pre">root['a']['b']</span></code>, the above example would generate the string
<code class="docutils literal notranslate"><span class="pre">/a/b/foo/bar</span></code>.</p>
<p>The resource passed in must be <a class="reference internal" href="../glossary.html#term-location"><span class="xref std std-term">location</span></a>-aware.</p>
<p>The presence or absence of a <a class="reference internal" href="../glossary.html#term-virtual-root"><span class="xref std std-term">virtual root</span></a> has no impact on the behavior
of <a class="reference internal" href="../api/traversal.html#pyramid.traversal.resource_path" title="pyramid.traversal.resource_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource_path()</span></code></a>.</p>
</div>
<div class="section" id="finding-a-resource-by-path">
<span id="index-5"></span><h2>Finding a Resource by Path<a class="headerlink" href="#finding-a-resource-by-path" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>If you have a string path to a resource, you can grab the resource from that
place in the application's resource tree using
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_resource" title="pyramid.traversal.find_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.traversal.find_resource()</span></code></a>.</p>
<p>You can resolve an absolute path by passing a string prefixed with a <code class="docutils literal notranslate"><span class="pre">/</span></code> as
the <code class="docutils literal notranslate"><span class="pre">path</span></code> argument:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.traversal</span> <span class="kn">import</span> <span class="n">find_resource</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">find_resource</span><span class="p">(</span><span class="n">anyresource</span><span class="p">,</span> <span class="s1">&#39;/path&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Or you can resolve a path relative to the resource that you pass in to
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_resource" title="pyramid.traversal.find_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.traversal.find_resource()</span></code></a> by passing a string that isn't prefixed
by <code class="docutils literal notranslate"><span class="pre">/</span></code>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.traversal</span> <span class="kn">import</span> <span class="n">find_resource</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">find_resource</span><span class="p">(</span><span class="n">anyresource</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Often the paths you pass to <a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_resource" title="pyramid.traversal.find_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_resource()</span></code></a> are
generated by the <a class="reference internal" href="../api/traversal.html#pyramid.traversal.resource_path" title="pyramid.traversal.resource_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource_path()</span></code></a> API.  These APIs are
&quot;mirrors&quot; of each other.</p>
<p>If the path cannot be resolved when calling
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_resource" title="pyramid.traversal.find_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_resource()</span></code></a> (if the respective resource in the
tree does not exist), a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a> will be raised.</p>
<p>See the <a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_resource" title="pyramid.traversal.find_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.traversal.find_resource()</span></code></a> documentation for more
information about resolving a path to a resource.</p>
</div>
<div class="section" id="obtaining-the-lineage-of-a-resource">
<span id="index-6"></span><h2>Obtaining the Lineage of a Resource<a class="headerlink" href="#obtaining-the-lineage-of-a-resource" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../api/location.html#pyramid.location.lineage" title="pyramid.location.lineage"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.location.lineage()</span></code></a> returns a generator representing the
<a class="reference internal" href="../glossary.html#term-lineage"><span class="xref std std-term">lineage</span></a> of the <a class="reference internal" href="../glossary.html#term-location"><span class="xref std std-term">location</span></a>-aware <a class="reference internal" href="../glossary.html#term-resource"><span class="xref std std-term">resource</span></a> object.</p>
<p>The <a class="reference internal" href="../api/location.html#pyramid.location.lineage" title="pyramid.location.lineage"><code class="xref py py-func docutils literal notranslate"><span class="pre">lineage()</span></code></a> function returns the resource that is
passed into it, then each parent of the resource in order.  For example, if the
resource tree is composed like so:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Thing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">thing1</span> <span class="o">=</span> <span class="n">Thing</span><span class="p">()</span>
<span class="n">thing2</span> <span class="o">=</span> <span class="n">Thing</span><span class="p">()</span>
<span class="n">thing2</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">thing1</span>
</pre></div>
</td></tr></table></div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">lineage(thing2)</span></code> will return a generator.  When we turn it into a
list, we will get:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">lineage</span><span class="p">(</span><span class="n">thing2</span><span class="p">))</span>
<span class="p">[</span> <span class="o">&lt;</span><span class="n">Thing</span> <span class="nb">object</span> <span class="n">at</span> <span class="n">thing2</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Thing</span> <span class="nb">object</span> <span class="n">at</span> <span class="n">thing1</span><span class="o">&gt;</span> <span class="p">]</span>
</pre></div>
</td></tr></table></div>
<p>The generator returned by <a class="reference internal" href="../api/location.html#pyramid.location.lineage" title="pyramid.location.lineage"><code class="xref py py-func docutils literal notranslate"><span class="pre">lineage()</span></code></a> first returns
unconditionally the resource that was passed into it.  Then, if the resource
supplied a <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> attribute, it returns the resource represented by
<code class="docutils literal notranslate"><span class="pre">resource.__parent__</span></code>.  If <em>that</em> resource has a <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> attribute, it
will return that resource's parent, and so on, until the resource being
inspected either has no <code class="docutils literal notranslate"><span class="pre">__parent__</span></code> attribute or has a <code class="docutils literal notranslate"><span class="pre">__parent__</span></code>
attribute of <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>See the documentation for <a class="reference internal" href="../api/location.html#pyramid.location.lineage" title="pyramid.location.lineage"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.location.lineage()</span></code></a> for more
information.</p>
</div>
<div class="section" id="determining-if-a-resource-is-in-the-lineage-of-another-resource">
<h2>Determining if a Resource is in the Lineage of Another Resource<a class="headerlink" href="#determining-if-a-resource-is-in-the-lineage-of-another-resource" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Use the <a class="reference internal" href="../api/location.html#pyramid.location.inside" title="pyramid.location.inside"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.location.inside()</span></code></a> function to determine if one resource
is in the <a class="reference internal" href="../glossary.html#term-lineage"><span class="xref std std-term">lineage</span></a> of another resource.</p>
<p>For example, if the resource tree is:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Thing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Thing</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Thing</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">a</span>
</pre></div>
</td></tr></table></div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">inside(b,</span> <span class="pre">a)</span></code> will return <code class="docutils literal notranslate"><span class="pre">True</span></code>, because <code class="docutils literal notranslate"><span class="pre">b</span></code> has a lineage that
includes <code class="docutils literal notranslate"><span class="pre">a</span></code>.  However, calling <code class="docutils literal notranslate"><span class="pre">inside(a,</span> <span class="pre">b)</span></code> will return <code class="docutils literal notranslate"><span class="pre">False</span></code>
because <code class="docutils literal notranslate"><span class="pre">a</span></code> does not have a lineage that includes <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>The argument list for <a class="reference internal" href="../api/location.html#pyramid.location.inside" title="pyramid.location.inside"><code class="xref py py-func docutils literal notranslate"><span class="pre">inside()</span></code></a> is <code class="docutils literal notranslate"><span class="pre">(resource1,</span>
<span class="pre">resource2)</span></code>.  <code class="docutils literal notranslate"><span class="pre">resource1</span></code> is &quot;inside&quot; <code class="docutils literal notranslate"><span class="pre">resource2</span></code> if <code class="docutils literal notranslate"><span class="pre">resource2</span></code> is a
<a class="reference internal" href="../glossary.html#term-lineage"><span class="xref std std-term">lineage</span></a> ancestor of <code class="docutils literal notranslate"><span class="pre">resource1</span></code>.  It is a lineage ancestor if its
parent (or one of its parent's parents, etc.) is an ancestor.</p>
<p>See <a class="reference internal" href="../api/location.html#pyramid.location.inside" title="pyramid.location.inside"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.location.inside()</span></code></a> for more information.</p>
</div>
<div class="section" id="finding-the-root-resource">
<span id="index-7"></span><h2>Finding the Root Resource<a class="headerlink" href="#finding-the-root-resource" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Use the <a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_root" title="pyramid.traversal.find_root"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.traversal.find_root()</span></code></a> API to find the <a class="reference internal" href="../glossary.html#term-root"><span class="xref std std-term">root</span></a>
resource.  The root resource is the resource at the root of the <a class="reference internal" href="../glossary.html#term-resource-tree"><span class="xref std std-term">resource
tree</span></a>. The API accepts a single argument: <code class="docutils literal notranslate"><span class="pre">resource</span></code>.  This is a resource
that is <a class="reference internal" href="../glossary.html#term-location"><span class="xref std std-term">location</span></a>-aware.  It can be any resource in the tree for which
you want to find the root.</p>
<p>For example, if the resource tree is:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Thing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Thing</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Thing</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">a</span>
</pre></div>
</td></tr></table></div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">find_root(b)</span></code> will return <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<p>The root resource is also available as <code class="docutils literal notranslate"><span class="pre">request.root</span></code> within <a class="reference internal" href="../glossary.html#term-view-callable"><span class="xref std std-term">view
callable</span></a> code.</p>
<p>The presence or absence of a <a class="reference internal" href="../glossary.html#term-virtual-root"><span class="xref std std-term">virtual root</span></a> has no impact on the behavior
of <a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_root" title="pyramid.traversal.find_root"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_root()</span></code></a>.  The root object returned is always
the <em>physical</em> root object.</p>
</div>
<div class="section" id="resources-which-implement-interfaces">
<span id="index-8"></span><span id="id3"></span><h2>Resources Which Implement Interfaces<a class="headerlink" href="#resources-which-implement-interfaces" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Resources can optionally be made to implement an <a class="reference internal" href="../glossary.html#term-interface"><span class="xref std std-term">interface</span></a>.  An
interface is used to tag a resource object with a &quot;type&quot; that later can be
referred to within <a class="reference internal" href="../glossary.html#term-view-configuration"><span class="xref std std-term">view configuration</span></a> and by
<a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_interface" title="pyramid.traversal.find_interface"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyramid.traversal.find_interface()</span></code></a>.</p>
<p>Specifying an interface instead of a class as the <code class="docutils literal notranslate"><span class="pre">context</span></code> or
<code class="docutils literal notranslate"><span class="pre">containment</span></code> predicate arguments within <a class="reference internal" href="../glossary.html#term-view-configuration"><span class="xref std std-term">view configuration</span></a>
statements makes it possible to use a single view callable for more than one
class of resource objects.  If your application is simple enough that you see
no reason to want to do this, you can skip reading this section of the chapter.</p>
<p>For example, here's some code which describes a blog entry which also declares
that the blog entry implements an <a class="reference internal" href="../glossary.html#term-interface"><span class="xref std std-term">interface</span></a>.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>

<span class="k">class</span> <span class="nc">IBlogEntry</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IBlogEntry</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BlogEntry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>This resource consists of two things: the class which defines the resource
constructor as the class <code class="docutils literal notranslate"><span class="pre">BlogEntry</span></code>, and an <a class="reference internal" href="../glossary.html#term-interface"><span class="xref std std-term">interface</span></a> attached to
the class via an <code class="docutils literal notranslate"><span class="pre">implementer</span></code> class decorator using the <code class="docutils literal notranslate"><span class="pre">IBlogEntry</span></code>
interface as its sole argument.</p>
<p>The interface object used must be an instance of a class that inherits from
<a class="reference external" href="http://zopeinterface.readthedocs.io/en/latest/api/specifications.html#zope.interface.Interface" title="(in zope.interface v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">zope.interface.Interface</span></code></a>.</p>
<p>A resource class may implement zero or more interfaces.  You specify that a
resource implements an interface by using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">zope.interface.implementer()</span></code> function as a class decorator.  The above
<code class="docutils literal notranslate"><span class="pre">BlogEntry</span></code> resource implements the <code class="docutils literal notranslate"><span class="pre">IBlogEntry</span></code> interface.</p>
<p>You can also specify that a particular resource <em>instance</em> provides an
interface as opposed to its class.  When you declare that a class implements an
interface, all instances of that class will also provide that interface.
However, you can also just say that a single object provides the interface. To
do so, use the <code class="xref py py-func docutils literal notranslate"><span class="pre">zope.interface.directlyProvides()</span></code> function:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">directlyProvides</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>

<span class="k">class</span> <span class="nc">IBlogEntry</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">BlogEntry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">entry</span> <span class="o">=</span> <span class="n">BlogEntry</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">)</span>
<span class="n">directlyProvides</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">IBlogEntry</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">zope.interface.directlyProvides()</span></code> will replace any existing interface
that was previously provided by an instance.  If a resource object already has
instance-level interface declarations that you don't want to replace, use the
<code class="xref py py-func docutils literal notranslate"><span class="pre">zope.interface.alsoProvides()</span></code> function:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">alsoProvides</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">directlyProvides</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>

<span class="k">class</span> <span class="nc">IBlogEntry1</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">IBlogEntry2</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">BlogEntry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">entry</span> <span class="o">=</span> <span class="n">BlogEntry</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">)</span>
<span class="n">directlyProvides</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">IBlogEntry1</span><span class="p">)</span>
<span class="n">alsoProvides</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">IBlogEntry2</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">zope.interface.alsoProvides()</span></code> will augment the set of interfaces directly
provided by an instance instead of overwriting them like
<code class="xref py py-func docutils literal notranslate"><span class="pre">zope.interface.directlyProvides()</span></code> does.</p>
<p>For more information about how resource interfaces can be used by view
configuration, see <a class="reference internal" href="traversal.html#using-resource-interfaces"><span class="std std-ref">Using Resource Interfaces in View Configuration</span></a>.</p>
</div>
<div class="section" id="finding-a-resource-with-a-class-or-interface-in-lineage">
<span id="index-9"></span><h2>Finding a Resource with a Class or Interface in Lineage<a class="headerlink" href="#finding-a-resource-with-a-class-or-interface-in-lineage" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Use the <a class="reference internal" href="../api/traversal.html#pyramid.traversal.find_interface" title="pyramid.traversal.find_interface"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_interface()</span></code></a> API to locate a parent that
is of a particular Python class, or which implements some <a class="reference internal" href="../glossary.html#term-interface"><span class="xref std std-term">interface</span></a>.</p>
<p>For example, if your resource tree is composed as follows:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Thing1</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Thing2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Thing1</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Thing2</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">__parent__</span> <span class="o">=</span> <span class="n">a</span>
</pre></div>
</td></tr></table></div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">find_interface(a,</span> <span class="pre">Thing1)</span></code> will return the <code class="docutils literal notranslate"><span class="pre">a</span></code> resource because
<code class="docutils literal notranslate"><span class="pre">a</span></code> is of class <code class="docutils literal notranslate"><span class="pre">Thing1</span></code> (the resource passed as the first argument is
considered first, and is returned if the class or interface specification
matches).</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">find_interface(b,</span> <span class="pre">Thing1)</span></code> will return the <code class="docutils literal notranslate"><span class="pre">a</span></code> resource because
<code class="docutils literal notranslate"><span class="pre">a</span></code> is of class <code class="docutils literal notranslate"><span class="pre">Thing1</span></code> and <code class="docutils literal notranslate"><span class="pre">a</span></code> is the first resource in <code class="docutils literal notranslate"><span class="pre">b</span></code>'s lineage
of this class.</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">find_interface(b,</span> <span class="pre">Thing2)</span></code> will return the <code class="docutils literal notranslate"><span class="pre">b</span></code> resource.</p>
<p>The second argument to <code class="docutils literal notranslate"><span class="pre">find_interface</span></code> may also be a <a class="reference internal" href="../glossary.html#term-interface"><span class="xref std std-term">interface</span></a>
instead of a class.  If it is an interface, each resource in the lineage is
checked to see if the resource implements the specificed interface (instead of
seeing if the resource is of a class).</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="#resources-which-implement-interfaces"><span class="std std-ref">Resources Which Implement Interfaces</span></a>.</p>
</div>
</div>
<div class="section" id="pyramid-api-functions-that-act-against-resources">
<span id="index-10"></span><h2><span>Pyramid</span> API Functions That Act Against Resources<a class="headerlink" href="#pyramid-api-functions-that-act-against-resources" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>A resource object is used as the <a class="reference internal" href="../glossary.html#term-context"><span class="xref std std-term">context</span></a> provided to a view.  See
<a class="reference internal" href="traversal.html#traversal-chapter"><span class="std std-ref">Traversal</span></a> and <a class="reference internal" href="urldispatch.html#urldispatch-chapter"><span class="std std-ref">URL Dispatch</span></a> for more information
about how a resource object becomes the context.</p>
<p>The APIs provided by <a class="reference internal" href="../api/traversal.html#traversal-module"><span class="std std-ref">pyramid.traversal</span></a> are used against resource objects.
These functions can be used to find the &quot;path&quot; of a resource, the root resource
in a resource tree, or to generate a URL for a resource.</p>
<p>The APIs provided by <a class="reference internal" href="../api/location.html#location-module"><span class="std std-ref">pyramid.location</span></a> are used against resources. These
can be used to walk down a resource tree, or conveniently locate one resource
&quot;inside&quot; another.</p>
<p>Some APIs on the <a class="reference internal" href="../api/request.html#pyramid.request.Request" title="pyramid.request.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.request.Request</span></code></a> accept a resource object as a
parameter. For example, the <a class="reference internal" href="../api/request.html#pyramid.request.Request.has_permission" title="pyramid.request.Request.has_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_permission()</span></code></a> API
accepts a resource object as one of its arguments; the ACL is obtained from
this resource or one of its ancestors.  Other security related APIs on the
<a class="reference internal" href="../api/request.html#pyramid.request.Request" title="pyramid.request.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.request.Request</span></code></a> class also accept <a class="reference internal" href="../glossary.html#term-context"><span class="xref std std-term">context</span></a> as an
argument, and a context is always a resource.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Resources</a><ul>
<li><a class="reference internal" href="#defining-a-resource-tree">Defining a Resource Tree</a></li>
<li><a class="reference internal" href="#location-aware-resources">Location-Aware Resources</a></li>
<li><a class="reference internal" href="#generating-the-url-of-a-resource">Generating the URL of a Resource</a><ul>
<li><a class="reference internal" href="#overriding-resource-url-generation">Overriding Resource URL Generation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-the-path-to-a-resource">Generating the Path To a Resource</a></li>
<li><a class="reference internal" href="#finding-a-resource-by-path">Finding a Resource by Path</a></li>
<li><a class="reference internal" href="#obtaining-the-lineage-of-a-resource">Obtaining the Lineage of a Resource</a></li>
<li><a class="reference internal" href="#determining-if-a-resource-is-in-the-lineage-of-another-resource">Determining if a Resource is in the Lineage of Another Resource</a></li>
<li><a class="reference internal" href="#finding-the-root-resource">Finding the Root Resource</a></li>
<li><a class="reference internal" href="#resources-which-implement-interfaces">Resources Which Implement Interfaces</a></li>
<li><a class="reference internal" href="#finding-a-resource-with-a-class-or-interface-in-lineage">Finding a Resource with a Class or Interface in Lineage</a></li>
<li><a class="reference internal" href="#pyramid-api-functions-that-act-against-resources"><span>Pyramid</span> API Functions That Act Against Resources</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="testing.html"
                        title="前の章へ">Unit, Integration, and Functional Testing</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="hellotraversal.html"
                        title="次の章へ">Hello Traversal World</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/narr/resources.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="hellotraversal.html" title="Hello Traversal World"
             >次へ</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Unit, Integration, and Functional Testing"
             >前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 8月 15, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4 で生成しました。
    </div>
  </body>
</html>