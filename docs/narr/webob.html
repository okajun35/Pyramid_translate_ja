
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Request and Response Objects &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="Sessions" href="sessions.html" />
    <link rel="prev" title="Static Assets" href="assets.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="sessions.html" title="Sessions"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="assets.html" title="Static Assets"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="request-and-response-objects">
<span id="webob-chapter"></span><span id="index-0"></span><h1>Request and Response Objects<a class="headerlink" href="#request-and-response-objects" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This chapter is adapted from a portion of the <a class="reference internal" href="../glossary.html#term-webob"><span class="xref std std-term">WebOb</span></a>
documentation, originally written by Ian Bicking.</p>
</div>
<p><span>Pyramid</span> uses the <a class="reference internal" href="../glossary.html#term-webob"><span class="xref std std-term">WebOb</span></a> package as a basis for its
<a class="reference internal" href="../glossary.html#term-request"><span class="xref std std-term">request</span></a> and <a class="reference internal" href="../glossary.html#term-response"><span class="xref std std-term">response</span></a> object implementations.  The
<a class="reference internal" href="../glossary.html#term-request"><span class="xref std std-term">request</span></a> object that is passed to a <span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-view"><span class="xref std std-term">view</span></a> is an
instance of the <a class="reference internal" href="../api/request.html#pyramid.request.Request" title="pyramid.request.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.request.Request</span></code></a> class, which is a subclass of
<a class="reference external" href="https://docs.pylonsproject.org/projects/pylons-webframework/en/latest/thirdparty/webob.html#webob.Request" title="(in Pylons Framework v1.0.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">webob.Request</span></code></a>.  The <a class="reference internal" href="../glossary.html#term-response"><span class="xref std std-term">response</span></a> returned from a <span>Pyramid</span>
<a class="reference internal" href="../glossary.html#term-view"><span class="xref std std-term">view</span></a> <a class="reference internal" href="../glossary.html#term-renderer"><span class="xref std std-term">renderer</span></a> is an instance of the
<a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a> class, which is a subclass of the
<a class="reference external" href="https://docs.pylonsproject.org/projects/pylons-webframework/en/latest/thirdparty/webob.html#webob.Response" title="(in Pylons Framework v1.0.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">webob.Response</span></code></a> class.  Users can also return an instance of
<a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a> directly from a view as necessary.</p>
<p>WebOb is a project separate from <span>Pyramid</span> with a separate set of authors
and a fully separate <a class="reference external" href="http://docs.webob.org/en/latest/index.html">set of documentation</a>.  <span>Pyramid</span> adds some
functionality to the standard WebOb request, which is documented in the
<a class="reference internal" href="../api/request.html#request-module"><span class="std std-ref">pyramid.request</span></a> API documentation.</p>
<p>WebOb provides objects for HTTP requests and responses.  Specifically it does
this by wrapping the <a class="reference external" href="https://wsgi.readthedocs.io/en/latest/">WSGI</a> request
environment and response status, header list, and app_iter (body) values.</p>
<p>WebOb request and response objects provide many conveniences for parsing WSGI
requests and forming WSGI responses.  WebOb is a nice way to represent &quot;raw&quot;
WSGI requests and responses.  However, we won't cover that use case in this
document, as users of <span>Pyramid</span> don't typically need to use the
WSGI-related features of WebOb directly.  The <a class="reference external" href="http://docs.webob.org/en/latest/reference.html">reference documentation</a> shows many examples of
creating requests and using response objects in this manner, however.</p>
<div class="section" id="request">
<span id="index-1"></span><h2>Request<a class="headerlink" href="#request" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The request object is a wrapper around the <a class="reference external" href="https://www.python.org/dev/peps/pep-0333/#environ-variables">WSGI environ dictionary</a>.  This
dictionary contains keys for each header, keys that describe the request
(including the path and query string), a file-like object for the request body,
and a variety of custom keys.  You can always access the environ with
<code class="docutils literal notranslate"><span class="pre">req.environ</span></code>.</p>
<p>Some of the most important and interesting attributes of a request object are
below.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">req.method</span></code></dt>
<dd>The request method, e.g., <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.GET</span></code></dt>
<dd>A <a class="reference internal" href="../glossary.html#term-multidict"><span class="xref std std-term">multidict</span></a> with all the variables in the query string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.POST</span></code></dt>
<dd>A <a class="reference internal" href="../glossary.html#term-multidict"><span class="xref std std-term">multidict</span></a> with all the variables in the request body.  This only
has variables if the request was a <code class="docutils literal notranslate"><span class="pre">POST</span></code> and it is a form submission.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.params</span></code></dt>
<dd>A <a class="reference internal" href="../glossary.html#term-multidict"><span class="xref std std-term">multidict</span></a> with a combination of everything in <code class="docutils literal notranslate"><span class="pre">req.GET</span></code> and
<code class="docutils literal notranslate"><span class="pre">req.POST</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.body</span></code></dt>
<dd>The contents of the body of the request.  This contains the entire request
body as a string.  This is useful when the request is a <code class="docutils literal notranslate"><span class="pre">POST</span></code> that is
<em>not</em> a form submission, or a request like a <code class="docutils literal notranslate"><span class="pre">PUT</span></code>.  You can also get
<code class="docutils literal notranslate"><span class="pre">req.body_file</span></code> for a file-like object.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.json_body</span></code></dt>
<dd>The JSON-decoded contents of the body of the request. See
<a class="reference internal" href="#request-json-body"><span class="std std-ref">Dealing with a JSON-Encoded Request Body</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.cookies</span></code></dt>
<dd>A simple dictionary of all the cookies.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.headers</span></code></dt>
<dd>A dictionary of all the headers.  This dictionary is case-insensitive.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.urlvars</span></code> and <code class="docutils literal notranslate"><span class="pre">req.urlargs</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">req.urlvars</span></code> are the keyword parameters associated with the request URL.
<code class="docutils literal notranslate"><span class="pre">req.urlargs</span></code> are the positional parameters. These are set by products
like <a class="reference external" href="https://routes.readthedocs.io/en/latest/">Routes</a> and <a class="reference external" href="https://github.com/lukearno/selector">Selector</a>.</dd>
</dl>
<p>Also for standard HTTP request headers, there are usually attributes such as
<code class="docutils literal notranslate"><span class="pre">req.accept_language</span></code>, <code class="docutils literal notranslate"><span class="pre">req.content_length</span></code>, and <code class="docutils literal notranslate"><span class="pre">req.user_agent</span></code>.  These
properties expose the <em>parsed</em> form of each header, for whatever parsing makes
sense.  For instance, <code class="docutils literal notranslate"><span class="pre">req.if_modified_since</span></code> returns a <a class="reference external" href="https://docs.python.org/3/library/datetime.html#module-datetime" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">datetime</span></code></a>
object (or None if the header is was not provided).</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Full API documentation for the <span>Pyramid</span> request object is
available in <a class="reference internal" href="../api/request.html#request-module"><span class="std std-ref">pyramid.request</span></a>.</p>
</div>
<div class="section" id="special-attributes-added-to-the-request-by-pyramid">
<span id="special-request-attributes"></span><span id="index-2"></span><h3>Special Attributes Added to the Request by <span>Pyramid</span><a class="headerlink" href="#special-attributes-added-to-the-request-by-pyramid" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>In addition to the standard <a class="reference internal" href="../glossary.html#term-webob"><span class="xref std std-term">WebOb</span></a> attributes, <span>Pyramid</span> adds
special attributes to every request: <code class="docutils literal notranslate"><span class="pre">context</span></code>, <code class="docutils literal notranslate"><span class="pre">registry</span></code>, <code class="docutils literal notranslate"><span class="pre">root</span></code>,
<code class="docutils literal notranslate"><span class="pre">subpath</span></code>, <code class="docutils literal notranslate"><span class="pre">traversed</span></code>, <code class="docutils literal notranslate"><span class="pre">view_name</span></code>, <code class="docutils literal notranslate"><span class="pre">virtual_root</span></code>,
<code class="docutils literal notranslate"><span class="pre">virtual_root_path</span></code>, <code class="docutils literal notranslate"><span class="pre">session</span></code>, <code class="docutils literal notranslate"><span class="pre">matchdict</span></code>, and <code class="docutils literal notranslate"><span class="pre">matched_route</span></code>. These
attributes are documented further within the <a class="reference internal" href="../api/request.html#pyramid.request.Request" title="pyramid.request.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.request.Request</span></code></a>
API documentation.</p>
</div>
<div class="section" id="urls">
<span id="index-3"></span><h3>URLs<a class="headerlink" href="#urls" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>In addition to these attributes, there are several ways to get the URL of the
request and its parts.  We'll show various values for an example URL
<code class="docutils literal notranslate"><span class="pre">http://localhost/app/blog?id=10</span></code>, where the application is mounted at
<code class="docutils literal notranslate"><span class="pre">http://localhost/app</span></code>.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">req.url</span></code></dt>
<dd>The full request URL with query string, e.g.,
<code class="docutils literal notranslate"><span class="pre">http://localhost/app/blog?id=10</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.host</span></code></dt>
<dd>The host information in the URL, e.g., <code class="docutils literal notranslate"><span class="pre">localhost</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.host_url</span></code></dt>
<dd>The URL with the host, e.g., <code class="docutils literal notranslate"><span class="pre">http://localhost</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.application_url</span></code></dt>
<dd>The URL of the application (just the <code class="docutils literal notranslate"><span class="pre">SCRIPT_NAME</span></code> portion of the path,
not <code class="docutils literal notranslate"><span class="pre">PATH_INFO</span></code>), e.g., <code class="docutils literal notranslate"><span class="pre">http://localhost/app</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.path_url</span></code></dt>
<dd>The URL of the application including the <code class="docutils literal notranslate"><span class="pre">PATH_INFO</span></code>, e.g.,
<code class="docutils literal notranslate"><span class="pre">http://localhost/app/blog</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.path</span></code></dt>
<dd>The URL including <code class="docutils literal notranslate"><span class="pre">PATH_INFO</span></code> without the host or scheme, e.g.,
<code class="docutils literal notranslate"><span class="pre">/app/blog</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.path_qs</span></code></dt>
<dd>The URL including <code class="docutils literal notranslate"><span class="pre">PATH_INFO</span></code> and the query string, e.g,
<code class="docutils literal notranslate"><span class="pre">/app/blog?id=10</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.query_string</span></code></dt>
<dd>The query string in the URL, e.g., <code class="docutils literal notranslate"><span class="pre">id=10</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.relative_url(url,</span> <span class="pre">to_application=False)</span></code></dt>
<dd>Gives a URL relative to the current URL.  If <code class="docutils literal notranslate"><span class="pre">to_application</span></code> is True,
then resolves it relative to <code class="docutils literal notranslate"><span class="pre">req.application_url</span></code>.</dd>
</dl>
</div>
<div class="section" id="methods">
<span id="index-4"></span><h3>Methods<a class="headerlink" href="#methods" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>There are methods of request objects documented in
<a class="reference internal" href="../api/request.html#pyramid.request.Request" title="pyramid.request.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.request.Request</span></code></a> but you'll find that you won't use very many
of them.  Here are a couple that might be useful:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Request.blank(base_url)</span></code></dt>
<dd>Creates a new request with blank information, based at the given URL.  This
can be useful for subrequests and artificial requests.  You can also use
<code class="docutils literal notranslate"><span class="pre">req.copy()</span></code> to copy an existing request, or for subrequests
<code class="docutils literal notranslate"><span class="pre">req.copy_get()</span></code> which copies the request but always turns it into a GET
(which is safer to share for subrequests).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req.get_response(wsgi_application)</span></code></dt>
<dd>This method calls the given WSGI application with this request, and returns
a <a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a> object.  You can also use this for
subrequests or testing.</dd>
</dl>
</div>
<div class="section" id="text-unicode">
<span id="index-5"></span><h3>Text (Unicode)<a class="headerlink" href="#text-unicode" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Many of the properties of the request object will be text values (<code class="docutils literal notranslate"><span class="pre">unicode</span></code>
under Python 2 or <code class="docutils literal notranslate"><span class="pre">str</span></code> under Python 3) if the request encoding/charset is
provided.  If it is provided, the values in <code class="docutils literal notranslate"><span class="pre">req.POST</span></code>, <code class="docutils literal notranslate"><span class="pre">req.GET</span></code>,
<code class="docutils literal notranslate"><span class="pre">req.params</span></code>, and <code class="docutils literal notranslate"><span class="pre">req.cookies</span></code> will contain text.  The client <em>can</em>
indicate the charset with something like <code class="docutils literal notranslate"><span class="pre">Content-Type:</span>
<span class="pre">application/x-www-form-urlencoded;</span> <span class="pre">charset=utf8</span></code>, but browsers seldom set
this.  You can reset the charset of an existing request with <code class="docutils literal notranslate"><span class="pre">newreq</span> <span class="pre">=</span>
<span class="pre">req.decode('utf-8')</span></code>, or during instantiation with <code class="docutils literal notranslate"><span class="pre">Request(environ,</span>
<span class="pre">charset='utf8')</span></code>.</p>
</div>
<div class="section" id="multidict">
<span id="multidict-narr"></span><span id="index-6"></span><h3>Multidict<a class="headerlink" href="#multidict" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Several attributes of a WebOb request are multidict structures (such as
<code class="docutils literal notranslate"><span class="pre">request.GET</span></code>, <code class="docutils literal notranslate"><span class="pre">request.POST</span></code>, and <code class="docutils literal notranslate"><span class="pre">request.params</span></code>).  A multidict is a
dictionary where a key can have multiple values.  The quintessential example is
a query string like <code class="docutils literal notranslate"><span class="pre">?pref=red&amp;pref=blue</span></code>; the <code class="docutils literal notranslate"><span class="pre">pref</span></code> variable has two
values: <code class="docutils literal notranslate"><span class="pre">red</span></code> and <code class="docutils literal notranslate"><span class="pre">blue</span></code>.</p>
<p>In a multidict, when you do <code class="docutils literal notranslate"><span class="pre">request.GET['pref']</span></code>, you'll get back only
<code class="docutils literal notranslate"><span class="pre">&quot;blue&quot;</span></code> (the last value of <code class="docutils literal notranslate"><span class="pre">pref</span></code>).  This returned result might not be
expected—sometimes returning a string, and sometimes returning a list—and may
be cause of frequent exceptions.  If you want <em>all</em> the values back, use
<code class="docutils literal notranslate"><span class="pre">request.GET.getall('pref')</span></code>.  If you want to be sure there is <em>one and only
one</em> value, use <code class="docutils literal notranslate"><span class="pre">request.GET.getone('pref')</span></code>, which will raise an exception
if there is zero or more than one value for <code class="docutils literal notranslate"><span class="pre">pref</span></code>.</p>
<p>When you use operations like <code class="docutils literal notranslate"><span class="pre">request.GET.items()</span></code>, you'll get back something
like <code class="docutils literal notranslate"><span class="pre">[('pref',</span> <span class="pre">'red'),</span> <span class="pre">('pref',</span> <span class="pre">'blue')]</span></code>.  All the key/value pairs will
show up.  Similarly <code class="docutils literal notranslate"><span class="pre">request.GET.keys()</span></code> returns <code class="docutils literal notranslate"><span class="pre">['pref',</span> <span class="pre">'pref']</span></code>.
Multidict is a view on a list of tuples; all the keys are ordered, and all the
values are ordered.</p>
<p>API documentation for a multidict exists as
<a class="reference internal" href="../api/interfaces.html#pyramid.interfaces.IMultiDict" title="pyramid.interfaces.IMultiDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.interfaces.IMultiDict</span></code></a>.</p>
</div>
<div class="section" id="dealing-with-a-json-encoded-request-body">
<span id="request-json-body"></span><span id="index-7"></span><h3>Dealing with a JSON-Encoded Request Body<a class="headerlink" href="#dealing-with-a-json-encoded-request-body" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">バージョン 1.1 で追加.</span></p>
</div>
<p><a class="reference internal" href="../api/request.html#pyramid.request.Request.json_body" title="pyramid.request.Request.json_body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pyramid.request.Request.json_body</span></code></a> is a property that returns a
<a class="reference internal" href="../glossary.html#term-json"><span class="xref std std-term">JSON</span></a>-decoded representation of the request body.  If the request does
not have a body, or the body is not a properly JSON-encoded value, an exception
will be raised when this attribute is accessed.</p>
<p>This attribute is useful when you invoke a <span>Pyramid</span> view callable via,
for example, jQuery's <code class="docutils literal notranslate"><span class="pre">$.ajax</span></code> function, which has the potential to send a
request with a JSON-encoded body.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">request.json_body</span></code> is equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">loads</span>
<span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
</pre></div>
</div>
<p>Here's how to construct an AJAX request in JavaScript using <a class="reference internal" href="../glossary.html#term-jquery"><span class="xref std std-term">jQuery</span></a> that
allows you to use the <code class="docutils literal notranslate"><span class="pre">request.json_body</span></code> attribute when the request is sent
to a <span>Pyramid</span> application:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
             <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:6543/&#39;</span><span class="p">,</span> <span class="c1">// the pyramid server</span>
             <span class="nx">data</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">}),</span>
             <span class="nx">contentType</span><span class="o">:</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span><span class="p">});</span>
</pre></div>
</div>
<p>When such a request reaches a view in your application, the
<code class="docutils literal notranslate"><span class="pre">request.json_body</span></code> attribute will be available in the view callable body.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">aview</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json_body</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;OK&#39;</span>
</pre></div>
</div>
<p>For the above view, printed to the console will be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="sa">u</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p>For bonus points, here's a bit of client-side code that will produce a request
that has a body suitable for reading via <code class="docutils literal notranslate"><span class="pre">request.json_body</span></code> using Python's
<code class="docutils literal notranslate"><span class="pre">urllib2</span></code> instead of a JavaScript AJAX request:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">json_payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span><span class="s1">&#39;application/json; charset=utf-8&#39;</span><span class="p">}</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s1">&#39;http://localhost:6543/&#39;</span><span class="p">,</span> <span class="n">json_payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are doing Cross-origin resource sharing (CORS), then the standard
requires the browser to do a pre-flight HTTP OPTIONS request. The easiest way
to handle this is to add an extra <code class="docutils literal notranslate"><span class="pre">view_config</span></code> for the same route, with
<code class="docutils literal notranslate"><span class="pre">request_method</span></code> set to <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code>, and set the desired response header
before returning. You can find examples of response headers <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Preflighted_requests">Access control
CORS, Preflighted requests</a>.</p>
</div>
<div class="section" id="cleaning-up-after-a-request">
<span id="index-8"></span><span id="id1"></span><h3>Cleaning up after a Request<a class="headerlink" href="#cleaning-up-after-a-request" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Sometimes it's required to perform some cleanup at the end of a request when a
database connection is involved.</p>
<p>For example, let's say you have a <code class="docutils literal notranslate"><span class="pre">mypackage</span></code> <span>Pyramid</span> application
package that uses SQLAlchemy, and you'd like the current SQLAlchemy database
session to be removed after each request.  Put the following in the
<code class="docutils literal notranslate"><span class="pre">mypackage.__init__</span></code> module:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mypackage.models</span> <span class="kn">import</span> <span class="n">DBSession</span>

<span class="kn">from</span> <span class="nn">pyramid.events</span> <span class="kn">import</span> <span class="n">subscriber</span>
<span class="kn">from</span> <span class="nn">pyramid.events</span> <span class="kn">import</span> <span class="n">NewRequest</span>

<span class="k">def</span> <span class="nf">cleanup_callback</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">DBSession</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="nd">@subscriber</span><span class="p">(</span><span class="n">NewRequest</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_cleanup_callback</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">event</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">add_finished_callback</span><span class="p">(</span><span class="n">cleanup_callback</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Registering the <code class="docutils literal notranslate"><span class="pre">cleanup_callback</span></code> finished callback at the start of a
request (by causing the <code class="docutils literal notranslate"><span class="pre">add_cleanup_callback</span></code> to receive a
<a class="reference internal" href="../api/events.html#pyramid.events.NewRequest" title="pyramid.events.NewRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.events.NewRequest</span></code></a> event at the start of each request) will
cause the DBSession to be removed whenever request processing has ended. Note
that in the example above, for the <a class="reference internal" href="../api/events.html#pyramid.events.subscriber" title="pyramid.events.subscriber"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.events.subscriber</span></code></a> decorator
to work, the <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.scan" title="pyramid.config.Configurator.scan"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.scan()</span></code></a> method must be called
against your <code class="docutils literal notranslate"><span class="pre">mypackage</span></code> package during application initialization.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This is only an example.  In particular, it is not necessary to cause
<code class="docutils literal notranslate"><span class="pre">DBSession.remove</span></code> to be called in an application generated from a
<span>Pyramid</span> cookiecutter, because these all use the <code class="docutils literal notranslate"><span class="pre">pyramid_tm</span></code> package.
The cleanup done by <code class="docutils literal notranslate"><span class="pre">DBSession.remove</span></code> is unnecessary when <code class="docutils literal notranslate"><span class="pre">pyramid_tm</span></code>
<a class="reference internal" href="../glossary.html#term-middleware"><span class="xref std std-term">middleware</span></a> is configured into the application.</p>
</div>
</div>
<div class="section" id="more-details">
<h3>More Details<a class="headerlink" href="#more-details" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>More detail about the request object API is available as follows.</p>
<ul class="simple">
<li><a class="reference internal" href="../api/request.html#pyramid.request.Request" title="pyramid.request.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.request.Request</span></code></a> API documentation</li>
<li><a class="reference external" href="http://docs.webob.org/en/latest/index.html">WebOb documentation</a>.  All
methods and attributes of a <code class="docutils literal notranslate"><span class="pre">webob.Request</span></code> documented within the WebOb
documentation will work with request objects created by <span>Pyramid</span>.</li>
</ul>
</div>
</div>
<div class="section" id="response">
<span id="index-9"></span><h2>Response<a class="headerlink" href="#response" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The <span>Pyramid</span> response object can be imported as
<a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a>.  This class is a subclass of the
<code class="docutils literal notranslate"><span class="pre">webob.Response</span></code> class.  The subclass does not add or change any
functionality, so the WebOb Response documentation will be completely relevant
for this class as well.</p>
<p>A response object has three fundamental parts:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">response.status</span></code></dt>
<dd>The response code plus reason message, like <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code>.  To set the code
without a message, use <code class="docutils literal notranslate"><span class="pre">status_int</span></code>, i.e., <code class="docutils literal notranslate"><span class="pre">response.status_int</span> <span class="pre">=</span> <span class="pre">200</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">response.headerlist</span></code></dt>
<dd>A list of all the headers, like <code class="docutils literal notranslate"><span class="pre">[('Content-Type',</span> <span class="pre">'text/html')]</span></code>.
There's a case-insensitive <a class="reference internal" href="../glossary.html#term-multidict"><span class="xref std std-term">multidict</span></a> in <code class="docutils literal notranslate"><span class="pre">response.headers</span></code> that
also allows you to access these same headers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">response.app_iter</span></code></dt>
<dd>An iterable (such as a list or generator) that will produce the content of
the response.  This is also accessible as <code class="docutils literal notranslate"><span class="pre">response.body</span></code> (a string),
<code class="docutils literal notranslate"><span class="pre">response.text</span></code> (a unicode object, informed by <code class="docutils literal notranslate"><span class="pre">response.charset</span></code>), and
<code class="docutils literal notranslate"><span class="pre">response.body_file</span></code> (a file-like object; writing to it appends to
<code class="docutils literal notranslate"><span class="pre">app_iter</span></code>).</dd>
</dl>
<p>Everything else in the object typically derives from this underlying state.
Here are some highlights:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">response.content_type</span></code></dt>
<dd><p class="first">The content type <em>not</em> including the <code class="docutils literal notranslate"><span class="pre">charset</span></code> parameter.</p>
<p>Typical use: <code class="docutils literal notranslate"><span class="pre">response.content_type</span> <span class="pre">=</span> <span class="pre">'text/html'</span></code>.</p>
<p class="last">Default value: <code class="docutils literal notranslate"><span class="pre">response.content_type</span> <span class="pre">=</span> <span class="pre">'text/html'</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">response.charset</span></code></dt>
<dd>The <code class="docutils literal notranslate"><span class="pre">charset</span></code> parameter of the content-type, it also informs encoding in
<code class="docutils literal notranslate"><span class="pre">response.text</span></code>. <code class="docutils literal notranslate"><span class="pre">response.content_type_params</span></code> is a dictionary of all
the parameters.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">response.set_cookie(name,</span> <span class="pre">value,</span> <span class="pre">max_age=None,</span> <span class="pre">path='/',</span> <span class="pre">...)</span></code></dt>
<dd>Set a cookie.  The keyword arguments control the various cookie parameters.
The <code class="docutils literal notranslate"><span class="pre">max_age</span></code> argument is the length for the cookie to live in seconds
(you may also use a timedelta object).  The <code class="docutils literal notranslate"><span class="pre">Expires</span></code> key will also be
set based on the value of <code class="docutils literal notranslate"><span class="pre">max_age</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">response.delete_cookie(name,</span> <span class="pre">path='/',</span> <span class="pre">domain=None)</span></code></dt>
<dd>Delete a cookie from the client.  This sets <code class="docutils literal notranslate"><span class="pre">max_age</span></code> to 0 and the cookie
value to <code class="docutils literal notranslate"><span class="pre">''</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">response.cache_expires(seconds=0)</span></code></dt>
<dd>This makes the response cacheable for the given number of seconds, or if
<code class="docutils literal notranslate"><span class="pre">seconds</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code> then the response is uncacheable (this also sets the
<code class="docutils literal notranslate"><span class="pre">Expires</span></code> header).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">response(environ,</span> <span class="pre">start_response)</span></code></dt>
<dd>The response object is a WSGI application.  As an application, it acts
according to how you create it.  It <em>can</em> do conditional responses if you
pass <code class="docutils literal notranslate"><span class="pre">conditional_response=True</span></code> when instantiating (or set that
attribute later).  It can also do HEAD and Range requests.</dd>
</dl>
<div class="section" id="headers">
<span id="index-10"></span><h3>Headers<a class="headerlink" href="#headers" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Like the request, most HTTP response headers are available as properties. These
are parsed, so you can do things like <code class="docutils literal notranslate"><span class="pre">response.last_modified</span> <span class="pre">=</span>
<span class="pre">os.path.getmtime(filename)</span></code>.</p>
<p>The details are available in the <a class="reference external" href="https://docs.pylonsproject.org/projects/webob/en/latest/api/response.html#module-webob.response" title="(in WebOb v1.8.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">webob.response</span></code></a> API documentation.</p>
</div>
<div class="section" id="instantiating-the-response">
<span id="index-11"></span><h3>Instantiating the Response<a class="headerlink" href="#instantiating-the-response" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Of course most of the time you just want to <em>make</em> a response.  Generally any
attribute of the response can be passed in as a keyword argument to the class,
e.g.:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="s1">&#39;hello world!&#39;</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The status defaults to <code class="docutils literal notranslate"><span class="pre">'200</span> <span class="pre">OK'</span></code>.</p>
<p>The value of <code class="docutils literal notranslate"><span class="pre">content_type</span></code> defaults to
<code class="docutils literal notranslate"><span class="pre">webob.response.Response.default_content_type</span></code>, which is <code class="docutils literal notranslate"><span class="pre">text/html</span></code>. You
can subclass <a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a> and set
<code class="docutils literal notranslate"><span class="pre">default_content_type</span></code> to override this behavior.</p>
</div>
<div class="section" id="exception-responses">
<span id="index-12"></span><h3>Exception Responses<a class="headerlink" href="#exception-responses" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>To facilitate error responses like <code class="docutils literal notranslate"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></code>, the module
<a class="reference internal" href="../api/httpexceptions.html#module-pyramid.httpexceptions" title="pyramid.httpexceptions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid.httpexceptions</span></code></a> contains classes for each kind of error response.
These include boring but appropriate error bodies.  The exceptions exposed by
this module, when used under <span>Pyramid</span>, should be imported from the
<a class="reference internal" href="../api/httpexceptions.html#module-pyramid.httpexceptions" title="pyramid.httpexceptions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid.httpexceptions</span></code></a> module.  This import location contains subclasses
and replacements that mirror those in the <code class="docutils literal notranslate"><span class="pre">webob.exc</span></code> module.</p>
<p>Each class is named <code class="docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTP*</span></code>, where <code class="docutils literal notranslate"><span class="pre">*</span></code> is the reason
for the error.  For instance, <a class="reference internal" href="../api/httpexceptions.html#pyramid.httpexceptions.HTTPNotFound" title="pyramid.httpexceptions.HTTPNotFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPNotFound</span></code></a>
subclasses <a class="reference internal" href="../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a>, so you can manipulate the
instances in the same way.  A typical example is:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPNotFound</span>
<span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="n">HTTPMovedPermanently</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">HTTPNotFound</span><span class="p">(</span><span class="s1">&#39;There is no such resource&#39;</span><span class="p">)</span>
<span class="c1"># or:</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">HTTPMovedPermanently</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">new_url</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id2">
<h3>More Details<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>More details about the response object API are available in the
<a class="reference internal" href="../api/response.html#module-pyramid.response" title="pyramid.response"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid.response</span></code></a> documentation.  More details about exception responses
are in the <a class="reference internal" href="../api/httpexceptions.html#module-pyramid.httpexceptions" title="pyramid.httpexceptions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyramid.httpexceptions</span></code></a> API documentation.  The <a class="reference external" href="http://docs.webob.org/en/latest/index.html">WebOb
documentation</a> is also useful.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Request and Response Objects</a><ul>
<li><a class="reference internal" href="#request">Request</a><ul>
<li><a class="reference internal" href="#special-attributes-added-to-the-request-by-pyramid">Special Attributes Added to the Request by <span>Pyramid</span></a></li>
<li><a class="reference internal" href="#urls">URLs</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
<li><a class="reference internal" href="#text-unicode">Text (Unicode)</a></li>
<li><a class="reference internal" href="#multidict">Multidict</a></li>
<li><a class="reference internal" href="#dealing-with-a-json-encoded-request-body">Dealing with a JSON-Encoded Request Body</a></li>
<li><a class="reference internal" href="#cleaning-up-after-a-request">Cleaning up after a Request</a></li>
<li><a class="reference internal" href="#more-details">More Details</a></li>
</ul>
</li>
<li><a class="reference internal" href="#response">Response</a><ul>
<li><a class="reference internal" href="#headers">Headers</a></li>
<li><a class="reference internal" href="#instantiating-the-response">Instantiating the Response</a></li>
<li><a class="reference internal" href="#exception-responses">Exception Responses</a></li>
<li><a class="reference internal" href="#id2">More Details</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="assets.html"
                        title="前の章へ">Static Assets</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="sessions.html"
                        title="次の章へ">Sessions</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/narr/webob.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="sessions.html" title="Sessions"
             >次へ</a> |</li>
        <li class="right" >
          <a href="assets.html" title="Static Assets"
             >前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 8月 09, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4 で生成しました。
    </div>
  </body>
</html>