
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Advanced Configuration &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="Extending Pyramid Configuration" href="extconfig.html" />
    <link rel="prev" title="Extending an Existing Pyramid Application" href="extending.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../index.html">
      		<img class="logo" src="../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="extconfig.html" title="Extending Pyramid Configuration"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="extending.html" title="Extending an Existing Pyramid Application"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="advanced-configuration">
<span id="advconfig-narr"></span><span id="index-0"></span><h1>Advanced Configuration<a class="headerlink" href="#advanced-configuration" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>To support application extensibility, the <span>Pyramid</span> <a class="reference internal" href="../glossary.html#term-configurator"><span class="xref std std-term">Configurator</span></a>
by default detects configuration conflicts and allows you to include
configuration imperatively from other packages or modules.  It also by default
performs configuration in two separate phases.  This allows you to ignore
relative configuration statement ordering in some circumstances.</p>
<div class="section" id="conflict-detection">
<span id="index-1"></span><span id="id1"></span><h2>Conflict Detection<a class="headerlink" href="#conflict-detection" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Here's a familiar example of one of the simplest <span>Pyramid</span> applications,
configured imperatively:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
<span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Hello world!&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">hello_world</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>When you start this application, all will be OK.  However, what happens if we
try to add another view to the configuration with the same set of
<a class="reference internal" href="../glossary.html#term-predicate"><span class="xref std std-term">predicate</span></a> arguments as one we've already added?</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
<span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Hello world!&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">goodbye_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Goodbye world!&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>

    <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">hello_world</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>

    <span class="c1"># conflicting view configuration</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">goodbye_world</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>The application now has two conflicting view configuration statements.  When we
try to start it again, it won't start.  Instead we'll receive a traceback that
ends something like this:</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;app.py&quot;, line 12, in &lt;module&gt;
    app = config.make_wsgi_app()
  File &quot;pyramid/config.py&quot;, line 839, in make_wsgi_app
    self.commit()
  File &quot;pyramid/pyramid/config.py&quot;, line 473, in commit
    self._ctx.execute_actions()
  ... more code ...
pyramid.exceptions.ConfigurationConflictError:
        Conflicting configuration actions
  For: (&#39;view&#39;, None, &#39;&#39;, None, &lt;InterfaceClass pyramid.interfaces.IView&gt;,
        None, None, None, None, None, False, None, None, None)
  Line 14 of file app.py in &lt;module&gt;: &#39;config.add_view(hello_world)&#39;
  Line 17 of file app.py in &lt;module&gt;: &#39;config.add_view(goodbye_world)&#39;
</pre></div>
</td></tr></table></div>
<p>This traceback is trying to tell us:</p>
<ul class="simple">
<li>We've got conflicting information for a set of view configuration statements
(The <code class="docutils literal notranslate"><span class="pre">For:</span></code> line).</li>
<li>There are two statements which conflict, shown beneath the <code class="docutils literal notranslate"><span class="pre">For:</span></code> line:
<code class="docutils literal notranslate"><span class="pre">config.add_view(hello_world.</span> <span class="pre">'hello')</span></code> on line 14 of <code class="docutils literal notranslate"><span class="pre">app.py</span></code>, and
<code class="docutils literal notranslate"><span class="pre">config.add_view(goodbye_world,</span> <span class="pre">'hello')</span></code> on line 17 of <code class="docutils literal notranslate"><span class="pre">app.py</span></code>.</li>
</ul>
<p>These two configuration statements are in conflict because we've tried to tell
the system that the set of <a class="reference internal" href="../glossary.html#term-predicate"><span class="xref std std-term">predicate</span></a> values for both view
configurations are exactly the same.  Both the <code class="docutils literal notranslate"><span class="pre">hello_world</span></code> and
<code class="docutils literal notranslate"><span class="pre">goodbye_world</span></code> views are configured to respond under the same set of
circumstances.  This circumstance, the <a class="reference internal" href="../glossary.html#term-view-name"><span class="xref std std-term">view name</span></a> represented by the
<code class="docutils literal notranslate"><span class="pre">name=</span></code> predicate, is <code class="docutils literal notranslate"><span class="pre">hello</span></code>.</p>
<p>This presents an ambiguity that <span>Pyramid</span> cannot resolve. Rather than
allowing the circumstance to go unreported, by default Pyramid raises a
<code class="xref py py-exc docutils literal notranslate"><span class="pre">ConfigurationConflictError</span></code> error and prevents the application from
running.</p>
<p>Conflict detection happens for any kind of configuration: imperative
configuration or configuration that results from the execution of a
<a class="reference internal" href="../glossary.html#term-scan"><span class="xref std std-term">scan</span></a>.</p>
<div class="section" id="manually-resolving-conflicts">
<span id="id2"></span><h3>Manually Resolving Conflicts<a class="headerlink" href="#manually-resolving-conflicts" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>There are a number of ways to manually resolve conflicts: by changing
registrations to not conflict, by strategically using
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.commit" title="pyramid.config.Configurator.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.commit()</span></code></a>, or by using an &quot;autocommitting&quot;
configurator.</p>
<div class="section" id="the-right-thing">
<h4>The Right Thing<a class="headerlink" href="#the-right-thing" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>The most correct way to resolve conflicts is to &quot;do the needful&quot;: change your
configuration code to not have conflicting configuration statements.  The
details of how this is done depends entirely on the configuration statements
made by your application.  Use the detail provided in the
<code class="xref py py-exc docutils literal notranslate"><span class="pre">ConfigurationConflictError</span></code> to track down the offending conflicts and
modify your configuration code accordingly.</p>
<p>If you're getting a conflict while trying to extend an existing application,
and that application has a function which performs configuration like this one:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_routes</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Don't call this function directly with <code class="docutils literal notranslate"><span class="pre">config</span></code> as an argument.  Instead, use
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.include()</span></code></a>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">add_routes</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Using <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">include()</span></code></a> instead of calling the
function directly provides a modicum of automated conflict resolution, with the
configuration statements you define in the calling code overriding those of the
included function.</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">See also <a class="reference internal" href="#automatic-conflict-resolution"><span class="std std-ref">Automatic Conflict Resolution</span></a> and
<a class="reference internal" href="#including-configuration"><span class="std std-ref">Including Configuration from External Sources</span></a>.</p>
</div>
</div>
<div class="section" id="using-config-commit">
<h4>Using <code class="docutils literal notranslate"><span class="pre">config.commit()</span></code><a class="headerlink" href="#using-config-commit" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>You can manually commit a configuration by using the
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.commit" title="pyramid.config.Configurator.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a> method between configuration calls.
For example, we prevent conflicts from occurring in the application we examined
previously as the result of adding a <code class="docutils literal notranslate"><span class="pre">commit</span></code>.  Here's the application that
generates conflicts:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
<span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Hello world!&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">goodbye_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Goodbye world!&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>

    <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">hello_world</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>

    <span class="c1"># conflicting view configuration</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">goodbye_world</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>We can prevent the two <code class="docutils literal notranslate"><span class="pre">add_view</span></code> calls from conflicting by issuing a call to
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.commit" title="pyramid.config.Configurator.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a> between them:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>
<span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>
<span class="kn">from</span> <span class="nn">pyramid.response</span> <span class="kn">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Hello world!&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">goodbye_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Goodbye world!&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">()</span>

    <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">hello_world</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>

<span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="c1"># commit any pending configuration actions</span>
</span>
    <span class="c1"># no-longer-conflicting view configuration</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">goodbye_world</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">make_wsgi_app</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>In the above example we've issued a call to
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.commit" title="pyramid.config.Configurator.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a> between the two <code class="docutils literal notranslate"><span class="pre">add_view</span></code> calls.
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.commit" title="pyramid.config.Configurator.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a> will execute any pending
configuration statements.</p>
<p>Calling <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.commit" title="pyramid.config.Configurator.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a> is safe at any time.  It
executes all pending configuration actions and leaves the configuration action
list &quot;clean&quot;.</p>
<p>Note that <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.commit" title="pyramid.config.Configurator.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a> has no effect when you're
using an <em>autocommitting</em> configurator (see <a class="reference internal" href="#autocommitting-configurator"><span class="std std-ref">Using an Autocommitting Configurator</span></a>).</p>
</div>
<div class="section" id="using-an-autocommitting-configurator">
<span id="autocommitting-configurator"></span><h4>Using an Autocommitting Configurator<a class="headerlink" href="#using-an-autocommitting-configurator" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>You can also use a heavy hammer to circumvent conflict detection by using a
configurator constructor parameter: <code class="docutils literal notranslate"><span class="pre">autocommit=True</span></code>.  For example:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.config</span> <span class="kn">import</span> <span class="n">Configurator</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Configurator</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>When the <code class="docutils literal notranslate"><span class="pre">autocommit</span></code> parameter passed to the Configurator is <code class="docutils literal notranslate"><span class="pre">True</span></code>,
conflict detection (and <a class="reference internal" href="#twophase-config"><span class="std std-ref">Two-Phase Configuration</span></a>) is disabled.  Configuration
statements will be executed immediately, and succeeding statements will
override preceding ones.</p>
<p><a class="reference internal" href="../api/config.html#pyramid.config.Configurator.commit" title="pyramid.config.Configurator.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">commit()</span></code></a> has no effect when <code class="docutils literal notranslate"><span class="pre">autocommit</span></code>
is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>If you use a Configurator in code that performs unit testing, it's usually a
good idea to use an autocommitting Configurator, because you are usually
unconcerned about conflict detection or two-phase configuration in test code.</p>
</div>
</div>
<div class="section" id="automatic-conflict-resolution">
<span id="id3"></span><h3>Automatic Conflict Resolution<a class="headerlink" href="#automatic-conflict-resolution" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>If your code uses the <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">include()</span></code></a> method to
include external configuration, some conflicts are automatically resolved.
Configuration statements that are made as the result of an &quot;include&quot; will be
overridden by configuration statements that happen within the caller of the
&quot;include&quot; method.</p>
<p>Automatic conflict resolution supports this goal.  If a user wants to reuse a
Pyramid application, and they want to customize the configuration of this
application without hacking its code &quot;from outside&quot;, they can &quot;include&quot; a
configuration function from the package and override only some of its
configuration statements within the code that does the include.  No conflicts
will be generated by configuration statements within the code that does the
including, even if configuration statements in the included code would conflict
if it was moved &quot;up&quot; to the calling code.</p>
</div>
<div class="section" id="methods-which-provide-conflict-detection">
<h3>Methods Which Provide Conflict Detection<a class="headerlink" href="#methods-which-provide-conflict-detection" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>These are the methods of the configurator which provide conflict detection:</p>
<p><a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_view" title="pyramid.config.Configurator.add_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_view()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_route" title="pyramid.config.Configurator.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_renderer" title="pyramid.config.Configurator.add_renderer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_renderer()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_request_method" title="pyramid.config.Configurator.add_request_method"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_request_method()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_request_factory" title="pyramid.config.Configurator.set_request_factory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_request_factory()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_session_factory" title="pyramid.config.Configurator.set_session_factory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_session_factory()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_request_property" title="pyramid.config.Configurator.set_request_property"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_request_property()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_root_factory" title="pyramid.config.Configurator.set_root_factory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_root_factory()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_view_mapper" title="pyramid.config.Configurator.set_view_mapper"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_view_mapper()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_authentication_policy" title="pyramid.config.Configurator.set_authentication_policy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_authentication_policy()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_authorization_policy" title="pyramid.config.Configurator.set_authorization_policy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_authorization_policy()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_locale_negotiator" title="pyramid.config.Configurator.set_locale_negotiator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_locale_negotiator()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.set_default_permission" title="pyramid.config.Configurator.set_default_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_default_permission()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_traverser" title="pyramid.config.Configurator.add_traverser"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_traverser()</span></code></a>,
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_resource_url_adapter" title="pyramid.config.Configurator.add_resource_url_adapter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_resource_url_adapter()</span></code></a>,
and <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_response_adapter" title="pyramid.config.Configurator.add_response_adapter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_response_adapter()</span></code></a>.</p>
<p><a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_static_view" title="pyramid.config.Configurator.add_static_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_static_view()</span></code></a> also indirectly provides
conflict detection, because it's implemented in terms of the conflict-aware
<code class="docutils literal notranslate"><span class="pre">add_route</span></code> and <code class="docutils literal notranslate"><span class="pre">add_view</span></code> methods.</p>
</div>
</div>
<div class="section" id="including-configuration-from-external-sources">
<span id="including-configuration"></span><span id="index-2"></span><h2>Including Configuration from External Sources<a class="headerlink" href="#including-configuration-from-external-sources" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Some application programmers will factor their configuration code in such a way
that it is easy to reuse and override configuration statements.  For example,
such a developer might factor out a function used to add routes to their
application:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_routes</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Rather than calling this function directly with <code class="docutils literal notranslate"><span class="pre">config</span></code> as an argument,
instead use <a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.include()</span></code></a>:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">add_routes</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Using <code class="docutils literal notranslate"><span class="pre">include</span></code> rather than calling the function directly will allow
<a class="reference internal" href="#automatic-conflict-resolution"><span class="std std-ref">Automatic Conflict Resolution</span></a> to work.</p>
<p><a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">include()</span></code></a> can also accept a <a class="reference internal" href="../glossary.html#term-module"><span class="xref std std-term">module</span></a>
as an argument:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">myapp</span>

<span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">myapp</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>For this to work properly, the <code class="docutils literal notranslate"><span class="pre">myapp</span></code> module must contain a callable with
the special name <code class="docutils literal notranslate"><span class="pre">includeme</span></code>, which should perform configuration (like the
<code class="docutils literal notranslate"><span class="pre">add_routes</span></code> callable we showed above as an example).</p>
<p><a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">include()</span></code></a> can also accept a <a class="reference internal" href="../glossary.html#term-dotted-python-name"><span class="xref std std-term">dotted
Python name</span></a> to a function or a module.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">See <a class="reference external" href="https://docs.pylonsproject.org/projects/pyramid-zcml/en/latest/narr.html#the-include-tag" title="(in pyramid_zcml v1.1.0)"><span>The &lt;include&gt; Tag</span></a> for a declarative alternative to the
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.include" title="pyramid.config.Configurator.include"><code class="xref py py-meth docutils literal notranslate"><span class="pre">include()</span></code></a> method.</p>
</div>
</div>
<div class="section" id="two-phase-configuration">
<span id="twophase-config"></span><h2>Two-Phase Configuration<a class="headerlink" href="#two-phase-configuration" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>When a non-autocommitting <a class="reference internal" href="../glossary.html#term-configurator"><span class="xref std std-term">Configurator</span></a> is used to do configuration (the
default), configuration execution happens in two phases.  In the first phase,
&quot;eager&quot; configuration actions (actions that must happen before all others, such
as registering a renderer) are executed, and <em>discriminators</em> are computed for
each of the actions that depend on the result of the eager actions.  In the
second phase, the discriminators of all actions are compared to do conflict
detection.</p>
<p>Due to this, for configuration methods that have no internal ordering
constraints, execution order of configuration method calls is not important.
For example, the relative ordering of
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_view" title="pyramid.config.Configurator.add_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_view()</span></code></a> and
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_renderer" title="pyramid.config.Configurator.add_renderer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_renderer()</span></code></a> is unimportant when a
non-autocommitting configurator is used.  This code snippet:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;some.view&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;path_to_custom/renderer.rn&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_renderer</span><span class="p">(</span><span class="s1">&#39;.rn&#39;</span><span class="p">,</span> <span class="n">SomeCustomRendererFactory</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Has the same result as:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">add_renderer</span><span class="p">(</span><span class="s1">&#39;.rn&#39;</span><span class="p">,</span> <span class="n">SomeCustomRendererFactory</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;some.view&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;path_to_custom/renderer.rn&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Even though the view statement depends on the registration of a custom
renderer, due to two-phase configuration, the order in which the configuration
statements are issued is not important.  <code class="docutils literal notranslate"><span class="pre">add_view</span></code> will be able to find the
<code class="docutils literal notranslate"><span class="pre">.rn</span></code> renderer even if <code class="docutils literal notranslate"><span class="pre">add_renderer</span></code> is called after <code class="docutils literal notranslate"><span class="pre">add_view</span></code>.</p>
<p>The same is untrue when you use an <em>autocommitting</em> configurator (see
<a class="reference internal" href="#autocommitting-configurator"><span class="std std-ref">Using an Autocommitting Configurator</span></a>).  When an autocommitting configurator is
used, two-phase configuration is disabled, and configuration statements must be
ordered in dependency order.</p>
<p>Some configuration methods, such as
<a class="reference internal" href="../api/config.html#pyramid.config.Configurator.add_route" title="pyramid.config.Configurator.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> have internal ordering
constraints: the routes they imply require relative ordering.  Such ordering
constraints are not absolved by two-phase configuration.  Routes are still
added in configuration execution order.</p>
</div>
<div class="section" id="more-information">
<h2>More Information<a class="headerlink" href="#more-information" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>For more information, see the article <a class="reference external" href="https://docs.pylonsproject.org/projects/pyramid-cookbook/en/latest/configuration/whirlwind_tour.html#whirlwind-adv-conf" title="(in Pyramid Community Cookbook v0.2)"><span class="xref std std-ref">A Whirlwind Tour of Advanced
Configuration Tactics</span></a> in the Pyramid Community
Cookbook.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Advanced Configuration</a><ul>
<li><a class="reference internal" href="#conflict-detection">Conflict Detection</a><ul>
<li><a class="reference internal" href="#manually-resolving-conflicts">Manually Resolving Conflicts</a><ul>
<li><a class="reference internal" href="#the-right-thing">The Right Thing</a></li>
<li><a class="reference internal" href="#using-config-commit">Using <code class="docutils literal notranslate"><span class="pre">config.commit()</span></code></a></li>
<li><a class="reference internal" href="#using-an-autocommitting-configurator">Using an Autocommitting Configurator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#automatic-conflict-resolution">Automatic Conflict Resolution</a></li>
<li><a class="reference internal" href="#methods-which-provide-conflict-detection">Methods Which Provide Conflict Detection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#including-configuration-from-external-sources">Including Configuration from External Sources</a></li>
<li><a class="reference internal" href="#two-phase-configuration">Two-Phase Configuration</a></li>
<li><a class="reference internal" href="#more-information">More Information</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="extending.html"
                        title="前の章へ">Extending an Existing <span>Pyramid</span> Application</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="extconfig.html"
                        title="次の章へ">Extending Pyramid Configuration</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/narr/advconfig.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="extconfig.html" title="Extending Pyramid Configuration"
             >次へ</a> |</li>
        <li class="right" >
          <a href="extending.html" title="Extending an Existing Pyramid Application"
             >前へ</a> |</li>
    	<li><a href="../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 8月 15, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4 で生成しました。
    </div>
  </body>
</html>