
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Adding Tests &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="copyright" title="著作権" href="../../copyright.html" />
    <link rel="next" title="Distributing Your Application" href="distributing.html" />
    <link rel="prev" title="Adding authorization" href="authorization.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../../index.html">
      		<img class="logo" src="../../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="distributing.html" title="Distributing Your Application"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="authorization.html" title="Adding authorization"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">SQLAlchemy + URL dispatch wiki tutorial</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="adding-tests">
<span id="wiki2-adding-tests"></span><h1>Adding Tests<a class="headerlink" href="#adding-tests" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>We will now add tests for the models and views as well as a few functional
tests in a new <code class="docutils literal notranslate"><span class="pre">tests</span></code> subpackage.  Tests ensure that an application works,
and that it continues to work when changes are made in the future.</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">tests.py</span></code> was generated as part of the <code class="docutils literal notranslate"><span class="pre">alchemy</span></code> cookiecutter, but it
is a common practice to put tests into a <code class="docutils literal notranslate"><span class="pre">tests</span></code> subpackage, especially as
projects grow in size and complexity.  Each module in the test subpackage
should contain tests for its corresponding module in our application.  Each
corresponding pair of modules should have the same names, except the test
module should have the prefix <code class="docutils literal notranslate"><span class="pre">test_</span></code>.</p>
<p>Start by deleting <code class="docutils literal notranslate"><span class="pre">tests.py</span></code>, then create a new directory to contain our new
tests as well as a new empty file <code class="docutils literal notranslate"><span class="pre">tests/__init__.py</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">It is very important when refactoring a Python module into a package to be
sure to delete the cache files (<code class="docutils literal notranslate"><span class="pre">.pyc</span></code> files or <code class="docutils literal notranslate"><span class="pre">__pycache__</span></code> folders)
sitting around! Python will prioritize the cache files before traversing
into folders, using the old code, and you will wonder why none of your
changes are working!</p>
</div>
<div class="section" id="test-the-views">
<h2>Test the views<a class="headerlink" href="#test-the-views" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We'll create a new <code class="docutils literal notranslate"><span class="pre">tests/test_views.py</span></code> file, adding a <code class="docutils literal notranslate"><span class="pre">BaseTest</span></code> class
used as the base for other test classes. Next we'll add tests for each view
function we previously added to our application. We'll add four test classes:
<code class="docutils literal notranslate"><span class="pre">ViewWikiTests</span></code>, <code class="docutils literal notranslate"><span class="pre">ViewPageTests</span></code>, <code class="docutils literal notranslate"><span class="pre">AddPageTests</span></code>, and <code class="docutils literal notranslate"><span class="pre">EditPageTests</span></code>.
These test the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code>, <code class="docutils literal notranslate"><span class="pre">view_page</span></code>, <code class="docutils literal notranslate"><span class="pre">add_page</span></code>, and <code class="docutils literal notranslate"><span class="pre">edit_page</span></code>
views.</p>
</div>
<div class="section" id="functional-tests">
<h2>Functional tests<a class="headerlink" href="#functional-tests" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We'll test the whole application, covering security aspects that are not tested
in the unit tests, like logging in, logging out, checking that the <code class="docutils literal notranslate"><span class="pre">basic</span></code>
user cannot edit pages that it didn't create but the <code class="docutils literal notranslate"><span class="pre">editor</span></code> user can, and
so on.</p>
</div>
<div class="section" id="view-the-results-of-all-our-edits-to-tests-subpackage">
<h2>View the results of all our edits to <code class="docutils literal notranslate"><span class="pre">tests</span></code> subpackage<a class="headerlink" href="#view-the-results-of-all-our-edits-to-tests-subpackage" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Create <code class="docutils literal notranslate"><span class="pre">tutorial/tests/test_views.py</span></code> such that it appears as follows:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">transaction</span>

<span class="kn">from</span> <span class="nn">pyramid</span> <span class="kn">import</span> <span class="n">testing</span>


<span class="k">def</span> <span class="nf">dummy_request</span><span class="p">(</span><span class="n">dbsession</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">.</span><span class="n">DummyRequest</span><span class="p">(</span><span class="n">dbsession</span><span class="o">=</span><span class="n">dbsession</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">get_tm_session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;sqlalchemy.url&#39;</span><span class="p">:</span> <span class="s1">&#39;sqlite:///:memory:&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;..models&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;..routes&#39;</span><span class="p">)</span>

        <span class="n">session_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;dbsession_factory&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">get_tm_session</span><span class="p">(</span><span class="n">session_factory</span><span class="p">,</span> <span class="n">transaction</span><span class="o">.</span><span class="n">manager</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_database</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models.meta</span> <span class="kn">import</span> <span class="n">Base</span>
        <span class="n">session_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;dbsession_factory&#39;</span><span class="p">]</span>
        <span class="n">engine</span> <span class="o">=</span> <span class="n">session_factory</span><span class="o">.</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;bind&#39;</span><span class="p">]</span>
        <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="n">transaction</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">makeUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">User</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>

    <span class="k">def</span> <span class="nf">makePage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">creator</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Page</span>
        <span class="k">return</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">creator</span><span class="o">=</span><span class="n">creator</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ViewWikiTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;..routes&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_callFUT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">tutorial.views.default</span> <span class="kn">import</span> <span class="n">view_wiki</span>
        <span class="k">return</span> <span class="n">view_wiki</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_it</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">DummyRequest</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callFUT</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;http://example.com/FrontPage&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ViewPageTests</span><span class="p">(</span><span class="n">BaseTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_callFUT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">tutorial.views.default</span> <span class="kn">import</span> <span class="n">view_page</span>
        <span class="k">return</span> <span class="n">view_page</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_it</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..routes</span> <span class="kn">import</span> <span class="n">PageResource</span>

        <span class="c1"># add a page to the db</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;editor&#39;</span><span class="p">)</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makePage</span><span class="p">(</span><span class="s1">&#39;IDoExist&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello CruelWorld IDoExist&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">page</span><span class="p">,</span> <span class="n">user</span><span class="p">])</span>

        <span class="c1"># create a request asking for the page we&#39;ve created</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">dummy_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">PageResource</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

        <span class="c1"># call the view we&#39;re testing and check its behavior</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callFUT</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">],</span> <span class="n">page</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span>
            <span class="s1">&#39;&lt;div class=&quot;document&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;&lt;p&gt;Hello &lt;a href=&quot;http://example.com/add_page/CruelWorld&quot;&gt;&#39;</span>
            <span class="s1">&#39;CruelWorld&lt;/a&gt; &#39;</span>
            <span class="s1">&#39;&lt;a href=&quot;http://example.com/IDoExist&quot;&gt;&#39;</span>
            <span class="s1">&#39;IDoExist&lt;/a&gt;&#39;</span>
            <span class="s1">&#39;&lt;/p&gt;</span><span class="se">\n</span><span class="s1">&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;edit_url&#39;</span><span class="p">],</span>
                         <span class="s1">&#39;http://example.com/IDoExist/edit_page&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AddPageTests</span><span class="p">(</span><span class="n">BaseTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_callFUT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">tutorial.views.default</span> <span class="kn">import</span> <span class="n">add_page</span>
        <span class="k">return</span> <span class="n">add_page</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_it_pageexists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Page</span>
        <span class="kn">from</span> <span class="nn">..routes</span> <span class="kn">import</span> <span class="n">NewPage</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">DummyRequest</span><span class="p">({</span><span class="s1">&#39;form.submitted&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                                        <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello yo!&#39;</span><span class="p">},</span>
                                       <span class="n">dbsession</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;editor&#39;</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">NewPage</span><span class="p">(</span><span class="s1">&#39;AnotherPage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callFUT</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">pagecount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;AnotherPage&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">pagecount</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_it_notsubmitted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..routes</span> <span class="kn">import</span> <span class="n">NewPage</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">dummy_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;editor&#39;</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">NewPage</span><span class="p">(</span><span class="s1">&#39;AnotherPage&#39;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callFUT</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pagedata&#39;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;save_url&#39;</span><span class="p">],</span>
                         <span class="s1">&#39;http://example.com/add_page/AnotherPage&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_it_submitted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Page</span>
        <span class="kn">from</span> <span class="nn">..routes</span> <span class="kn">import</span> <span class="n">NewPage</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">DummyRequest</span><span class="p">({</span><span class="s1">&#39;form.submitted&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                                        <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello yo!&#39;</span><span class="p">},</span>
                                       <span class="n">dbsession</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;editor&#39;</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">NewPage</span><span class="p">(</span><span class="s1">&#39;AnotherPage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callFUT</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;AnotherPage&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;Hello yo!&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EditPageTests</span><span class="p">(</span><span class="n">BaseTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_callFUT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">tutorial.views.default</span> <span class="kn">import</span> <span class="n">edit_page</span>
        <span class="k">return</span> <span class="n">edit_page</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">makeContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..routes</span> <span class="kn">import</span> <span class="n">PageResource</span>
        <span class="k">return</span> <span class="n">PageResource</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_it_notsubmitted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;editor&#39;</span><span class="p">)</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makePage</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">page</span><span class="p">,</span> <span class="n">user</span><span class="p">])</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">dummy_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeContext</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callFUT</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pagename&#39;</span><span class="p">],</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;save_url&#39;</span><span class="p">],</span>
                         <span class="s1">&#39;http://example.com/abc/edit_page&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_it_submitted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;editor&#39;</span><span class="p">)</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makePage</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">page</span><span class="p">,</span> <span class="n">user</span><span class="p">])</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">DummyRequest</span><span class="p">({</span><span class="s1">&#39;form.submitted&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                                        <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello yo!&#39;</span><span class="p">},</span>
                                       <span class="n">dbsession</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeContext</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callFUT</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;http://example.com/abc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;Hello yo!&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Create <code class="docutils literal notranslate"><span class="pre">tutorial/tests/test_functional.py</span></code> such that it appears as follows:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">transaction</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">webtest</span>


<span class="k">class</span> <span class="nc">FunctionalTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">basic_login</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;/login?login=basic&amp;password=basic&#39;</span>
        <span class="s1">&#39;&amp;next=FrontPage&amp;form.submitted=Login&#39;</span><span class="p">)</span>
    <span class="n">basic_wrong_login</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;/login?login=basic&amp;password=incorrect&#39;</span>
        <span class="s1">&#39;&amp;next=FrontPage&amp;form.submitted=Login&#39;</span><span class="p">)</span>
    <span class="n">basic_login_no_next</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;/login?login=basic&amp;password=basic&#39;</span>
        <span class="s1">&#39;&amp;form.submitted=Login&#39;</span><span class="p">)</span>
    <span class="n">editor_login</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;/login?login=editor&amp;password=editor&#39;</span>
        <span class="s1">&#39;&amp;next=FrontPage&amp;form.submitted=Login&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">tutorial.models.meta</span> <span class="kn">import</span> <span class="n">Base</span>
        <span class="kn">from</span> <span class="nn">tutorial.models</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">User</span><span class="p">,</span>
            <span class="n">Page</span><span class="p">,</span>
            <span class="n">get_tm_session</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="kn">from</span> <span class="nn">tutorial</span> <span class="kn">import</span> <span class="n">main</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;sqlalchemy.url&#39;</span><span class="p">:</span> <span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span>
            <span class="s1">&#39;auth.secret&#39;</span><span class="p">:</span> <span class="s1">&#39;seekrit&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">main</span><span class="p">({},</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">testapp</span> <span class="o">=</span> <span class="n">webtest</span><span class="o">.</span><span class="n">TestApp</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

        <span class="n">session_factory</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;dbsession_factory&#39;</span><span class="p">]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">session_factory</span><span class="o">.</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;bind&#39;</span><span class="p">]</span>
        <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">manager</span><span class="p">:</span>
            <span class="n">dbsession</span> <span class="o">=</span> <span class="n">get_tm_session</span><span class="p">(</span><span class="n">session_factory</span><span class="p">,</span> <span class="n">transaction</span><span class="o">.</span><span class="n">manager</span><span class="p">)</span>
            <span class="n">editor</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;editor&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;editor&#39;</span><span class="p">)</span>
            <span class="n">editor</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;editor&#39;</span><span class="p">)</span>
            <span class="n">basic</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;basic&#39;</span><span class="p">)</span>
            <span class="n">basic</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;basic&#39;</span><span class="p">)</span>
            <span class="n">page1</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;FrontPage&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is the front page&#39;</span><span class="p">)</span>
            <span class="n">page1</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="n">editor</span>
            <span class="n">page2</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;BackPage&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;This is the back page&#39;</span><span class="p">)</span>
            <span class="n">page2</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="n">basic</span>
            <span class="n">dbsession</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">basic</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="n">page1</span><span class="p">,</span> <span class="n">page2</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">tutorial.models.meta</span> <span class="kn">import</span> <span class="n">Base</span>
        <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;http://localhost/FrontPage&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_FrontPage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/FrontPage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;FrontPage&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_unexisting_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/SomePage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_successful_log_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;http://localhost/FrontPage&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_successful_log_in_no_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_login_no_next</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;http://localhost/&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_failed_log_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_wrong_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;login&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_logout_link_present_when_logged_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/FrontPage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Logout&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_logout_link_not_present_after_logged_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/FrontPage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Logout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_anonymous_user_cannot_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/FrontPage/edit_page&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span><span class="o">.</span><span class="n">follow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Login&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_anonymous_user_cannot_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/add_page/NewPage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span><span class="o">.</span><span class="n">follow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Login&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_basic_user_cannot_edit_front</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/FrontPage/edit_page&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span><span class="o">.</span><span class="n">follow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Login&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_basic_user_can_edit_back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/BackPage/edit_page&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Editing&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_basic_user_can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/add_page/NewPage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Editing&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_editors_member_user_can_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/FrontPage/edit_page&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Editing&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_editors_member_user_can_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/add_page/NewPage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Editing&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_editors_member_user_can_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/FrontPage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;FrontPage&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_redirect_to_edit_for_existing_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_login</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/add_page/FrontPage&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;FrontPage&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Create <code class="docutils literal notranslate"><span class="pre">tutorial/tests/test_initdb.py</span></code> such that it appears as follows:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">class</span> <span class="nc">TestInitializeDB</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..scripts.initializedb</span> <span class="kn">import</span> <span class="n">main</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SystemExit</span><span class="p">):</span>
            <span class="n">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..scripts.initializedb</span> <span class="kn">import</span> <span class="n">main</span>
        <span class="n">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;development.ini&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;tutorial.sqlite&#39;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;tutorial.sqlite&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Create <code class="docutils literal notranslate"><span class="pre">tutorial/tests/test_security.py</span></code> such that it appears as follows:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">pyramid.testing</span> <span class="kn">import</span> <span class="n">DummyRequest</span>


<span class="k">class</span> <span class="nc">TestMyAuthenticationPolicy</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_no_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">DummyRequest</span><span class="p">()</span>
        <span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="kn">from</span> <span class="nn">..security</span> <span class="kn">import</span> <span class="n">MyAuthenticationPolicy</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="n">MyAuthenticationPolicy</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">policy</span><span class="o">.</span><span class="n">authenticated_userid</span><span class="p">(</span><span class="n">request</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_authenticated_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">User</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">DummyRequest</span><span class="p">()</span>
        <span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
        <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>

        <span class="kn">from</span> <span class="nn">..security</span> <span class="kn">import</span> <span class="n">MyAuthenticationPolicy</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="n">MyAuthenticationPolicy</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">policy</span><span class="o">.</span><span class="n">authenticated_userid</span><span class="p">(</span><span class="n">request</span><span class="p">),</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Create <code class="docutils literal notranslate"><span class="pre">tutorial/tests/test_user_model.py</span></code> such that it appears as follows:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">transaction</span>

<span class="kn">from</span> <span class="nn">pyramid</span> <span class="kn">import</span> <span class="n">testing</span>


<span class="k">class</span> <span class="nc">BaseTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">get_tm_session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">testing</span><span class="o">.</span><span class="n">setUp</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;sqlalchemy.url&#39;</span><span class="p">:</span> <span class="s1">&#39;sqlite:///:memory:&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;..models&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="s1">&#39;..routes&#39;</span><span class="p">)</span>

        <span class="n">session_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;dbsession_factory&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">get_tm_session</span><span class="p">(</span><span class="n">session_factory</span><span class="p">,</span> <span class="n">transaction</span><span class="o">.</span><span class="n">manager</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_database</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models.meta</span> <span class="kn">import</span> <span class="n">Base</span>
        <span class="n">session_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;dbsession_factory&#39;</span><span class="p">]</span>
        <span class="n">engine</span> <span class="o">=</span> <span class="n">session_factory</span><span class="o">.</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;bind&#39;</span><span class="p">]</span>
        <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">testing</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="n">transaction</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">makeUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">User</span>
        <span class="k">return</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestSetPassword</span><span class="p">(</span><span class="n">BaseTest</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_password_hash_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password_hash</span><span class="p">)</span>

        <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password_hash</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestCheckPassword</span><span class="p">(</span><span class="n">BaseTest</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_password_hash_not_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password_hash</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_correct_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password_hash</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_incorrect_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeUser</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password_hash</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="s1">&#39;incorrect&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">We're utilizing the excellent <a class="reference external" href="https://docs.pylonsproject.org/projects/webtest/en/latest/">WebTest</a> package to do functional testing of
the application. This is defined in the <code class="docutils literal notranslate"><span class="pre">tests_require</span></code> section of our
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code>. Any other dependencies needed only for testing purposes can be
added there and will be installed automatically when running
<code class="docutils literal notranslate"><span class="pre">setup.py</span> <span class="pre">test</span></code>.</p>
</div>
</div>
<div class="section" id="running-the-tests">
<h2>Running the tests<a class="headerlink" href="#running-the-tests" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We can run these tests similarly to how we did in <a class="reference internal" href="../wiki/installation.html#running-tests"><span class="std std-ref">Run the tests</span></a>, but first delete the SQLite database <code class="docutils literal notranslate"><span class="pre">tutorial.sqlite</span></code>. If you do not delete the database, then you will see an integrity error when running the tests.</p>
<p>On UNIX:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ rm tutorial.sqlite
$ <span class="nv">$VENV</span>/bin/py.test -q
</pre></div>
</div>
<p>On Windows:</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">c:\tutorial&gt;</span> <span class="k">del</span> tutorial.sqlite
<span class="gp">c:\tutorial&gt;</span> <span class="nv">%VENV%</span>\Scripts\py.test -q
</pre></div>
</div>
<p>The expected result should look like the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>................................
32 passed in 9.90 seconds
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Adding Tests</a><ul>
<li><a class="reference internal" href="#test-the-views">Test the views</a></li>
<li><a class="reference internal" href="#functional-tests">Functional tests</a></li>
<li><a class="reference internal" href="#view-the-results-of-all-our-edits-to-tests-subpackage">View the results of all our edits to <code class="docutils literal notranslate"><span class="pre">tests</span></code> subpackage</a></li>
<li><a class="reference internal" href="#running-the-tests">Running the tests</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="authorization.html"
                        title="前の章へ">Adding authorization</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="distributing.html"
                        title="次の章へ">Distributing Your Application</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/tutorials/wiki2/tests.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="distributing.html" title="Distributing Your Application"
             >次へ</a> |</li>
        <li class="right" >
          <a href="authorization.html" title="Adding authorization"
             >前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >SQLAlchemy + URL dispatch wiki tutorial</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 8月 04, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4 で生成しました。
    </div>
  </body>
</html>