
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Defining Views &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="copyright" title="著作権" href="../../copyright.html" />
    <link rel="next" title="Adding authentication" href="authentication.html" />
    <link rel="prev" title="Defining the Domain Model" href="definingmodels.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../../index.html">
      		<img class="logo" src="../../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="authentication.html" title="Adding authentication"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="definingmodels.html" title="Defining the Domain Model"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">SQLAlchemy + URL dispatch wiki tutorial</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="defining-views">
<span id="wiki2-defining-views"></span><h1>Defining Views<a class="headerlink" href="#defining-views" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>A <a class="reference internal" href="../../glossary.html#term-view-callable"><span class="xref std std-term">view callable</span></a> in a <span>Pyramid</span> application is typically a simple
Python function that accepts a single parameter named <a class="reference internal" href="../../glossary.html#term-request"><span class="xref std std-term">request</span></a>. A view
callable is assumed to return a <a class="reference internal" href="../../glossary.html#term-response"><span class="xref std std-term">response</span></a> object.</p>
<p>The request object has a dictionary as an attribute named <code class="docutils literal notranslate"><span class="pre">matchdict</span></code>. A
<code class="docutils literal notranslate"><span class="pre">matchdict</span></code> maps the placeholders in the matching URL <code class="docutils literal notranslate"><span class="pre">pattern</span></code> to the
substrings of the path in the <a class="reference internal" href="../../glossary.html#term-request"><span class="xref std std-term">request</span></a> URL. For instance, if a call to
<a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.add_route" title="pyramid.config.Configurator.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.add_route()</span></code></a> has the pattern <code class="docutils literal notranslate"><span class="pre">/{one}/{two}</span></code>,
and a user visits <code class="docutils literal notranslate"><span class="pre">http://example.com/foo/bar</span></code>, our pattern would be matched
against <code class="docutils literal notranslate"><span class="pre">/foo/bar</span></code> and the <code class="docutils literal notranslate"><span class="pre">matchdict</span></code> would look like <code class="docutils literal notranslate"><span class="pre">{'one':'foo',</span>
<span class="pre">'two':'bar'}</span></code>.</p>
<div class="section" id="adding-the-docutils-dependency">
<h2>Adding the <code class="docutils literal notranslate"><span class="pre">docutils</span></code> dependency<a class="headerlink" href="#adding-the-docutils-dependency" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Remember in the previous chapter we added a new dependency of the <code class="docutils literal notranslate"><span class="pre">bcrypt</span></code>
package. Again, the view code in our application will depend on a package which
is not a dependency of the original &quot;tutorial&quot; application.</p>
<p>We need to add a dependency on the <code class="docutils literal notranslate"><span class="pre">docutils</span></code> package to our <code class="docutils literal notranslate"><span class="pre">tutorial</span></code>
package's <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file by assigning this dependency to the <code class="docutils literal notranslate"><span class="pre">requires</span></code>
parameter in the <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function.</p>
<p>Open <code class="docutils literal notranslate"><span class="pre">tutorial/setup.py</span></code> and edit it to look like the following:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;README.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">README</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;CHANGES.txt&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">CHANGES</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">requires</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;bcrypt&#39;</span><span class="p">,</span>
<span class="hll">    <span class="s1">&#39;docutils&#39;</span><span class="p">,</span>
</span>    <span class="s1">&#39;plaster_pastedeploy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid &gt;= 1.9a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_debugtoolbar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_jinja2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_retry&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pyramid_tm&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SQLAlchemy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;transaction&#39;</span><span class="p">,</span>
    <span class="s1">&#39;zope.sqlalchemy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;waitress&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">tests_require</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;WebTest &gt;= 1.3.1&#39;</span><span class="p">,</span>  <span class="c1"># py3 compat</span>
    <span class="s1">&#39;pytest&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pytest-cov&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tutorial&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;myproj&#39;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">README</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">CHANGES</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Programming Language :: Python&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Framework :: Pyramid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Internet :: WWW/HTTP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Internet :: WWW/HTTP :: WSGI :: Application&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">keywords</span><span class="o">=</span><span class="s1">&#39;web pyramid pylons&#39;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">extras_require</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;testing&#39;</span><span class="p">:</span> <span class="n">tests_require</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;paste.app_factory&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;main = tutorial:main&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;initialize_tutorial_db = tutorial.scripts.initializedb:main&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Only the highlighted line needs to be added.</p>
<p>Again, as we did in the previous chapter, the dependency now needs to be
installed, so re-run the <code class="docutils literal notranslate"><span class="pre">$VENV/bin/pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code> command.</p>
</div>
<div class="section" id="static-assets">
<h2>Static assets<a class="headerlink" href="#static-assets" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Our templates name static assets, including CSS and images.  We don't need
to create these files within our package's <code class="docutils literal notranslate"><span class="pre">static</span></code> directory because they
were provided at the time we created the project.</p>
<p>As an example, the CSS file will be accessed via
<code class="docutils literal notranslate"><span class="pre">http://localhost:6543/static/theme.css</span></code> by virtue of the call to the
<code class="docutils literal notranslate"><span class="pre">add_static_view</span></code> directive we've made in the <code class="docutils literal notranslate"><span class="pre">routes.py</span></code> file. Any number
and type of static assets can be placed in this directory (or subdirectories)
and are just referred to by URL or by using the convenience method
<code class="docutils literal notranslate"><span class="pre">static_url</span></code>, e.g., <code class="docutils literal notranslate"><span class="pre">request.static_url('&lt;package&gt;:static/foo.css')</span></code> within
templates.</p>
</div>
<div class="section" id="adding-routes-to-routes-py">
<h2>Adding routes to <code class="docutils literal notranslate"><span class="pre">routes.py</span></code><a class="headerlink" href="#adding-routes-to-routes-py" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>This is the <cite>URL Dispatch</cite> tutorial, so let's start by adding some URL patterns
to our app. Later we'll attach views to handle the URLs.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">routes.py</span></code> file contains <a class="reference internal" href="../../api/config.html#pyramid.config.Configurator.add_route" title="pyramid.config.Configurator.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.config.Configurator.add_route()</span></code></a>
calls which serve to add routes to our application. First we'll get rid of the
existing route created by the template using the name <code class="docutils literal notranslate"><span class="pre">'home'</span></code>. It's only an
example and isn't relevant to our application.</p>
<p>We then need to add four calls to <code class="docutils literal notranslate"><span class="pre">add_route</span></code>. Note that the <em>ordering</em> of
these declarations is very important. Route declarations are matched in the
order they're registered.</p>
<ol class="arabic simple">
<li>Add a declaration which maps the pattern <code class="docutils literal notranslate"><span class="pre">/</span></code> (signifying the root URL) to
the route named <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code>. In the next step, we will map it to our
<code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view callable by virtue of the <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator
attached to the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view function, which in turn will be indicated
by <code class="docutils literal notranslate"><span class="pre">route_name='view_wiki'</span></code>.</li>
<li>Add a declaration which maps the pattern <code class="docutils literal notranslate"><span class="pre">/{pagename}</span></code> to the route named
<code class="docutils literal notranslate"><span class="pre">view_page</span></code>. This is the regular view for a page. Again, in the next step,
we will map it to our <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view callable by virtue of the
<code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator attached to the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view function,
whin in turn will be indicated by <code class="docutils literal notranslate"><span class="pre">route_name='view_page'</span></code>.</li>
<li>Add a declaration which maps the pattern <code class="docutils literal notranslate"><span class="pre">/add_page/{pagename}</span></code> to the
route named <code class="docutils literal notranslate"><span class="pre">add_page</span></code>. This is the add view for a new page. We will map
it to our <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view callable by virtue of the <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code>
decorator attached to the <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view function, which in turn will be
indicated by <code class="docutils literal notranslate"><span class="pre">route_name='add_page'</span></code>.</li>
<li>Add a declaration which maps the pattern <code class="docutils literal notranslate"><span class="pre">/{pagename}/edit_page</span></code> to the
route named <code class="docutils literal notranslate"><span class="pre">edit_page</span></code>. This is the edit view for a page. We will map it
to our <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view callable by virtue of the <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code>
decorator attached to the <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view function, which in turn will be
indicated by <code class="docutils literal notranslate"><span class="pre">route_name='edit_page'</span></code>.</li>
</ol>
<p>As a result of our edits, the <code class="docutils literal notranslate"><span class="pre">routes.py</span></code> file should look like the
following:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">includeme</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">cache_max_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
<span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;view_wiki&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="s1">&#39;/{pagename}&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="s1">&#39;/add_page/{pagename}&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="s1">&#39;/{pagename}/edit_page&#39;</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>The highlighted lines are the ones that need to be added or edited.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">The order of the routes is important! If you placed
<code class="docutils literal notranslate"><span class="pre">/{pagename}/edit_page</span></code> <em>before</em> <code class="docutils literal notranslate"><span class="pre">/add_page/{pagename}</span></code>, then we would
never be able to add pages. This is because the first route would always
match a request to <code class="docutils literal notranslate"><span class="pre">/add_page/edit_page</span></code> whereas we want <code class="docutils literal notranslate"><span class="pre">/add_page/..</span></code>
to have priority. This isn't a huge problem in this particular app because
wiki pages are always camel case, but it's important to be aware of this
behavior in your own apps.</p>
</div>
</div>
<div class="section" id="adding-view-functions-in-views-default-py">
<h2>Adding view functions in <code class="docutils literal notranslate"><span class="pre">views/default.py</span></code><a class="headerlink" href="#adding-view-functions-in-views-default-py" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>It's time for a major change.  Open <code class="docutils literal notranslate"><span class="pre">tutorial/views/default.py</span></code> and
edit it to look like the following:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">from</span> <span class="nn">pyramid.compat</span> <span class="kn">import</span> <span class="n">escape</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">re</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">docutils.core</span> <span class="kn">import</span> <span class="n">publish_parts</span>
</span><span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">pyramid.httpexceptions</span> <span class="kn">import</span> <span class="p">(</span>
</span><span class="hll">    <span class="n">HTTPFound</span><span class="p">,</span>
</span><span class="hll">    <span class="n">HTTPNotFound</span><span class="p">,</span>
</span><span class="hll">    <span class="p">)</span>
</span><span class="hll">
</span><span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>

<span class="hll"><span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Page</span><span class="p">,</span> <span class="n">User</span>
</span><span class="hll">
</span><span class="hll"><span class="c1"># regular expression used to find WikiWords</span>
</span><span class="hll"><span class="n">wikiwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b([A-Z]\w+[A-Z]+\w+)&quot;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;view_wiki&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">view_wiki</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="s1">&#39;FrontPage&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">next_url</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;../templates/view.jinja2&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">view_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s1">&#39;pagename&#39;</span><span class="p">]</span>
</span><span class="hll">    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class="hll">        <span class="k">raise</span> <span class="n">HTTPNotFound</span><span class="p">(</span><span class="s1">&#39;No such page&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
</span><span class="hll">        <span class="n">word</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="hll">        <span class="n">exists</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
</span><span class="hll">            <span class="n">view_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
</span><span class="hll">            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">view_url</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="n">add_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
</span><span class="hll">            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add_url</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">writer_name</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)[</span><span class="s1">&#39;html_body&#39;</span><span class="p">]</span>
</span><span class="hll">    <span class="n">content</span> <span class="o">=</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">add_link</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span><span class="hll">    <span class="n">edit_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">edit_url</span><span class="o">=</span><span class="n">edit_url</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;../templates/edit.jinja2&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">edit_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s1">&#39;pagename&#39;</span><span class="p">]</span>
</span><span class="hll">    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
</span><span class="hll">    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
</span><span class="hll">        <span class="n">page</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
</span><span class="hll">        <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">next_url</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
</span><span class="hll">        <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span class="hll">        <span class="n">pagedata</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span class="hll">        <span class="n">save_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
</span><span class="hll">        <span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;../templates/edit.jinja2&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">add_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span><span class="hll">    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s1">&#39;pagename&#39;</span><span class="p">]</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class="hll">        <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">next_url</span><span class="p">)</span>
</span><span class="hll">    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
</span><span class="hll">        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
</span><span class="hll">        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
</span><span class="hll">        <span class="n">page</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="p">(</span>
</span><span class="hll">            <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;editor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">())</span>
</span><span class="hll">        <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span class="hll">        <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">next_url</span><span class="p">)</span>
</span><span class="hll">    <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">,</span> <span class="n">pagedata</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">save_url</span><span class="o">=</span><span class="n">save_url</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>The highlighted lines need to be added or edited.</p>
<p>We added some imports, and created a regular expression to find &quot;WikiWords&quot;.</p>
<p>We got rid of the <code class="docutils literal notranslate"><span class="pre">my_view</span></code> view function and its decorator that was added
when we originally rendered the <code class="docutils literal notranslate"><span class="pre">alchemy</span></code> cookiecutter.  It was only an example
and isn't relevant to our application.  We also deleted the <code class="docutils literal notranslate"><span class="pre">db_err_msg</span></code>
string.</p>
<p>Then we added four <a class="reference internal" href="../../glossary.html#term-view-callable"><span class="xref std std-term">view callable</span></a> functions to our <code class="docutils literal notranslate"><span class="pre">views/default.py</span></code>
module, as mentioned in the previous step:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">view_wiki()</span></code> - Displays the wiki itself. It will answer on the root URL.</li>
<li><code class="docutils literal notranslate"><span class="pre">view_page()</span></code> - Displays an individual page.</li>
<li><code class="docutils literal notranslate"><span class="pre">edit_page()</span></code> - Allows the user to edit a page.</li>
<li><code class="docutils literal notranslate"><span class="pre">add_page()</span></code> - Allows the user to add a page.</li>
</ul>
<p>We'll describe each one briefly in the following sections.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">There is nothing special about the filename <code class="docutils literal notranslate"><span class="pre">default.py</span></code> exept that it is a
Python module. A project may have many view callables throughout its codebase
in arbitrarily named modules. Modules implementing view callables often have
<code class="docutils literal notranslate"><span class="pre">view</span></code> in their name (or may live in a Python subpackage of your
application package named <code class="docutils literal notranslate"><span class="pre">views</span></code>, as in our case), but this is only by
convention, not a requirement.</p>
</div>
<div class="section" id="the-view-wiki-view-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view function<a class="headerlink" href="#the-view-wiki-view-function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Following is the code for the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view function and its decorator:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;view_wiki&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_wiki</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="s1">&#39;FrontPage&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">next_url</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal notranslate"><span class="pre">view_wiki()</span></code> is the <a class="reference internal" href="../../glossary.html#term-default-view"><span class="xref std std-term">default view</span></a> that gets called when a request is
made to the root URL of our wiki.  It always redirects to a URL which
represents the path to our &quot;FrontPage&quot;.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view callable always redirects to the URL of a Page resource
named &quot;FrontPage&quot;.  To do so, it returns an instance of the
<a class="reference internal" href="../../api/httpexceptions.html#pyramid.httpexceptions.HTTPFound" title="pyramid.httpexceptions.HTTPFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPFound</span></code></a> class (instances of which implement
the <a class="reference internal" href="../../api/interfaces.html#pyramid.interfaces.IResponse" title="pyramid.interfaces.IResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.interfaces.IResponse</span></code></a> interface, like
<a class="reference internal" href="../../api/response.html#pyramid.response.Response" title="pyramid.response.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.response.Response</span></code></a>). It uses the
<a class="reference internal" href="../../api/request.html#pyramid.request.Request.route_url" title="pyramid.request.Request.route_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pyramid.request.Request.route_url()</span></code></a> API to construct a URL to the
<code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> page (i.e., <code class="docutils literal notranslate"><span class="pre">http://localhost:6543/FrontPage</span></code>), and uses it as
the &quot;location&quot; of the <code class="docutils literal notranslate"><span class="pre">HTTPFound</span></code> response, forming an HTTP redirect.</p>
</div>
<div class="section" id="the-view-page-view-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view function<a class="headerlink" href="#the-view-page-view-function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Here is the code for the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view function and its decorator:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;../templates/view.jinja2&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s1">&#39;pagename&#39;</span><span class="p">]</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPNotFound</span><span class="p">(</span><span class="s1">&#39;No such page&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
            <span class="n">view_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">view_url</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">add_url</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">writer_name</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)[</span><span class="s1">&#39;html_body&#39;</span><span class="p">]</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">add_link</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">edit_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">edit_url</span><span class="o">=</span><span class="n">edit_url</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal notranslate"><span class="pre">view_page()</span></code> is used to display a single page of our wiki.  It renders the
<a class="reference internal" href="../../glossary.html#term-restructuredtext"><span class="xref std std-term">reStructuredText</span></a> body of a page (stored as the <code class="docutils literal notranslate"><span class="pre">data</span></code> attribute of a
<code class="docutils literal notranslate"><span class="pre">Page</span></code> model object) as HTML.  Then it substitutes an HTML anchor for each
<em>WikiWord</em> reference in the rendered HTML using a compiled regular expression.</p>
<p>The curried function named <code class="docutils literal notranslate"><span class="pre">add_link</span></code> is used as the first argument to
<code class="docutils literal notranslate"><span class="pre">wikiwords.sub</span></code>, indicating that it should be called to provide a value for
each WikiWord match found in the content.  If the wiki already contains a
page with the matched WikiWord name, <code class="docutils literal notranslate"><span class="pre">add_link()</span></code> generates a view
link to be used as the substitution value and returns it.  If the wiki does
not already contain a page with the matched WikiWord name, <code class="docutils literal notranslate"><span class="pre">add_link()</span></code>
generates an &quot;add&quot; link as the substitution value and returns it.</p>
<p>As a result, the <code class="docutils literal notranslate"><span class="pre">content</span></code> variable is now a fully formed bit of HTML
containing various view and add links for WikiWords based on the content of
our current page object.</p>
<p>We then generate an edit URL, because it's easier to do here than in the
template, and we return a dictionary with a number of arguments.  The fact that
<code class="docutils literal notranslate"><span class="pre">view_page()</span></code> returns a dictionary (as opposed to a <a class="reference internal" href="../../glossary.html#term-response"><span class="xref std std-term">response</span></a> object)
is a cue to <span>Pyramid</span> that it should try to use a <a class="reference internal" href="../../glossary.html#term-renderer"><span class="xref std std-term">renderer</span></a>
associated with the view configuration to render a response.  In our case, the
renderer used will be the <code class="docutils literal notranslate"><span class="pre">view.jinja2</span></code> template, as indicated in
the <code class="docutils literal notranslate"><span class="pre">&#64;view_config</span></code> decorator that is applied to <code class="docutils literal notranslate"><span class="pre">view_page()</span></code>.</p>
<p>If the page does not exist, then we need to handle that by raising a
<a class="reference internal" href="../../api/httpexceptions.html#pyramid.httpexceptions.HTTPNotFound" title="pyramid.httpexceptions.HTTPNotFound"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPNotFound</span></code></a> to trigger our 404 handling,
defined in <code class="docutils literal notranslate"><span class="pre">tutorial/views/notfound.py</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Using <code class="docutils literal notranslate"><span class="pre">raise</span></code> versus <code class="docutils literal notranslate"><span class="pre">return</span></code> with the HTTP exceptions is an important
distinction that can commonly mess people up. In
<code class="docutils literal notranslate"><span class="pre">tutorial/views/notfound.py</span></code> there is an <a class="reference internal" href="../../glossary.html#term-exception-view"><span class="xref std std-term">exception view</span></a>
registered for handling the <code class="docutils literal notranslate"><span class="pre">HTTPNotFound</span></code> exception. Exception views are
only triggered for raised exceptions. If the <code class="docutils literal notranslate"><span class="pre">HTTPNotFound</span></code> is returned,
then it has an internal &quot;stock&quot; template that it will use to render itself
as a response. If you aren't seeing your exception view being executed, this
is most likely the problem! See <a class="reference internal" href="../../narr/views.html#special-exceptions-in-callables"><span class="std std-ref">Using Special Exceptions in View Callables</span></a> for
more information about exception views.</p>
</div>
</div>
<div class="section" id="the-edit-page-view-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view function<a class="headerlink" href="#the-edit-page-view-function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Here is the code for the <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view function and its decorator:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;../templates/edit.jinja2&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">edit_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s1">&#39;pagename&#39;</span><span class="p">]</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">page</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">next_url</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">pagedata</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">save_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal notranslate"><span class="pre">edit_page()</span></code> is invoked when a user clicks the &quot;Edit this Page&quot; button on
the view form. It renders an edit form, but it also acts as the handler for the
form which it renders. The <code class="docutils literal notranslate"><span class="pre">matchdict</span></code> attribute of the request passed to the
<code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view will have a <code class="docutils literal notranslate"><span class="pre">'pagename'</span></code> key matching the name of the page
that the user wants to edit.</p>
<p>If the view execution <em>is</em> a result of a form submission (i.e., the expression
<code class="docutils literal notranslate"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>), the view grabs the
<code class="docutils literal notranslate"><span class="pre">body</span></code> element of the request parameters and sets it as the <code class="docutils literal notranslate"><span class="pre">data</span></code>
attribute of the page object.  It then redirects to the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view
of the wiki page.</p>
<p>If the view execution is <em>not</em> a result of a form submission (i.e., the
expression <code class="docutils literal notranslate"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>), the view
simply renders the edit form, passing the page object and a <code class="docutils literal notranslate"><span class="pre">save_url</span></code>
which will be used as the action of the generated form.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Since our <code class="docutils literal notranslate"><span class="pre">request.dbsession</span></code> defined in the previous chapter is
registered with the <code class="docutils literal notranslate"><span class="pre">pyramid_tm</span></code> transaction manager, any changes we make
to objects managed by the that session will be committed automatically. In
the event that there was an error (even later, in our template code), the
changes would be aborted. This means the view itself does not need to
concern itself with commit/rollback logic.</p>
</div>
</div>
<div class="section" id="the-add-page-view-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view function<a class="headerlink" href="#the-add-page-view-function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Here is the code for the <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view function and its decorator:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@view_config</span><span class="p">(</span><span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;../templates/edit.jinja2&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">matchdict</span><span class="p">[</span><span class="s1">&#39;pagename&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Page</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;edit_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">next_url</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;form.submitted&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">pagename</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
        <span class="n">page</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;editor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">())</span>
        <span class="n">request</span><span class="o">.</span><span class="n">dbsession</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;view_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">next_url</span><span class="p">)</span>
    <span class="n">save_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">route_url</span><span class="p">(</span><span class="s1">&#39;add_page&#39;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">,</span> <span class="n">pagedata</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">save_url</span><span class="o">=</span><span class="n">save_url</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal notranslate"><span class="pre">add_page()</span></code> is invoked when a user clicks on a <em>WikiWord</em> which isn't yet
represented as a page in the system. The <code class="docutils literal notranslate"><span class="pre">add_link</span></code> function within the
<code class="docutils literal notranslate"><span class="pre">view_page</span></code> view generates URLs to this view. <code class="docutils literal notranslate"><span class="pre">add_page()</span></code> also acts as a
handler for the form that is generated when we want to add a page object. The
<code class="docutils literal notranslate"><span class="pre">matchdict</span></code> attribute of the request passed to the <code class="docutils literal notranslate"><span class="pre">add_page()</span></code> view will
have the values we need to construct URLs and find model objects.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">matchdict</span></code> will have a <code class="docutils literal notranslate"><span class="pre">'pagename'</span></code> key that matches the name of the
page we'd like to add. If our add view is invoked via, for example,
<code class="docutils literal notranslate"><span class="pre">http://localhost:6543/add_page/SomeName</span></code>, the value for <code class="docutils literal notranslate"><span class="pre">'pagename'</span></code> in
the <code class="docutils literal notranslate"><span class="pre">matchdict</span></code> will be <code class="docutils literal notranslate"><span class="pre">'SomeName'</span></code>.</p>
<p>Next a check is performed to determine whether the <code class="docutils literal notranslate"><span class="pre">Page</span></code> already exists in
the database. If it already exists, then the client is redirected to the
<code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view, else we continue to the next check.</p>
<p>If the view execution <em>is</em> a result of a form submission (i.e., the expression
<code class="docutils literal notranslate"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>), we grab the page body from
the form data, create a Page object with this page body and the name taken from
<code class="docutils literal notranslate"><span class="pre">matchdict['pagename']</span></code>, and save it into the database using
<code class="docutils literal notranslate"><span class="pre">request.dbession.add</span></code>. Since we have not yet covered authentication, we
don't have a logged-in user to add as the page's <code class="docutils literal notranslate"><span class="pre">creator</span></code>. Until we get to
that point in the tutorial, we'll just assume that all pages are created by the
<code class="docutils literal notranslate"><span class="pre">editor</span></code> user. Thus we query for that object, and set it on <code class="docutils literal notranslate"><span class="pre">page.creator</span></code>.
Finally, we redirect the client back to the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view for the newly
created page.</p>
<p>If the view execution is <em>not</em> a result of a form submission (i.e., the
expression <code class="docutils literal notranslate"><span class="pre">'form.submitted'</span> <span class="pre">in</span> <span class="pre">request.params</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>), the view
callable renders a template.  To do so, it generates a <code class="docutils literal notranslate"><span class="pre">save_url</span></code> which the
template uses as the form post URL during rendering.  We're lazy here, so
we're going to use the same template (<code class="docutils literal notranslate"><span class="pre">templates/edit.jinja2</span></code>) for the add
view as well as the page edit view. To do so we create a dummy <code class="docutils literal notranslate"><span class="pre">Page</span></code> object
in order to satisfy the edit form's desire to have <em>some</em> page object
exposed as <code class="docutils literal notranslate"><span class="pre">page</span></code>. <span>Pyramid</span> will render the template associated
with this view to a response.</p>
</div>
</div>
<div class="section" id="adding-templates">
<h2>Adding templates<a class="headerlink" href="#adding-templates" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">view_page</span></code>, <code class="docutils literal notranslate"><span class="pre">add_page</span></code> and <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> views that we've added
reference a <a class="reference internal" href="../../glossary.html#term-template"><span class="xref std std-term">template</span></a>.  Each template is a <a class="reference internal" href="../../glossary.html#term-jinja2"><span class="xref std std-term">Jinja2</span></a> template.
These templates will live in the <code class="docutils literal notranslate"><span class="pre">templates</span></code> directory of our tutorial
package.  Jinja2 templates must have a <code class="docutils literal notranslate"><span class="pre">.jinja2</span></code> extension to be recognized
as such.</p>
<div class="section" id="the-layout-jinja2-template">
<h3>The <code class="docutils literal notranslate"><span class="pre">layout.jinja2</span></code> template<a class="headerlink" href="#the-layout-jinja2-template" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Update <code class="docutils literal notranslate"><span class="pre">tutorial/templates/layout.jinja2</span></code> with the following content, as
indicated by the emphasized lines:</p>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;{{request.locale_name}}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;pyramid web application&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;Pylons Project&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{request.static_url(&#39;tutorial:static/pyramid-16x16.png&#39;)}}&quot;</span><span class="p">&gt;</span>

<span class="hll">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block subtitle %}{% endblock %}Pyramid tutorial wiki (based on TurboGears 20-Minute Wiki)<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span>
    <span class="c">&lt;!-- Bootstrap core CSS --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- Custom styles for this scaffold --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{request.static_url(&#39;tutorial:static/theme.css&#39;)}}&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js&quot; integrity=&quot;sha384-0s5Pv64cNZJieYFkXYOTId2HMA2Lfb6q2nAcx2n0RTLUnCAoTTsS0nKEO27XyKcY&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">      &lt;script src=&quot;//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js&quot; integrity=&quot;sha384-f1r2UzjsxZ9T4V1f2zBO/evUqSEOpeaUUZcMTz1Up63bl4ruYnFYeM+BxI4NhyI0&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;starter-template&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-2&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;logo img-responsive&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{request.static_url(&#39;tutorial:static/pyramid.png&#39;) }}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;pyramid web framework&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-10&quot;</span><span class="p">&gt;</span>
<span class="hll">            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
</span><span class="hll">            {% block content %}{% endblock %}
</span><span class="hll">            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span>          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;copyright&quot;</span><span class="p">&gt;</span>
            Copyright <span class="ni">&amp;copy;</span> Pylons Project
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


    <span class="c">&lt;!-- Bootstrap core JavaScript</span>
<span class="c">    ================================================== --&gt;</span>
    <span class="c">&lt;!-- Placed at the end of the document so the pages load faster --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/jquery/1.10.2/jquery.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-aBL3Lzi6c9LNDGvpHkZrrm3ZVsIwohDD7CDozL0pk8FwCrfmV7H9w8j3L7ikEv6h&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//oss.maxcdn.com/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Since we're using a templating engine, we can factor common boilerplate out of
our page templates into reusable components. One method for doing this is
template inheritance via blocks.</p>
<ul class="simple">
<li>We have defined two placeholders in the layout template where a child
template can override the content. These blocks are named <code class="docutils literal notranslate"><span class="pre">subtitle</span></code> (line
11) and <code class="docutils literal notranslate"><span class="pre">content</span></code> (line 36).</li>
<li>Please refer to the <a class="reference external" href="http://jinja.pocoo.org/">Jinja2 documentation</a> for more information about template
inheritance.</li>
</ul>
</div>
<div class="section" id="the-view-jinja2-template">
<h3>The <code class="docutils literal notranslate"><span class="pre">view.jinja2</span></code> template<a class="headerlink" href="#the-view-jinja2-template" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Create <code class="docutils literal notranslate"><span class="pre">tutorial/templates/view.jinja2</span></code> and add the following content:</p>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{% extends &#39;layout.jinja2&#39; %}

{% block subtitle %}{{page.name}} - {% endblock subtitle %}

{% block content %}
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ content|safe }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ edit_url }}&quot;</span><span class="p">&gt;</span>
    Edit this page
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    Viewing <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{page.name}}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>, created by <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{page.creator.name}}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can return to the
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{request.route_url(&#39;view_page&#39;, pagename=&#39;FrontPage&#39;)}}&quot;</span><span class="p">&gt;</span>FrontPage<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endblock content %}
</pre></div>
</td></tr></table></div>
<p>This template is used by <code class="docutils literal notranslate"><span class="pre">view_page()</span></code> for displaying a single wiki page.</p>
<ul class="simple">
<li>We begin by extending the <code class="docutils literal notranslate"><span class="pre">layout.jinja2</span></code> template defined above, which
provides the skeleton of the page (line 1).</li>
<li>We override the <code class="docutils literal notranslate"><span class="pre">subtitle</span></code> block from the base layout, inserting the page
name into the page's title (line 3).</li>
<li>We override the <code class="docutils literal notranslate"><span class="pre">content</span></code> block from the base layout to insert our markup
into the body (lines 5-18).</li>
<li>We use a variable that is replaced with the <code class="docutils literal notranslate"><span class="pre">content</span></code> value provided by the
view (line 6). <code class="docutils literal notranslate"><span class="pre">content</span></code> contains HTML, so the <code class="docutils literal notranslate"><span class="pre">|safe</span></code> filter is used to
prevent escaping it (e.g., changing &quot;&gt;&quot; to &quot;&amp;gt;&quot;).</li>
<li>We create a link that points at the &quot;edit&quot; URL, which when clicked invokes
the <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view for the requested page (lines 8-10).</li>
</ul>
</div>
<div class="section" id="the-edit-jinja2-template">
<h3>The <code class="docutils literal notranslate"><span class="pre">edit.jinja2</span></code> template<a class="headerlink" href="#the-edit-jinja2-template" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Create <code class="docutils literal notranslate"><span class="pre">tutorial/templates/edit.jinja2</span></code> and add the following content:</p>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll">{% extends &#39;layout.jinja2&#39; %}
</span>
<span class="hll">{% block subtitle %}Edit {{pagename}} - {% endblock subtitle %}
</span>
{% block content %}
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
Editing <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{pagename}}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can return to the
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{request.route_url(&#39;view_page&#39;, pagename=&#39;FrontPage&#39;)}}&quot;</span><span class="p">&gt;</span>FrontPage<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="hll"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ save_url }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
</span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
<span class="hll">    <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;body&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;60&quot;</span><span class="p">&gt;</span>{{ pagedata }}<span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
<span class="hll">    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;form.submitted&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Save&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span><span class="p">&gt;</span>Save<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
{% endblock content %}
</pre></div>
</td></tr></table></div>
<p>This template serves two use cases. It is used by <code class="docutils literal notranslate"><span class="pre">add_page()</span></code> and
<code class="docutils literal notranslate"><span class="pre">edit_page()</span></code> for adding and editing a wiki page.  It displays a page
containing a form and which provides the following:</p>
<ul class="simple">
<li>Again, we extend the <code class="docutils literal notranslate"><span class="pre">layout.jinja2</span></code> template, which provides the skeleton
of the page (line 1).</li>
<li>Override the <code class="docutils literal notranslate"><span class="pre">subtitle</span></code> block to affect the <code class="docutils literal notranslate"><span class="pre">&lt;title&gt;</span></code> tag in the
<code class="docutils literal notranslate"><span class="pre">head</span></code> of the page (line 3).</li>
<li>A 10-row by 60-column <code class="docutils literal notranslate"><span class="pre">textarea</span></code> field named <code class="docutils literal notranslate"><span class="pre">body</span></code> that is filled with
any existing page data when it is rendered (line 14).</li>
<li>A submit button that has the name <code class="docutils literal notranslate"><span class="pre">form.submitted</span></code> (line 17).</li>
<li>The form POSTs back to the <code class="docutils literal notranslate"><span class="pre">save_url</span></code> argument supplied by the view (line
12). The view will use the <code class="docutils literal notranslate"><span class="pre">body</span></code> and <code class="docutils literal notranslate"><span class="pre">form.submitted</span></code> values.</li>
</ul>
</div>
<div class="section" id="the-404-jinja2-template">
<h3>The <code class="docutils literal notranslate"><span class="pre">404.jinja2</span></code> template<a class="headerlink" href="#the-404-jinja2-template" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Replace <code class="docutils literal notranslate"><span class="pre">tutorial/templates/404.jinja2</span></code> with the following content:</p>
<div class="highlight-html notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>{% extends &quot;layout.jinja2&quot; %}

{% block content %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;font-semi-bold&quot;</span><span class="p">&gt;</span>Pyramid tutorial wiki<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;smaller&quot;</span><span class="p">&gt;</span>(based on TurboGears 20-Minute Wiki)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;lead&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;font-semi-bold&quot;</span><span class="p">&gt;</span>404<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> Page Not Found<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock content %}
</pre></div>
</td></tr></table></div>
<p>This template is linked from the <code class="docutils literal notranslate"><span class="pre">notfound_view</span></code> defined in
<code class="docutils literal notranslate"><span class="pre">tutorial/views/notfound.py</span></code> as shown here:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">notfound_view_config</span>


<span class="nd">@notfound_view_config</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;../templates/404.jinja2&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">notfound_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="hll">    <span class="n">request</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">404</span>
</span>    <span class="k">return</span> <span class="p">{}</span>
</pre></div>
</td></tr></table></div>
<p>There are several important things to note about this configuration:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">notfound_view</span></code> in the above snippet is called an
<a class="reference internal" href="../../glossary.html#term-exception-view"><span class="xref std std-term">exception view</span></a>. For more information see
<a class="reference internal" href="../../narr/views.html#special-exceptions-in-callables"><span class="std std-ref">Using Special Exceptions in View Callables</span></a>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">notfound_view</span></code> sets the response status to 404. It's possible
to affect the response object used by the renderer via
<a class="reference internal" href="../../narr/renderers.html#request-response-attr"><span class="std std-ref">Varying Attributes of Rendered Responses</span></a>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">notfound_view</span></code> is registered as an exception view and will be invoked
<strong>only</strong> if <code class="docutils literal notranslate"><span class="pre">pyramid.httpexceptions.HTTPNotFound</span></code> is raised as an
exception. This means it will not be invoked for any responses returned
from a view normally. For example, on line 27 of
<code class="docutils literal notranslate"><span class="pre">tutorial/views/default.py</span></code> the exception is raised which will trigger
the view.</li>
</ul>
<p>Finally, we may delete the <code class="docutils literal notranslate"><span class="pre">tutorial/templates/mytemplate.jinja2</span></code> template
that was provided by the <code class="docutils literal notranslate"><span class="pre">alchemy</span></code> cookiecutter, as we have created our own
templates for the wiki.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Our templates use a <code class="docutils literal notranslate"><span class="pre">request</span></code> object that none of our tutorial
views return in their dictionary. <code class="docutils literal notranslate"><span class="pre">request</span></code> is one of several names that
are available &quot;by default&quot; in a template when a template renderer is used.
See <a class="reference internal" href="../../narr/templates.html#renderer-system-values"><span class="std std-ref">System Values Used During Rendering</span></a> for information about other names that
are available by default when a template is used as a renderer.</p>
</div>
</div>
</div>
<div class="section" id="viewing-the-application-in-a-browser">
<h2>Viewing the application in a browser<a class="headerlink" href="#viewing-the-application-in-a-browser" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We can finally examine our application in a browser (See
<a class="reference internal" href="installation.html#wiki2-start-the-application"><span class="std std-ref">Start the application</span></a>).  Launch a browser and visit
each of the following URLs, checking that the result is as expected:</p>
<ul class="simple">
<li><a class="reference external" href="http://localhost:6543/">http://localhost:6543/</a> invokes the <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view.  This always
redirects to the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view of the <code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> page object.</li>
<li><a class="reference external" href="http://localhost:6543/FrontPage">http://localhost:6543/FrontPage</a> invokes the <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view of the
<code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> page object.</li>
<li><a class="reference external" href="http://localhost:6543/FrontPage/edit_page">http://localhost:6543/FrontPage/edit_page</a> invokes the <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view for
the <code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> page object.</li>
<li><a class="reference external" href="http://localhost:6543/add_page/SomePageName">http://localhost:6543/add_page/SomePageName</a> invokes the <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view for
a page. If the page already exists, then it redirects the user to the
<code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view for the page object.</li>
<li><a class="reference external" href="http://localhost:6543/SomePageName/edit_page">http://localhost:6543/SomePageName/edit_page</a> invokes the <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view
for an existing page, or generates an error if the page does not exist.</li>
<li>To generate an error, visit <a class="reference external" href="http://localhost:6543/foobars/edit_page">http://localhost:6543/foobars/edit_page</a> which
will generate a <code class="docutils literal notranslate"><span class="pre">NoResultFound:</span> <span class="pre">No</span> <span class="pre">row</span> <span class="pre">was</span> <span class="pre">found</span> <span class="pre">for</span> <span class="pre">one()</span></code> error. You'll
see an interactive traceback facility provided by
<a class="reference internal" href="../../glossary.html#term-pyramid-debugtoolbar"><span class="xref std std-term">pyramid_debugtoolbar</span></a>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Defining Views</a><ul>
<li><a class="reference internal" href="#adding-the-docutils-dependency">Adding the <code class="docutils literal notranslate"><span class="pre">docutils</span></code> dependency</a></li>
<li><a class="reference internal" href="#static-assets">Static assets</a></li>
<li><a class="reference internal" href="#adding-routes-to-routes-py">Adding routes to <code class="docutils literal notranslate"><span class="pre">routes.py</span></code></a></li>
<li><a class="reference internal" href="#adding-view-functions-in-views-default-py">Adding view functions in <code class="docutils literal notranslate"><span class="pre">views/default.py</span></code></a><ul>
<li><a class="reference internal" href="#the-view-wiki-view-function">The <code class="docutils literal notranslate"><span class="pre">view_wiki</span></code> view function</a></li>
<li><a class="reference internal" href="#the-view-page-view-function">The <code class="docutils literal notranslate"><span class="pre">view_page</span></code> view function</a></li>
<li><a class="reference internal" href="#the-edit-page-view-function">The <code class="docutils literal notranslate"><span class="pre">edit_page</span></code> view function</a></li>
<li><a class="reference internal" href="#the-add-page-view-function">The <code class="docutils literal notranslate"><span class="pre">add_page</span></code> view function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-templates">Adding templates</a><ul>
<li><a class="reference internal" href="#the-layout-jinja2-template">The <code class="docutils literal notranslate"><span class="pre">layout.jinja2</span></code> template</a></li>
<li><a class="reference internal" href="#the-view-jinja2-template">The <code class="docutils literal notranslate"><span class="pre">view.jinja2</span></code> template</a></li>
<li><a class="reference internal" href="#the-edit-jinja2-template">The <code class="docutils literal notranslate"><span class="pre">edit.jinja2</span></code> template</a></li>
<li><a class="reference internal" href="#the-404-jinja2-template">The <code class="docutils literal notranslate"><span class="pre">404.jinja2</span></code> template</a></li>
</ul>
</li>
<li><a class="reference internal" href="#viewing-the-application-in-a-browser">Viewing the application in a browser</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="definingmodels.html"
                        title="前の章へ">Defining the Domain Model</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="authentication.html"
                        title="次の章へ">Adding authentication</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/tutorials/wiki2/definingviews.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="authentication.html" title="Adding authentication"
             >次へ</a> |</li>
        <li class="right" >
          <a href="definingmodels.html" title="Defining the Domain Model"
             >前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >SQLAlchemy + URL dispatch wiki tutorial</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 8月 18, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4 で生成しました。
    </div>
  </body>
</html>