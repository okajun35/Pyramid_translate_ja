
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Design &#8212; The Pyramid Web Framework v1.9.2</title>
    <link rel="stylesheet" href="../../_static/pylons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="copyright" title="著作権" href="../../copyright.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="Background" href="background.html" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/nobile/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="//static.pylonsproject.org/fonts/neuton/stylesheet.css" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="shortcut icon" href="../../_static/pyramid.ico"/>

  </head><body>







<div class="header-small">
	
	<div class="logo-small">
		<a href="../../index.html">
      		<img class="logo" src="../../_static/pyramid-small.png" alt="Logo"/>
		</a>
  	</div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="background.html" title="Background"
             accesskey="P">前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">SQLAlchemy + URL dispatch wiki tutorial</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="design">
<span id="wiki2-design"></span><h1>Design<a class="headerlink" href="#design" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>Following is a quick overview of the design of our wiki application to help us
understand the changes that we will be making as we work through the tutorial.</p>
<div class="section" id="overall">
<h2>Overall<a class="headerlink" href="#overall" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We choose to use <a class="reference internal" href="../../glossary.html#term-restructuredtext"><span class="xref std std-term">reStructuredText</span></a> markup in the wiki text. Translation
from reStructuredText to HTML is provided by the widely used <code class="docutils literal notranslate"><span class="pre">docutils</span></code>
Python module.  We will add this module to the dependency list in the project's
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file.</p>
</div>
<div class="section" id="models">
<h2>Models<a class="headerlink" href="#models" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We'll be using an SQLite database to hold our wiki data, and we'll be using
<a class="reference internal" href="../../glossary.html#term-sqlalchemy"><span class="xref std std-term">SQLAlchemy</span></a> to access the data in this database.</p>
<p>Within the database, we will define two tables:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">users</span></code> table which will store the <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">password_hash</span></code> and
<code class="docutils literal notranslate"><span class="pre">role</span></code> of each wiki user.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">pages</span></code> table, whose elements will store the wiki pages.
There are four columns: <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">creator_id</span></code>.</li>
</ul>
<p>There is a one-to-many relationship between <code class="docutils literal notranslate"><span class="pre">users</span></code> and <code class="docutils literal notranslate"><span class="pre">pages</span></code> tracking
the user who created each wiki page defined by the <code class="docutils literal notranslate"><span class="pre">creator_id</span></code> column on the
<code class="docutils literal notranslate"><span class="pre">pages</span></code> table.</p>
<p>URLs like <code class="docutils literal notranslate"><span class="pre">/PageName</span></code> will try to find an element in the <code class="docutils literal notranslate"><span class="pre">pages</span></code> table that
has a corresponding name.</p>
<p>To add a page to the wiki, a new row is created and the text is stored in
<code class="docutils literal notranslate"><span class="pre">data</span></code>.</p>
<p>A page named <code class="docutils literal notranslate"><span class="pre">FrontPage</span></code> containing the text &quot;This is the front page&quot; will
be created when the storage is initialized, and will be used as the wiki home
page.</p>
</div>
<div class="section" id="wiki-views">
<h2>Wiki Views<a class="headerlink" href="#wiki-views" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>There will be three views to handle the normal operations of adding, editing,
and viewing wiki pages, plus one view for the wiki front page. Two templates
will be used, one for viewing, and one for both adding and editing wiki pages.</p>
<p>As of version 1.5 <span>Pyramid</span> no longer ships with templating systems.  In
this tutorial, we will use <a class="reference internal" href="../../glossary.html#term-jinja2"><span class="xref std std-term">Jinja2</span></a>.  Jinja2 is a modern and
designer-friendly templating language for Python, modeled after Django's
templates.</p>
</div>
<div class="section" id="security">
<h2>Security<a class="headerlink" href="#security" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>We'll eventually be adding security to our application.  To do this, we'll
be using a very simple role-based security model. We'll assign a single
role category to each user in our system.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">basic</span></code></dt>
<dd>An authenticated user who can view content and create new pages. A <code class="docutils literal notranslate"><span class="pre">basic</span></code>
user may also edit the pages they have created but not pages created by
other users.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">editor</span></code></dt>
<dd>An authenticated user who can create and edit any content in the system.</dd>
</dl>
<p>In order to accomplish this we'll need to define an authentication policy
which can identify users by their <a class="reference internal" href="../../glossary.html#term-userid"><span class="xref std std-term">userid</span></a> and role. Then we'll
need to define a page <a class="reference internal" href="../../glossary.html#term-resource"><span class="xref std std-term">resource</span></a> which contains the appropriate
<a class="reference internal" href="../../glossary.html#term-acl"><span class="xref std std-term">ACL</span></a>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="43%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action</th>
<th class="head">Principal</th>
<th class="head">Permission</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Allow</td>
<td>Everyone</td>
<td>view</td>
</tr>
<tr class="row-odd"><td>Allow</td>
<td>group:basic</td>
<td>create</td>
</tr>
<tr class="row-even"><td>Allow</td>
<td>group:editors</td>
<td>edit</td>
</tr>
<tr class="row-odd"><td>Allow</td>
<td>&lt;creator of page&gt;</td>
<td>edit</td>
</tr>
</tbody>
</table>
<p>Permission declarations will be added to the views to assert the security
policies as each request is handled.</p>
<p>On the security side of the application there are two additional views for
handling login and logout as well as two exception views for handling
invalid access attempts and unhandled URLs.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The URL, actions, template, and permission associated to each view are listed
in the following table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="27%" />
<col width="15%" />
<col width="19%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">URL</th>
<th class="head">Action</th>
<th class="head">View</th>
<th class="head">Template</th>
<th class="head">Permission</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>/</td>
<td>Redirect to
/FrontPage</td>
<td>view_wiki</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>/PageName</td>
<td>Display existing
page <a class="footnote-reference" href="#id5" id="id1">[2]</a></td>
<td>view_page
<a class="footnote-reference" href="#id4" id="id2">[1]</a></td>
<td>view.jinja2</td>
<td>view</td>
</tr>
<tr class="row-even"><td>/PageName/edit_page</td>
<td><p class="first">Display edit form
with existing
content.</p>
<p class="last">If the form was
submitted, redirect
to /PageName</p>
</td>
<td>edit_page</td>
<td>edit.jinja2</td>
<td>edit</td>
</tr>
<tr class="row-odd"><td>/add_page/PageName</td>
<td><p class="first">Create the page
<em>PageName</em> in
storage,  display
the edit form
without content.</p>
<p class="last">If the form was
submitted,
redirect to
/PageName</p>
</td>
<td>add_page</td>
<td>edit.jinja2</td>
<td>create</td>
</tr>
<tr class="row-even"><td>/login</td>
<td><p class="first">Display login form,
Forbidden <a class="footnote-reference" href="#id6" id="id3">[3]</a></p>
<p>If the form was
submitted,
authenticate.</p>
<ul class="last simple">
<li>If authentication
succeeds,
redirect to the
page from which
we came.</li>
<li>If authentication
fails, display
login form with
&quot;login failed&quot;
message.</li>
</ul>
</td>
<td>login</td>
<td>login.jinja2</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>/logout</td>
<td>Redirect to
/FrontPage</td>
<td>logout</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>This is the default view for a Page context when there is no view name.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[2]</a></td><td>Pyramid will return a default 404 Not Found page if the page <code class="docutils literal notranslate"><span class="pre">PageName</span></code>
does not exist yet.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><code class="docutils literal notranslate"><span class="pre">pyramid.exceptions.Forbidden</span></code> is reached when a user tries to invoke
a view that is not authorized by the authorization policy.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">Design</a><ul>
<li><a class="reference internal" href="#overall">Overall</a></li>
<li><a class="reference internal" href="#models">Models</a></li>
<li><a class="reference internal" href="#wiki-views">Wiki Views</a></li>
<li><a class="reference internal" href="#security">Security</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="background.html"
                        title="前の章へ">Background</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="installation.html"
                        title="次の章へ">Installation</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/tutorials/wiki2/design.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >次へ</a> |</li>
        <li class="right" >
          <a href="background.html" title="Background"
             >前へ</a> |</li>
    	<li><a href="../../index.html">The Pyramid Web Framework v1.9.2</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >SQLAlchemy + URL dispatch wiki tutorial</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 2008-2018, Agendaless Consulting.
      最終更新: 8月 18, 2018
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4 で生成しました。
    </div>
  </body>
</html>